<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NDi Auto | Home</title>
<meta name="description" content="NDi Auto by Network Designs, Inc. — AI & Automation Research Division. Client-side document serialization for AI-ready corpus generation.">
<link rel="icon" href="robot_white.png" type="image/png">

<!-- Fonts: Nunito Sans (closest free match to Avenir) + DM Mono for data -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,opsz,wght@0,6..12,300;0,6..12,400;0,6..12,600;0,6..12,700;0,6..12,800;0,6..12,900;1,6..12,400&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">

<!-- Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<style>
  /* ===== NDI BRAND TOKENS (from brand guide) ===== */
  :root {
    --n-blue: #022640;
    --n-blue-deep: #011a2e;
    --d-blue: #07B0E8;
    --d-blue-hover: #05a0d4;
    --d-blue-glow: rgba(7,176,232,0.15);
    --d-blue-glow-strong: rgba(7,176,232,0.35);
    --x-blue: #003867;
    --grey-1: #F1F2F2;
    --white: #FFFFFF;
    --text-secondary: #8FA4B3;
    --text-tertiary: #5A7485;
    --surface-0: #011a2e;
    --surface-1: rgba(7,176,232,0.04);
    --surface-2: rgba(7,176,232,0.07);
    --border: rgba(7,176,232,0.12);
    --border-hover: rgba(7,176,232,0.3);
    --success: #00C9A7;
    --success-bg: rgba(0,201,167,0.08);
    --success-border: rgba(0,201,167,0.25);
    --danger: #FF6B6B;
    --radius: 8px;
    --radius-lg: 14px;
  }

  /* ===== RESET & BASE ===== */
  *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
  html { scroll-behavior: smooth; scroll-padding-top: 80px; }

  body {
    background: var(--n-blue-deep);
    color: var(--white);
    font-family: 'Nunito Sans', -apple-system, sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
    line-height: 1.55;
    -webkit-font-smoothing: antialiased;
  }

  /* ===== AMBIENT BACKGROUND ===== */
  body::before {
    content: '';
    position: fixed; inset: 0;
    background:
      radial-gradient(ellipse 80% 60% at 10% 20%, rgba(7,176,232,0.06) 0%, transparent 60%),
      radial-gradient(ellipse 60% 50% at 90% 80%, rgba(0,56,103,0.1) 0%, transparent 60%),
      radial-gradient(ellipse 40% 30% at 50% 0%, rgba(7,176,232,0.04) 0%, transparent 50%);
    pointer-events: none;
    z-index: 0;
  }

  /* ===== GRID OVERLAY (Palantir-style subtle grid) ===== */
  body::after {
    content: '';
    position: fixed; inset: 0;
    background-image:
      linear-gradient(rgba(7,176,232,0.02) 1px, transparent 1px),
      linear-gradient(90deg, rgba(7,176,232,0.02) 1px, transparent 1px);
    background-size: 60px 60px;
    pointer-events: none;
    z-index: 0;
  }

  .app { position: relative; z-index: 1; }

  /* ===== TOPBAR ===== */
  .topbar {
    display: flex; align-items: center; justify-content: space-between;
    padding: 16px 36px;
    border-bottom: 1px solid var(--border);
    backdrop-filter: blur(20px);
    background: rgba(1,26,46,0.8);
    position: sticky; top: 0; z-index: 100;
  }
  .topbar-inner {
    display: flex; align-items: center; justify-content: space-between;
    max-width: 1050px; margin: 0 auto; width: 100%;
  }
  .topbar-left { display: flex; align-items: center; gap: 16px; }
  .ndi-logo { height: 30px; opacity: 0.95; }
  .topbar-divider { width: 1px; height: 20px; background: var(--border); }
  .topbar-attribution {
    display: flex; align-items: center; gap: 8px;
    text-decoration: none;
  }
  .topbar-attribution-text {
    font-family: 'DM Mono', monospace; font-size: 9px;
    color: var(--text-tertiary); letter-spacing: 1.5px;
    font-weight: 600; text-transform: uppercase;
  }
  .topbar-attribution-logo { height: 18px; opacity: 0.7; transition: opacity 0.2s; }
  .topbar-attribution:hover .topbar-attribution-logo { opacity: 1; }
  .topbar-attribution:hover .topbar-attribution-text { color: #c0d0dc; }
  .topbar-right { display: flex; align-items: center; gap: 16px; }
  .btn-partner {
    display: inline-flex; align-items: center; gap: 8px;
    padding: 0 18px; height: 38px; border-radius: 8px;
    background: var(--grey-1); color: var(--n-blue);
    font-family: 'Nunito Sans', sans-serif;
    font-size: 11px; font-weight: 800; letter-spacing: 0.8px;
    text-decoration: none; transition: all 0.2s;
  }
  .btn-partner:hover {
    background: #fff; color: var(--n-blue-deep);
    box-shadow: 0 2px 12px rgba(241,242,242,0.3);
    transform: translateY(-1px);
  }
  .sdvosb-logo { height: 24px; border-radius: 3px; flex-shrink: 0; }
  .btn-partner-divider {
    width: 1px; height: 14px; background: rgba(2,38,64,0.2);
  }
  .status-dot {
    width: 6px; height: 6px; border-radius: 50%;
    background: var(--success);
    box-shadow: 0 0 8px var(--success);
    animation: pulse-dot 2s ease-in-out infinite;
  }
  @keyframes pulse-dot {
    0%, 100% { opacity: 1; box-shadow: 0 0 8px var(--success); }
    50% { opacity: 0.5; box-shadow: 0 0 4px var(--success); }
  }

  /* ===== HERO (dark landing — compact) ===== */
  .hero {
    position: relative; overflow: hidden;
    padding: 64px 60px 56px;
    animation: fade-up 0.8s ease-out;
    display: flex; align-items: center;
    border-bottom: 1px solid var(--border);
  }
  .hero::before {
    content: '';
    position: absolute; inset: 0;
    background:
      radial-gradient(ellipse 50% 60% at 85% 40%, rgba(7,176,232,0.07) 0%, transparent 70%),
      radial-gradient(ellipse 30% 40% at 15% 70%, rgba(0,201,167,0.03) 0%, transparent 60%);
    pointer-events: none;
  }
  .hero-layout {
    position: relative; z-index: 1;
    display: flex; align-items: center; gap: 60px;
    max-width: 1050px; margin: 0 auto; width: 100%;
  }
  .hero-text { flex: 1; min-width: 0; }
  .hero-eyebrow {
    font-family: 'DM Mono', monospace; font-size: 11px;
    color: var(--text-secondary); letter-spacing: 2px; text-transform: uppercase;
    margin-bottom: 16px; font-weight: 600;
  }
  .hero h1 {
    font-size: clamp(36px, 5vw, 64px); font-weight: 900;
    color: #fff; letter-spacing: -1.5px; line-height: 1.05;
    margin-bottom: 8px;
  }
  .hero h1 span {
    background: linear-gradient(135deg, var(--d-blue), #00C9A7);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .hero-division {
    font-family: 'DM Mono', monospace; font-size: 11px;
    color: var(--d-blue); letter-spacing: 2px; font-weight: 700;
    margin-bottom: 24px; text-transform: uppercase;
  }
  .hero-desc {
    font-size: 16px; color: #c0d0dc; max-width: 480px;
    line-height: 1.8; margin-bottom: 32px;
  }
  .hero-desc strong { color: #fff; }
  .hero-ctas { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
  .hero-cta-primary {
    display: inline-flex; align-items: center; gap: 10px;
    padding: 14px 28px; border-radius: 10px;
    background: linear-gradient(135deg, var(--d-blue), var(--x-blue));
    color: #fff; text-decoration: none;
    font-family: 'Nunito Sans', sans-serif;
    font-size: 13px; font-weight: 800; letter-spacing: 1.5px;
    text-transform: uppercase; transition: all 0.3s;
    box-shadow: 0 4px 20px rgba(7,176,232,0.25);
  }
  .hero-cta-primary:hover {
    box-shadow: 0 8px 32px rgba(7,176,232,0.35), 0 0 60px rgba(7,176,232,0.1);
    transform: translateY(-2px);
  }
  .hero-cta-partner {
    display: inline-flex; align-items: center; gap: 8px;
    padding: 0 22px; height: 48px; border-radius: 10px;
    background: var(--grey-1); color: var(--n-blue);
    text-decoration: none;
    font-family: 'Nunito Sans', sans-serif;
    font-size: 11px; font-weight: 800; letter-spacing: 0.8px;
    text-transform: uppercase; transition: all 0.2s;
  }
  .hero-cta-partner:hover {
    background: #fff;
    box-shadow: 0 4px 16px rgba(241,242,242,0.3);
    transform: translateY(-2px);
  }
  .hero-cta-partner-divider {
    width: 1px; height: 16px; background: rgba(2,38,64,0.15);
  }
  .hero-cta-partner img { height: 22px; border-radius: 2px; }
  .hero-status-pill {
    display: inline-flex; align-items: center; gap: 8px;
    margin-bottom: 20px; padding: 6px 16px;
    border-radius: 50px;
    background: rgba(0,201,167,0.08);
    border: 1px solid rgba(0,201,167,0.2);
    font-family: 'DM Mono', monospace; font-size: 10px;
    color: var(--success); letter-spacing: 1px; font-weight: 700;
  }

  /* ===== HERO ROBOT GRAPHIC ===== */
  .hero-graphic {
    flex-shrink: 0; width: 320px; height: 320px;
    position: relative;
    display: flex; align-items: center; justify-content: center;
  }
  /* Hexagonal glow backdrop */
  .hero-hex-glow {
    position: absolute; inset: -10px;
    background:
      radial-gradient(circle at 50% 50%, rgba(7,176,232,0.12) 0%, transparent 60%);
    filter: blur(40px);
    animation: hex-pulse 5s ease-in-out infinite;
  }
  @keyframes hex-pulse {
    0%, 100% { opacity: 0.6; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.08); }
  }
  /* Concentric rings — dashed for tech feel */
  .hero-ring {
    position: absolute; border-radius: 50%;
    border: 1px dashed rgba(7,176,232,0.1);
  }
  .hero-ring-1 { inset: 40px; border-style: solid; border-color: rgba(7,176,232,0.15); }
  .hero-ring-2 { inset: 10px; animation: ring-rotate 40s linear infinite; }
  .hero-ring-3 { inset: -20px; border-color: rgba(7,176,232,0.06); animation: ring-rotate 60s linear infinite reverse; }
  @keyframes ring-rotate { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  /* Orbiting nodes on ring 2 */
  .hero-ring-2::before, .hero-ring-2::after {
    content: ''; position: absolute;
    width: 8px; height: 8px; border-radius: 50%;
    background: var(--d-blue);
    box-shadow: 0 0 16px rgba(7,176,232,0.7), 0 0 4px rgba(7,176,232,0.9);
  }
  .hero-ring-2::before { top: -4px; left: 50%; transform: translateX(-50%); }
  .hero-ring-2::after { bottom: -4px; left: 50%; transform: translateX(-50%); background: var(--success); box-shadow: 0 0 16px rgba(0,201,167,0.6); }
  /* Corner brackets (tech HUD feel) */
  .hero-bracket {
    position: absolute; width: 20px; height: 20px;
    border-color: rgba(7,176,232,0.25); border-style: solid; border-width: 0;
  }
  .hero-bracket-tl { top: 30px; left: 30px; border-top-width: 1.5px; border-left-width: 1.5px; }
  .hero-bracket-tr { top: 30px; right: 30px; border-top-width: 1.5px; border-right-width: 1.5px; }
  .hero-bracket-bl { bottom: 30px; left: 30px; border-bottom-width: 1.5px; border-left-width: 1.5px; }
  .hero-bracket-br { bottom: 30px; right: 30px; border-bottom-width: 1.5px; border-right-width: 1.5px; }
  /* Robot image */
  .hero-robot-container {
    position: relative; z-index: 2;
    width: 180px; height: 180px;
  }
  .hero-robot-container img {
    width: 100%; height: 100%; object-fit: contain;
    filter: drop-shadow(0 0 30px rgba(7,176,232,0.25)) drop-shadow(0 12px 40px rgba(0,0,0,0.3));
    animation: robot-float 6s ease-in-out infinite;
  }
  @keyframes robot-float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }
  /* Status readout under robot */
  .hero-robot-status {
    position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
    z-index: 3;
    font-family: 'DM Mono', monospace; font-size: 9px;
    color: var(--d-blue); letter-spacing: 2px;
    text-transform: uppercase; white-space: nowrap;
    opacity: 0.6;
  }
  /* Scan line */
  .hero-scan-line {
    position: absolute; z-index: 1;
    width: 200px; height: 1px; left: 50%; transform: translateX(-50%);
    background: linear-gradient(90deg, transparent, rgba(7,176,232,0.3), transparent);
    animation: scan-sweep 5s ease-in-out infinite;
  }
  @keyframes scan-sweep {
    0%, 100% { top: 35%; opacity: 0; }
    15% { opacity: 1; }
    50% { top: 65%; opacity: 0.8; }
    85% { opacity: 0; }
  }

  /* ===== MAIN CONTENT ===== */
  .main { max-width: 1050px; margin: 0 auto; padding: 48px 24px 80px; }

  /* ===== NO-CLOUD ICON (replaces "Free Forever") ===== */
  .no-cloud-icon {
    display: inline-block; position: relative;
    width: 22px; height: 18px; vertical-align: -3px; margin-right: 4px;
  }
  .no-cloud-icon svg { width: 100%; height: 100%; }


  /* ===== DROP ZONE ===== */
  .drop-zone {
    position: relative;
    border: 1.5px dashed var(--border-hover);
    border-radius: var(--radius-lg);
    padding: 60px 32px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background: var(--surface-1);
    overflow: hidden;
    animation: fade-up 0.8s ease-out 0.2s both;
  }
  .drop-zone::before {
    content: ''; position: absolute; inset: 0;
    border-radius: var(--radius-lg);
    background: radial-gradient(ellipse at center, var(--d-blue-glow) 0%, transparent 70%);
    opacity: 0; transition: opacity 0.4s;
  }
  .drop-zone:hover, .drop-zone.dragover {
    border-color: var(--d-blue);
    background: var(--surface-2);
  }
  .drop-zone:hover::before, .drop-zone.dragover::before { opacity: 1; }
  .drop-zone input {
    position: absolute; inset: 0; opacity: 0; cursor: pointer; z-index: 2;
  }
  .drop-icon {
    position: relative; z-index: 1;
    width: 56px; height: 56px; margin: 0 auto 20px;
    border-radius: 12px;
    background: var(--surface-2);
    border: 1px solid var(--border);
    display: flex; align-items: center; justify-content: center;
    transition: all 0.3s;
  }
  .drop-zone:hover .drop-icon {
    border-color: var(--d-blue);
    box-shadow: 0 0 20px var(--d-blue-glow);
  }
  .drop-icon svg { width: 24px; height: 24px; }
  .drop-title {
    position: relative; z-index: 1;
    font-size: 20px; font-weight: 800; color: #fff; margin-bottom: 8px;
  }
  .drop-sub {
    position: relative; z-index: 1;
    font-size: 15px; color: #c0d0dc; font-weight: 500;
  }
  .drop-formats {
    position: relative; z-index: 1;
    display: flex; gap: 8px; justify-content: center; margin-top: 20px;
    flex-wrap: wrap;
  }
  .format-chip {
    font-family: 'DM Mono', monospace; font-size: 13px;
    padding: 8px 16px; border-radius: 6px;
    letter-spacing: 0.5px; font-weight: 500;
  }
  .format-chip-pdf { background: rgba(220,53,69,0.12); border: 1px solid rgba(220,53,69,0.3); color: #e85d6f; }
  .format-chip-docx { background: rgba(43,87,154,0.12); border: 1px solid rgba(43,87,154,0.3); color: #5b9aed; }
  .format-chip-pptx { background: rgba(209,105,46,0.12); border: 1px solid rgba(209,105,46,0.3); color: #e8874a; }
  .format-chip-xlsx { background: rgba(33,115,70,0.12); border: 1px solid rgba(33,115,70,0.3); color: #3dbf6e; }
  .format-chip-csv { background: rgba(130,150,50,0.12); border: 1px solid rgba(130,150,50,0.3); color: #a8b84a; }
  .format-chip-txt { background: rgba(140,140,140,0.12); border: 1px solid rgba(140,140,140,0.3); color: #a0a0a0; }

  /* ===== FILE LIST ===== */
  .file-list { margin-top: 20px; }
  .file-item {
    display: flex; align-items: center; justify-content: space-between;
    padding: 12px 16px; margin-bottom: 4px;
    background: var(--surface-1);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    transition: all 0.2s;
    animation: fade-up 0.25s ease-out;
  }
  .file-item:hover { border-color: var(--border-hover); }
  .file-info { display: flex; align-items: center; gap: 12px; min-width: 0; }
  .file-ext {
    font-family: 'DM Mono', monospace; font-size: 9px; font-weight: 600;
    padding: 4px 8px; border-radius: 4px; letter-spacing: 0.8px;
    text-transform: uppercase; flex-shrink: 0;
  }
  .file-name {
    font-size: 15px; font-weight: 700; color: #fff;
    overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
  }
  .file-meta { display: flex; align-items: center; gap: 12px; flex-shrink: 0; }
  .file-size {
    font-family: 'DM Mono', monospace; font-size: 13px; color: #c0d0dc;
  }
  .file-remove {
    width: 24px; height: 24px; border-radius: 4px;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; color: var(--text-tertiary);
    transition: all 0.15s; border: none; background: transparent;
    font-size: 14px; font-family: inherit;
  }
  .file-remove:hover { color: var(--danger); background: rgba(255,107,107,0.1); }

  /* ===== STAGED INFO ===== */
  .staged-bar {
    display: none;
    justify-content: space-between; align-items: center;
    margin-top: 16px; padding: 14px 18px;
    background: var(--surface-1);
    border: 1px solid var(--border);
    border-radius: var(--radius);
  }
  .staged-bar.visible { display: flex; }
  .staged-text {
    font-family: 'DM Mono', monospace; font-size: 14px; color: #c0d0dc; font-weight: 500;
  }
  .staged-count { color: var(--d-blue); font-weight: 500; }
  .staged-actions { display: flex; align-items: center; gap: 8px; }
  .btn-sort, .btn-clear-all {
    display: inline-flex; align-items: center; gap: 6px;
    padding: 6px 14px; border-radius: 6px;
    background: rgba(140,140,140,0.1); border: 1px solid rgba(140,140,140,0.2);
    color: #8fa4b3; font-family: 'DM Mono', monospace;
    font-size: 11px; font-weight: 600; letter-spacing: 0.5px;
    cursor: pointer; transition: all 0.2s;
  }
  .btn-sort:hover {
    background: rgba(7,176,232,0.1); border-color: rgba(7,176,232,0.3);
    color: var(--d-blue);
  }
  .btn-sort.active {
    background: rgba(7,176,232,0.08); border-color: rgba(7,176,232,0.25);
    color: var(--d-blue);
  }
  .btn-clear-all:hover {
    background: rgba(255,107,107,0.1); border-color: rgba(255,107,107,0.3);
    color: var(--danger);
  }

  /* ===== BUTTON ===== */
  .btn-process-wrap { position: relative; margin-top: 24px; }
  .btn-process {
    width: 100%; height: 64px;
    border: none; border-radius: 10px;
    font-family: 'Nunito Sans', sans-serif;
    font-size: 16px; font-weight: 900; letter-spacing: 2.5px;
    text-transform: uppercase; cursor: pointer;
    color: #fff;
    background: linear-gradient(135deg, var(--x-blue), var(--n-blue));
    position: relative; overflow: hidden;
    transition: all 0.3s;
    box-shadow: 0 4px 16px rgba(7,176,232,0.2);
  }
  .btn-process .btn-label { position: relative; z-index: 2; transition: opacity 0.3s; }
  .btn-process::before {
    content: ''; position: absolute; inset: 0;
    background: linear-gradient(135deg, var(--d-blue-hover), var(--d-blue));
    opacity: 0; transition: opacity 0.3s;
  }
  .btn-process:hover::before { opacity: 1; }
  .btn-process:hover {
    box-shadow: 0 4px 24px rgba(7,176,232,0.3), 0 0 60px rgba(7,176,232,0.1);
    transform: translateY(-1px);
  }
  .btn-process:disabled {
    opacity: 0.25; cursor: not-allowed; transform: none;
    box-shadow: none;
  }
  .btn-process:disabled::before { display: none; }
  .btn-process.processing {
    cursor: default; pointer-events: none;
    background: var(--surface-1); border: 1px solid var(--border);
    box-shadow: none;
  }
  .btn-process.processing::before { display: none; }
  .btn-process.processing .btn-label { opacity: 0; }

  /* Laser fill overlay */
  .btn-laser {
    position: absolute; top: 0; left: 0; bottom: 0; width: 0%;
    background: linear-gradient(90deg, var(--d-blue) 0%, #0ad4ff 70%, #5de8ff 100%);
    border-radius: 10px 0 0 10px;
    z-index: 1;
    box-shadow: 4px 0 24px rgba(7,176,232,0.5), 0 0 40px rgba(7,176,232,0.15);
  }
  .btn-laser::after {
    content: ''; position: absolute; top: 0; right: -2px; bottom: 0; width: 6px;
    background: #fff; border-radius: 0 1px 1px 0;
    box-shadow: 0 0 16px rgba(255,255,255,0.9), 0 0 40px rgba(7,176,232,0.8);
    opacity: 0.9;
  }

  /* Rolling status text */
  .process-status {
    position: absolute; inset: 0; z-index: 2;
    display: flex; align-items: center; justify-content: center;
    font-family: 'DM Mono', monospace; font-size: 13px; font-weight: 600;
    color: rgba(255,255,255,0.95); letter-spacing: 0.8px;
    pointer-events: none;
  }
  .process-status span {
    animation: status-roll 0.4s ease-out;
  }
  @keyframes status-roll {
    from { opacity: 0; transform: translateY(12px); filter: blur(2px); }
    to { opacity: 1; transform: translateY(0); filter: blur(0); }
  }

  /* Done state */
  .btn-process.done {
    background: var(--success); cursor: default; pointer-events: none;
    box-shadow: 0 4px 20px rgba(46,204,113,0.3);
  }
  .btn-process.done::before { display: none; }
  .btn-process.done .btn-label { opacity: 1; }

  /* ===== RESULT ===== */
  .result-section { display: none; margin-top: 8px; }
  .result-section.visible { display: block; animation: fade-up 0.4s ease-out; }
  .result-actions { display: flex; gap: 6px; width: 100%; }
  .btn-action {
    display: inline-flex; align-items: center; justify-content: center; gap: 8px;
    height: 42px;
    font-family: 'DM Mono', monospace;
    font-size: 11px; font-weight: 600; letter-spacing: 0.5px;
    cursor: pointer;
    transition: all 0.2s;
    background: rgba(7,176,232,0.06);
    border: 1px solid rgba(7,176,232,0.2);
    color: var(--d-blue);
    border-radius: 8px;
  }
  .btn-action:hover {
    background: rgba(7,176,232,0.12);
    border-color: rgba(7,176,232,0.35);
    color: #fff;
  }
  .btn-action-download { flex: 3; }
  .btn-action-copy { flex: 2; }

  /* ===== PROMPT SECTION ===== */
  .prompt-section {
    margin-top: 40px; padding-top: 32px;
    border-top: 1px solid var(--border);
    animation: fade-up 0.8s ease-out 0.3s both;
  }
  .section-header {
    display: flex; align-items: center; justify-content: space-between;
    margin-bottom: 16px; flex-wrap: wrap; gap: 8px;
  }
  .section-title {
    font-size: 12px; font-weight: 700; color: var(--text-secondary);
    text-transform: uppercase; letter-spacing: 1.5px;
  }
  .section-badge {
    font-family: 'DM Mono', monospace; font-size: 9px;
    padding: 3px 8px; border-radius: 3px;
    background: var(--success-bg); border: 1px solid var(--success-border);
    color: var(--success); letter-spacing: 0.8px;
  }
  .prompt-box {
    background: var(--surface-0);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px;
    font-family: 'DM Mono', monospace; font-size: 11.5px;
    color: var(--text-tertiary); line-height: 1.7;
    max-height: 180px; overflow-y: auto;
    white-space: pre-wrap; word-break: break-word;
  }
  .prompt-box::-webkit-scrollbar { width: 4px; }
  .prompt-box::-webkit-scrollbar-track { background: transparent; }
  .prompt-box::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  .super-prompt-hint {
    font-family: 'DM Mono', monospace; font-size: 11px;
    color: var(--text-tertiary); letter-spacing: 0.3px;
  }

  /* ===== WORKS WITH MARQUEE ===== */
  .works-with {
    margin-top: 24px; padding-top: 20px;
    border-top: 1px solid var(--border);
  }
  .works-with-label {
    font-family: 'DM Mono', monospace; font-size: 13px;
    color: #c0d0dc; text-transform: uppercase;
    letter-spacing: 1.5px; margin-bottom: 14px; font-weight: 600;
  }
  .marquee-mask {
    overflow: hidden;
    -webkit-mask-image: linear-gradient(90deg, transparent 0%, black 8%, black 92%, transparent 100%);
    mask-image: linear-gradient(90deg, transparent 0%, black 8%, black 92%, transparent 100%);
  }
  .marquee-track {
    display: flex; gap: 10px;
    width: max-content;
    animation: marquee-scroll 35s linear infinite;
  }
  .marquee-track:hover { animation-play-state: paused; }
  @keyframes marquee-scroll {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }
  .ai-logo-chip {
    display: inline-flex; align-items: center; gap: 7px;
    padding: 8px 14px; border-radius: 6px;
    background: var(--surface-1);
    border: 1px solid var(--border);
    font-size: 13px; font-weight: 700; color: #c0d0dc;
    transition: all 0.2s;
    white-space: nowrap; flex-shrink: 0;
  }
  .marquee-track:hover .ai-logo-chip { border-color: var(--border-hover); }
  .ai-logo-chip img {
    width: 16px; height: 16px; border-radius: 3px;
    object-fit: contain;
  }

  /* ===== SUPERPROMPT HERO ===== */
  .sp-hero {
    position: relative; overflow: hidden;
    background: #fff;
    border-top: 3px solid var(--d-blue);
    border-bottom: 3px solid var(--d-blue);
    margin-top: 56px;
    padding: 64px 32px;
    text-align: center;
    animation: fade-up 0.8s ease-out 0.2s both;
  }
  .sp-hero-glow {
    position: absolute; top: 0; left: 0; right: 0; height: 3px;
    background: linear-gradient(90deg, transparent, var(--d-blue), var(--success), var(--d-blue), transparent);
    background-size: 200% 100%;
    animation: glow-sweep 4s ease-in-out infinite;
  }
  .sp-hero-content { position: relative; z-index: 1; max-width: 1050px; margin: 0 auto; }
  .sp-hero-badge {
    display: inline-block;
    font-family: 'DM Mono', monospace; font-size: 12px;
    color: var(--d-blue); letter-spacing: 3px; text-transform: uppercase;
    font-weight: 700; margin-bottom: 20px;
    padding: 6px 16px; border-radius: 50px;
    border: 1.5px solid var(--d-blue);
    background: rgba(7,176,232,0.06);
  }
  .sp-hero-title {
    font-size: clamp(32px, 5vw, 52px); font-weight: 900;
    color: var(--n-blue); letter-spacing: -1px; line-height: 1.1;
    margin-bottom: 18px;
  }
  .sp-hero-title span {
    background: linear-gradient(135deg, var(--d-blue), #00C9A7);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .sp-hero-sub {
    font-size: 18px; color: #3a5568; max-width: 580px;
    margin: 0 auto; line-height: 1.7;
  }
  .sp-hero-stats {
    display: inline-flex; align-items: center; gap: 24px;
    margin-top: 28px; padding: 16px 32px;
    background: var(--n-blue); border-radius: 12px;
    box-shadow: 0 4px 20px rgba(2,38,64,0.3);
  }
  .sp-hero-stat { text-align: center; }
  .sp-hero-stat-value {
    display: block; font-family: 'DM Mono', monospace;
    font-size: 20px; font-weight: 700; color: #fff; letter-spacing: 0.5px;
  }
  .sp-hero-stat-label {
    display: block; font-size: 11px; color: rgba(255,255,255,0.6);
    text-transform: uppercase; letter-spacing: 1px; margin-top: 4px;
  }
  .sp-hero-stat-note {
    display: block; font-family: 'Nunito Sans', sans-serif;
    font-size: 9px; color: rgba(255,255,255,0.4);
    letter-spacing: 0.5px; margin-top: 2px; font-style: italic;
  }
  .sp-hero-stat-divider {
    width: 1px; height: 32px; background: rgba(255,255,255,0.15);
  }

  /* ===== NDi SUPER PROMPT™ ===== */
  .super-prompt-section {
    margin-top: 48px; padding-top: 40px;
    border-top: 1px solid var(--border);
    animation: fade-up 0.8s ease-out 0.3s both;
  }
  .super-prompt-header {
    display: flex; align-items: center; gap: 16px;
    margin-bottom: 24px; justify-content: space-between;
  }
  .super-prompt-header-left {
    display: flex; align-items: center; gap: 16px;
  }
  .super-prompt-icon {
    width: 52px; height: 52px; border-radius: 12px;
    background: linear-gradient(135deg, rgba(7,176,232,0.15), rgba(0,56,103,0.2));
    border: 1px solid var(--border-hover);
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
  }
  .super-prompt-title {
    font-size: 26px; font-weight: 900; color: #fff;
    letter-spacing: -0.3px;
  }
  .super-prompt-sub {
    font-size: 15px; color: #c0d0dc; margin-top: 4px; font-weight: 500;
  }
  .super-prompt-card {
    position: relative;
    background: var(--surface-0);
    border: 1px solid var(--border-hover);
    border-radius: var(--radius-lg);
    overflow: hidden;
  }
  .super-prompt-glow {
    position: absolute; top: 0; left: 0; right: 0; height: 2px;
    background: linear-gradient(90deg, transparent, var(--d-blue), var(--success), var(--d-blue), transparent);
    background-size: 200% 100%;
    animation: glow-sweep 4s ease-in-out infinite;
  }
  @keyframes glow-sweep {
    0%, 100% { background-position: -200% 0; }
    50% { background-position: 200% 0; }
  }
  .super-prompt-content {
    padding: 24px;
    font-family: 'DM Mono', monospace; font-size: 13px;
    color: #c0d0dc; line-height: 1.8;
    max-height: 340px; overflow-y: auto;
    white-space: pre-wrap; word-break: break-word;
  }
  .super-prompt-content::-webkit-scrollbar { width: 4px; }
  .super-prompt-content::-webkit-scrollbar-track { background: transparent; }
  .super-prompt-content::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
  .super-prompt-actions {
    display: flex; align-items: center; gap: 16px;
    margin-top: 16px; flex-wrap: wrap;
  }
  .btn-action-primary {
    background: linear-gradient(135deg, var(--d-blue), var(--x-blue));
    border: none; color: #fff;
  }
  .btn-action-primary:hover {
    background: linear-gradient(135deg, var(--d-blue-hover), var(--d-blue));
    border: none; color: #fff;
  }
  .btn-super {
    padding: 0 28px !important; height: 48px !important;
    font-size: 13px !important;
    box-shadow: 0 0 20px rgba(7,176,232,0.15);
  }
  .btn-super:hover {
    box-shadow: 0 0 30px rgba(7,176,232,0.3) !important;
  }
  .super-prompt-hint {
    font-family: 'DM Mono', monospace; font-size: 11px;
    color: var(--text-tertiary); letter-spacing: 0.3px;
  }

  /* ===== RAVEN CTA ===== */
  .raven-cta-wrap {
    padding: 56px 24px;
    background: #ffffff;
  }
  .raven-cta {
    max-width: 1050px; margin: 0 auto;
    display: flex; align-items: center; gap: 40px;
  }
  .raven-cta-text {
    text-align: left;
    flex: 2;
    min-width: 0;
  }
  .raven-cta-title {
    font-size: 30px; font-weight: 900; color: #1a1a1a;
    letter-spacing: -0.5px; margin-bottom: 8px; line-height: 1.15;
  }
  .raven-cta-desc {
    font-size: 14px; color: #555; line-height: 1.7;
  }
  .raven-cta-icon {
    flex-shrink: 0;
    width: 96px; height: 96px; border-radius: 20px;
    object-fit: contain;
    filter: drop-shadow(0 4px 12px rgba(0,0,0,0.12));
  }
  .raven-cta-action {
    flex-shrink: 0;
    display: flex; flex-direction: column;
    align-items: center; gap: 0;
  }
  .raven-cta-action-link {
    display: flex; flex-direction: column;
    align-items: center; gap: 0;
    text-decoration: none; color: inherit;
    transition: transform 0.3s ease;
    cursor: pointer;
  }
  .raven-cta-action-link:hover {
    transform: translateY(-3px);
  }
  .raven-cta-action-link:hover .raven-cta-social {
    box-shadow: 0 12px 40px rgba(0,0,0,0.28), 0 4px 12px rgba(0,0,0,0.12);
  }
  .raven-cta-action-link:hover .raven-cta-btn {
    background: #000;
    box-shadow: 0 8px 28px rgba(0,0,0,0.25);
  }
  .raven-cta-social {
    width: 240px;
    border-radius: 14px 14px 0 0;
    object-fit: cover;
    box-shadow: 0 8px 32px rgba(0,0,0,0.2), 0 2px 8px rgba(0,0,0,0.08);
    transition: box-shadow 0.3s ease;
  }
  .raven-cta-btn {
    width: 240px; box-sizing: border-box;
    display: flex; align-items: center; justify-content: center; gap: 10px;
    padding: 13px 28px;
    border-radius: 0 0 14px 14px;
    background: #1a1a1a; color: #fff;
    font-family: 'Nunito Sans', sans-serif;
    font-size: 11px; font-weight: 800; letter-spacing: 1.5px;
    text-transform: uppercase; transition: all 0.3s;
    box-shadow: 0 8px 32px rgba(0,0,0,0.2), 0 2px 8px rgba(0,0,0,0.08);
  }
  @media (max-width: 768px) {
    .raven-cta { flex-direction: column; gap: 28px; text-align: center; }
    .raven-cta-icon { width: 72px; height: 72px; }
    .raven-cta-text { text-align: center; }
    .raven-cta-desc { margin: 0 auto; }
  }

  /* ===== FOOTER ===== */
  .footer {
    border-top: 1px solid var(--border);
    background: var(--surface-0);
    padding: 0;
  }
  .footer-inner {
    max-width: 1050px; margin: 0 auto;
    padding: 56px 32px 0;
  }
  /* Certification logos bar — full width above bottom */
  .footer-certs {
    display: flex; align-items: center; justify-content: center;
    padding: 16px 0;
  }
  .footer-certs img {
    width: 100%; max-width: 100%; height: auto;
    object-fit: contain;
    opacity: 0.85; transition: opacity 0.2s;
  }
  .footer-certs img:hover { opacity: 1; }
  /* Main footer grid */
  .footer-grid {
    display: grid;
    grid-template-columns: 1.4fr 1fr 1fr 1fr;
    gap: 40px;
    padding-bottom: 48px;
    border-bottom: 1px solid var(--border);
  }
  .footer-brand-logo { height: 28px; margin-bottom: 16px; opacity: 0.9; }
  .footer-brand-desc {
    font-size: 13px; color: #8fa4b3; line-height: 1.75; margin-bottom: 20px;
  }
  .footer-sdvosb {
    display: inline-flex; align-items: center; gap: 8px;
    font-family: 'DM Mono', monospace; font-size: 10px;
    color: var(--success); letter-spacing: 1px;
    text-transform: uppercase; font-weight: 700;
  }
  .footer-sdvosb-dot {
    width: 6px; height: 6px; border-radius: 50%;
    background: var(--success); box-shadow: 0 0 6px var(--success);
  }
  .footer-col-title {
    font-family: 'DM Mono', monospace; font-size: 10px;
    color: var(--d-blue); letter-spacing: 2px;
    text-transform: uppercase; font-weight: 700;
    margin-bottom: 20px;
  }
  .footer-links { list-style: none; }
  .footer-links li { margin-bottom: 10px; }
  .footer-links a {
    font-size: 13px; color: #8fa4b3; text-decoration: none;
    transition: color 0.2s; letter-spacing: 0.2px;
  }
  .footer-links a:hover { color: #fff; }
  .footer-contact-item {
    font-size: 13px; color: #8fa4b3; margin-bottom: 10px;
    line-height: 1.6;
  }
  .footer-contact-item strong { color: #c0d0dc; font-weight: 700; }
  .footer-contact-item a { color: var(--d-blue); text-decoration: none; }
  .footer-contact-item a:hover { text-decoration: underline; }
  /* Social */
  .footer-social {
    display: flex; gap: 10px; margin-top: 16px;
  }
  .footer-social a {
    display: flex; align-items: center; justify-content: center;
    width: 36px; height: 36px; border-radius: 8px;
    background: rgba(7,176,232,0.06);
    border: 1px solid var(--border);
    color: #8fa4b3; transition: all 0.2s;
  }
  .footer-social a:hover {
    border-color: var(--d-blue); color: var(--d-blue);
    background: rgba(7,176,232,0.1);
  }
  /* Bottom bar */
  .footer-bottom {
    display: flex; justify-content: space-between; align-items: center;
    padding: 20px 0;
    font-size: 12px; color: #5a6f7e; letter-spacing: 0.3px;
  }
  .footer-bottom a { color: #8fa4b3; text-decoration: none; transition: color 0.2s; }
  .footer-bottom a:hover { color: var(--d-blue); }
  .footer-bottom-links { display: flex; gap: 20px; }

  @media (max-width: 768px) {
    .footer-grid { grid-template-columns: 1fr; gap: 32px; }
    .footer-bottom { flex-direction: column; gap: 8px; text-align: center; }
    .footer-certs { flex-wrap: wrap; gap: 16px; }
  }

  /* ===== FORGE HERO ===== */
  .forge-hero {
    position: relative; overflow: hidden;
    background: #fff;
    border-top: 3px solid #F8B42C;
    border-bottom: 3px solid #F8B42C;
    padding: 64px 32px;
    text-align: center;
  }
  .forge-hero-glow {
    position: absolute; top: 0; left: 0; right: 0; height: 3px;
    background: linear-gradient(90deg, transparent, #F8B42C, #ff6b3d, #F8B42C, transparent);
    background-size: 200% 100%;
    animation: glow-sweep 4s ease-in-out infinite;
  }
  .forge-hero-content { position: relative; z-index: 1; max-width: 1050px; margin: 0 auto; }
  .forge-hero-badge {
    display: inline-block;
    font-family: 'DM Mono', monospace; font-size: 12px;
    color: #F8B42C; letter-spacing: 3px; text-transform: uppercase;
    font-weight: 700; margin-bottom: 20px;
    padding: 6px 16px; border-radius: 50px;
    border: 1.5px solid #F8B42C;
    background: rgba(248,180,44,0.06);
  }
  .forge-hero-title {
    font-size: clamp(32px, 5vw, 52px); font-weight: 900;
    color: #111; letter-spacing: -1px; line-height: 1.1;
    margin-bottom: 18px;
  }
  .forge-hero-title span {
    color: #F8B42C;
  }
  .forge-hero-sub {
    font-size: 18px; color: #444; max-width: 580px;
    margin: 0 auto; line-height: 1.7;
  }
  .forge-hero-sub strong { color: #111; }
  .forge-hero-stats {
    display: inline-flex; align-items: center; gap: 24px;
    margin-top: 28px; padding: 16px 32px;
    background: #111; border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
  }
  .forge-hero-stat { text-align: center; }
  .forge-hero-stat-value {
    display: block; font-family: 'DM Mono', monospace;
    font-size: 20px; font-weight: 700; color: #F8B42C; letter-spacing: 0.5px;
  }
  .forge-hero-stat-label {
    display: block; font-size: 11px; color: rgba(255,255,255,0.6);
    text-transform: uppercase; letter-spacing: 1px; margin-top: 4px;
  }
  .forge-hero-stat-divider {
    width: 1px; height: 32px; background: rgba(255,255,255,0.15);
  }

  /* ===== RAVEN FORGE ===== */
  .forge-wrap {
    background: #fff;
    padding: 48px 24px 40px;
  }
  .forge {
    max-width: 1050px; margin: 0 auto;
    height: 600px;
    display: flex; flex-direction: column;
    background: #1e1e1e;
    border-radius: 14px;
    overflow: hidden;
    border: 1px solid rgba(255,255,255,0.06);
    box-shadow: 0 8px 40px rgba(0,0,0,0.18), 0 2px 10px rgba(0,0,0,0.08);
  }
  .forge-head {
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 18px; height: 44px; flex-shrink: 0;
    border-bottom: 1px solid rgba(255,255,255,0.08);
    background: #181818;
  }
  .forge-head-left { display: flex; align-items: center; gap: 10px; }
  .forge-head-icon { width: 20px; height: 20px; border-radius: 5px; }
  .forge-head-title {
    font-family: 'DM Mono', monospace; font-size: 11px; font-weight: 700;
    color: #d0d0d0; letter-spacing: 2px; text-transform: uppercase;
  }
  .forge-head-right { display: flex; align-items: center; gap: 10px; }
  .forge-pill {
    font-family: 'DM Mono', monospace; font-size: 9px; font-weight: 700;
    color: #F8B42C; letter-spacing: 1.5px; text-transform: uppercase;
    padding: 3px 8px; border-radius: 4px;
    border: 1px solid rgba(248,180,44,0.35);
    background: rgba(248,180,44,0.08);
  }
  .forge-gear {
    background: none; border: none; color: #666; cursor: pointer;
    padding: 4px; border-radius: 4px; transition: color 0.2s;
    display: flex; align-items: center;
  }
  .forge-gear:hover { color: #bbb; }

  /* Chat */
  .forge-chat {
    flex: 1; overflow-y: auto; padding: 20px 18px;
    display: flex; flex-direction: column; gap: 16px;
    scroll-behavior: smooth;
  }
  .forge-chat::-webkit-scrollbar { width: 4px; }
  .forge-chat::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 2px; }
  .forge-welcome {
    flex: 1; display: flex; flex-direction: column;
    align-items: center; justify-content: center; gap: 12px;
  }
  .forge-welcome img { width: 48px; height: 48px; opacity: 0.3; border-radius: 12px; }
  .forge-welcome span {
    font-family: 'DM Mono', monospace; font-size: 12px;
    color: #666; letter-spacing: 0.5px;
  }
  .forge-msg { display: flex; gap: 8px; max-width: 85%; animation: fade-up 0.25s ease-out; }
  .forge-msg-ai { align-self: flex-start; }
  .forge-msg-user { align-self: flex-end; flex-direction: row-reverse; }
  .forge-msg-avatar {
    width: 20px; height: 20px; border-radius: 5px;
    flex-shrink: 0; margin-top: 11px; /* 10px bubble padding + 1px to center with first text line */
  }
  .forge-msg-user .forge-msg-avatar { display: none; }
  .forge-msg-bubble {
    padding: 10px 14px; border-radius: 12px;
    font-size: 13.5px; line-height: 1.6; color: #e0e0e0;
    word-break: break-word;
  }
  .forge-msg-ai .forge-msg-bubble {
    background: #2a2a2a;
    border: 1px solid rgba(255,255,255,0.05);
  }
  .forge-msg-user .forge-msg-bubble {
    background: #2f2a1e;
    border: 1px solid rgba(248,180,44,0.1);
    border-left: 2px solid rgba(248,180,44,0.4);
  }
  .forge-msg-bubble code {
    background: rgba(255,255,255,0.08); padding: 1px 5px;
    border-radius: 3px; font-family: 'DM Mono', monospace; font-size: 12px;
    color: #F8B42C;
  }
  .forge-msg-bubble pre {
    background: #161616; padding: 12px; border-radius: 8px;
    overflow-x: auto; margin: 8px 0; font-size: 12px;
    border: 1px solid rgba(255,255,255,0.08);
  }
  .forge-msg-bubble pre code { background: none; padding: 0; color: #ccc; }
  .forge-msg-bubble strong { color: #f0f0f0; }
  .forge-msg-bubble ul, .forge-msg-bubble ol { padding-left: 18px; margin: 6px 0; }
  .forge-msg-bubble li { margin: 3px 0; }
  /* Error bubble */
  .forge-error-details {
    margin-top: 10px; border: none; font-size: 11px;
  }
  .forge-error-details summary {
    cursor: pointer; color: #555; font-family: 'DM Mono', monospace;
    font-size: 10px; letter-spacing: 0.5px; user-select: none;
    padding: 4px 0;
  }
  .forge-error-details summary:hover { color: #888; }
  .forge-error-details pre {
    margin: 6px 0 0; padding: 10px; border-radius: 6px;
    background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.04);
    color: #555; font-family: 'DM Mono', monospace; font-size: 10px;
    line-height: 1.6; white-space: pre-wrap; word-break: break-all;
  }
  .forge-cursor {
    display: inline-block; width: 2px; height: 14px;
    background: #F8B42C; margin-left: 2px; vertical-align: text-bottom;
    animation: forge-blink 0.8s step-end infinite;
  }
  @keyframes forge-blink { 0%,100%{opacity:1} 50%{opacity:0} }
  .forge-sys {
    text-align: center; font-family: 'DM Mono', monospace;
    font-size: 11px; color: #666; letter-spacing: 0.3px;
    padding: 4px 0;
  }

  /* Input bar */
  .forge-input-wrap {
    flex-shrink: 0; position: relative;
    border-top: 1px solid rgba(255,255,255,0.08);
    background: #181818;
  }
  .forge-doc-drawer {
    max-height: 0; overflow: hidden;
    transition: max-height 0.3s ease;
    background: #161616;
    border-bottom: 1px solid rgba(255,255,255,0.06);
  }
  .forge-doc-drawer.open { max-height: 220px; overflow-y: auto; }
  .forge-doc-drawer::-webkit-scrollbar { width: 3px; }
  .forge-doc-drawer::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.06); border-radius: 2px; }
  .forge-doc-list { padding: 8px 14px; }
  .forge-doc-item {
    display: flex; align-items: center; gap: 8px;
    padding: 6px 0; font-size: 12px; color: #999;
  }
  .forge-doc-item + .forge-doc-item { border-top: 1px solid rgba(255,255,255,0.05); }
  .forge-doc-ext {
    font-family: 'DM Mono', monospace; font-size: 9px; font-weight: 600;
    padding: 2px 6px; border-radius: 3px; text-transform: uppercase;
    flex-shrink: 0;
  }
  .forge-doc-name {
    flex: 1; min-width: 0; overflow: hidden;
    text-overflow: ellipsis; white-space: nowrap;
    font-family: 'Nunito Sans', sans-serif; color: #bbb;
  }
  .forge-doc-size {
    font-family: 'DM Mono', monospace; font-size: 10px; color: #666;
    flex-shrink: 0;
  }
  .forge-doc-x {
    background: none; border: none; color: #555; cursor: pointer;
    font-size: 12px; padding: 2px 4px; border-radius: 3px; transition: color 0.2s;
  }
  .forge-doc-x:hover { color: #ff6b6b; }
  .forge-doc-actions {
    display: flex; gap: 4px; padding: 8px 14px;
    border-top: 1px solid rgba(255,255,255,0.06);
  }
  .forge-doc-btn {
    display: flex; align-items: center; justify-content: center; gap: 6px;
    height: 34px; border: none; border-radius: 6px; cursor: pointer;
    font-family: 'DM Mono', monospace; font-size: 10px; font-weight: 600;
    letter-spacing: 0.5px; text-transform: uppercase; transition: all 0.2s;
  }
  .forge-doc-clear {
    flex: 1; background: rgba(255,255,255,0.06); color: #666;
  }
  .forge-doc-clear:hover { background: rgba(255,107,107,0.12); color: #ff6b6b; }
  .forge-doc-upload {
    flex: 4; background: rgba(255,255,255,0.08); color: #999;
  }
  .forge-doc-upload:hover { background: rgba(255,255,255,0.12); color: #ccc; }

  .forge-bar {
    display: flex; align-items: flex-end; gap: 8px;
    padding: 12px 14px;
  }
  .forge-attach {
    background: none; border: none; color: #555; cursor: pointer;
    padding: 6px; border-radius: 6px; transition: color 0.2s;
    flex-shrink: 0; display: flex; align-items: center; position: relative;
  }
  .forge-attach:hover { color: #999; }
  .forge-attach-badge {
    position: absolute; top: 0; right: -2px;
    background: #F8B42C; color: #000; font-size: 8px; font-weight: 800;
    width: 14px; height: 14px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-family: 'DM Mono', monospace;
  }
  .forge-textarea {
    flex: 1; resize: none; border: none; outline: none;
    background: transparent; color: #ddd;
    font-family: 'Nunito Sans', sans-serif; font-size: 14px;
    line-height: 1.5; padding: 6px 0;
    max-height: 120px; /* ~6 lines */
  }
  .forge-textarea::placeholder { color: #555; }
  .forge-send {
    background: none; border: none; cursor: pointer;
    padding: 6px; border-radius: 6px; transition: all 0.2s;
    flex-shrink: 0; display: flex; align-items: center;
    color: #444;
  }
  .forge-send.active { color: #F8B42C; }
  .forge-send:disabled { opacity: 0.3; cursor: default; }

  /* Settings modal */
  .forge-modal-bg {
    display: none; position: fixed; inset: 0; z-index: 300;
    background: rgba(0,0,0,0.7); backdrop-filter: blur(4px);
    align-items: center; justify-content: center;
  }
  .forge-modal-bg.open { display: flex; }
  .forge-modal {
    background: #222; border: 1px solid rgba(255,255,255,0.1);
    border-radius: 14px; padding: 28px; width: 380px; max-width: 90vw;
  }
  .forge-modal h3 {
    font-family: 'DM Mono', monospace; font-size: 12px; font-weight: 700;
    color: #bbb; letter-spacing: 1.5px; text-transform: uppercase;
    margin: 0 0 20px;
  }
  .forge-modal label {
    display: block; font-family: 'DM Mono', monospace; font-size: 10px;
    color: #777; letter-spacing: 0.8px; text-transform: uppercase;
    margin: 14px 0 6px;
  }
  .forge-modal label:first-of-type { margin-top: 0; }
  .forge-modal input, .forge-modal select {
    width: 100%; box-sizing: border-box;
    padding: 8px 12px; border-radius: 6px;
    background: #1a1a1a; border: 1px solid rgba(255,255,255,0.1);
    color: #ddd; font-family: 'DM Mono', monospace; font-size: 12px;
    outline: none; transition: border-color 0.2s;
  }
  .forge-modal input:focus { border-color: rgba(248,180,44,0.3); }
  .forge-modal-close {
    margin-top: 20px; width: 100%; height: 36px;
    background: rgba(255,255,255,0.08); border: none; border-radius: 8px;
    color: #999; font-family: 'DM Mono', monospace; font-size: 11px;
    font-weight: 600; letter-spacing: 1px; text-transform: uppercase;
    cursor: pointer; transition: all 0.2s;
  }
  .forge-modal-close:hover { background: rgba(255,255,255,0.14); color: #ccc; }

  /* Forge Gate Overlay */
  .forge-gate {
    position: absolute; inset: 0; z-index: 10;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center; gap: 20px;
    background: rgba(20,20,20,0.88);
    backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
    border-radius: 14px;
    transition: opacity 0.4s ease, visibility 0.4s ease;
  }
  .forge-gate.dismissed { opacity: 0; visibility: hidden; pointer-events: none; }
  .forge-gate-icon { width: 44px; height: 44px; border-radius: 12px; opacity: 0.6; }
  .forge-gate-btn {
    display: inline-flex; align-items: center; gap: 10px;
    padding: 14px 32px; border-radius: 10px;
    background: #F8B42C; color: #000;
    border: none; cursor: pointer;
    font-family: 'Nunito Sans', sans-serif;
    font-size: 13px; font-weight: 800; letter-spacing: 1px;
    text-transform: uppercase;
    transition: all 0.25s;
    box-shadow: 0 4px 20px rgba(248,180,44,0.25);
  }
  .forge-gate-btn:hover {
    background: #f9c35a;
    box-shadow: 0 6px 28px rgba(248,180,44,0.35);
    transform: translateY(-1px);
  }
  .forge-gate-desc {
    font-family: 'DM Mono', monospace; font-size: 11px;
    color: #777; letter-spacing: 0.3px; text-align: center;
    max-width: 320px; line-height: 1.6;
  }
  .forge-gate-desc strong { color: #aaa; }
  .forge-gate-status {
    font-family: 'DM Mono', monospace; font-size: 11px;
    color: #F8B42C; letter-spacing: 0.3px;
    min-height: 16px; transition: opacity 0.3s;
  }
  .forge-gate-status.error { color: #ff6b6b; }
  .forge-gate-btn:disabled { opacity: 0.5; cursor: wait; }
  .forge-gate-btn .forge-gate-spinner {
    width: 14px; height: 14px; border: 2px solid rgba(0,0,0,0.15);
    border-top-color: #000; border-radius: 50%;
    animation: forge-spin 0.6s linear infinite; display: none;
  }
  .forge-gate-btn.loading .forge-gate-spinner { display: block; }
  .forge-gate-btn.loading svg { display: none; }
  @keyframes forge-spin { to { transform: rotate(360deg); } }

  @media (max-width: 768px) {
    .forge { height: 500px; }
    .forge-msg { max-width: 92%; }
    .forge-help-inner { flex-direction: column; text-align: center; }
    .forge-help-img { max-width: 260px; }
  }

  /* Forge Help */
  .forge-help {
    background: #fff;
    padding: 28px 24px 20px;
  }
  .forge-help-inner {
    max-width: 1050px; margin: 0 auto;
    display: flex; align-items: center; gap: 28px;
  }
  .forge-help-img {
    flex-shrink: 0; max-width: 280px; width: 100%;
    border-radius: 10px;
    border: 1px solid #e0e0e0;
    box-shadow: 0 2px 12px rgba(0,0,0,0.08);
  }
  .forge-help-text {
    flex: 1; min-width: 0;
  }
  .forge-help-title {
    font-family: 'DM Mono', monospace; font-size: 10px; font-weight: 700;
    color: #F8B42C; letter-spacing: 1.5px; text-transform: uppercase;
    margin-bottom: 8px;
  }
  .forge-help-desc {
    font-size: 13px; color: #666; line-height: 1.7;
    font-family: 'Nunito Sans', sans-serif;
  }
  .forge-help-desc strong { color: #333; }

  /* Forge tagline */
  .forge-tagline {
    background: #fff;
    padding: 20px 24px 48px; text-align: center;
  }
  .forge-tagline-text {
    max-width: 1050px; margin: 0 auto;
    font-family: 'DM Mono', monospace; font-size: 12px;
    color: #aaa; letter-spacing: 2px; text-transform: uppercase;
  }
  .forge-tagline-text span { color: #F8B42C; font-weight: 700; }
  .forge-tagline-text em { color: #888; font-style: normal; font-weight: 400; }

  /* ===== ANIMATIONS ===== */
  @keyframes fade-up {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* ===== TOAST ===== */
  .toast {
    position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%) translateY(80px);
    padding: 12px 24px; border-radius: var(--radius);
    background: var(--x-blue); border: 1px solid var(--border-hover);
    color: var(--white); font-size: 13px; font-weight: 600;
    box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    transition: transform 0.3s ease, opacity 0.3s ease, background 0.3s, border-color 0.3s;
    opacity: 0; z-index: 200;
  }
  .toast.visible { transform: translateX(-50%) translateY(0); opacity: 1; }
  .toast.raven-toast {
    background: #1a1a1a; border-color: rgba(248,180,44,0.35);
    color: #F8B42C;
    box-shadow: 0 8px 32px rgba(0,0,0,0.5), 0 0 0 1px rgba(248,180,44,0.08);
  }

  /* ===== FLOATING NAV ===== */
  .floating-nav {
    position: fixed; right: 20px; top: 120px;
    z-index: 99; display: flex; flex-direction: column; gap: 6px;
  }
  .floating-nav a {
    display: flex; align-items: center; gap: 10px;
    padding: 12px 18px; border-radius: 12px;
    background: rgba(2,38,64,0.95);
    backdrop-filter: blur(20px);
    border: 1.5px solid rgba(7,176,232,0.25);
    color: #fff; text-decoration: none;
    font-family: 'DM Mono', monospace; font-size: 11px;
    font-weight: 700; letter-spacing: 1px; text-transform: uppercase;
    transition: background 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease, transform 0.3s ease;
    white-space: nowrap;
    box-shadow: 0 4px 16px rgba(0,0,0,0.3);
  }
  .floating-nav a:hover {
    border-color: var(--d-blue);
    background: rgba(7,176,232,0.15);
    box-shadow: 0 8px 32px rgba(7,176,232,0.25);
    transform: translateX(-6px);
  }
  .floating-nav a.active {
    border-color: var(--d-blue);
    background: rgba(0,56,103,0.9);
    box-shadow: 0 4px 20px rgba(7,176,232,0.2);
  }
  .floating-nav a .nav-dot {
    width: 7px; height: 7px; border-radius: 50%;
    background: var(--d-blue); flex-shrink: 0;
    box-shadow: 0 0 8px rgba(7,176,232,0.6);
    transition: background 0.5s ease, box-shadow 0.5s ease, transform 0.3s ease;
  }
  .floating-nav a:hover .nav-dot,
  .floating-nav a.active .nav-dot {
    box-shadow: 0 0 12px rgba(7,176,232,0.9);
    transform: scale(1.3);
  }
  /* RAVEN mode — black & gold, smooth crossfade */
  .floating-nav.raven-mode a {
    background: rgba(18,18,18,0.95);
    border-color: rgba(248,180,44,0.25);
    box-shadow: 0 4px 16px rgba(0,0,0,0.4);
  }
  .floating-nav.raven-mode a:hover {
    border-color: #F8B42C;
    background: rgba(248,180,44,0.1);
    box-shadow: 0 8px 32px rgba(248,180,44,0.2);
  }
  .floating-nav.raven-mode a.active {
    border-color: rgba(248,180,44,0.5);
    background: rgba(30,25,15,0.95);
    box-shadow: 0 4px 20px rgba(248,180,44,0.15);
  }
  .floating-nav.raven-mode a .nav-dot {
    background: #F8B42C;
    box-shadow: 0 0 8px rgba(248,180,44,0.6);
  }
  .floating-nav.raven-mode a:hover .nav-dot,
  .floating-nav.raven-mode a.active .nav-dot {
    box-shadow: 0 0 12px rgba(248,180,44,0.9);
  }

  /* ===== SMARTDOC HERO ===== */
  .sd-hero {
    position: relative; overflow: hidden;
    background: #fff;
    border-top: 3px solid var(--d-blue);
    border-bottom: 3px solid var(--d-blue);
    padding: 64px 32px;
    text-align: center;
    animation: fade-up 0.8s ease-out 0.2s both;
  }
  .sd-hero-glow {
    position: absolute; top: 0; left: 0; right: 0; height: 3px;
    background: linear-gradient(90deg, transparent, var(--d-blue), var(--success), var(--d-blue), transparent);
    background-size: 200% 100%;
    animation: glow-sweep 4s ease-in-out infinite;
  }
  .sd-hero-content { position: relative; z-index: 1; max-width: 1050px; margin: 0 auto; }
  .sd-hero-badge {
    display: inline-block;
    font-family: 'DM Mono', monospace; font-size: 12px;
    color: var(--d-blue); letter-spacing: 3px; text-transform: uppercase;
    font-weight: 700; margin-bottom: 20px;
    padding: 6px 16px; border-radius: 50px;
    border: 1.5px solid var(--d-blue);
    background: rgba(7,176,232,0.06);
  }
  .sd-hero-title {
    font-size: clamp(32px, 5vw, 52px); font-weight: 900;
    color: var(--n-blue); letter-spacing: -1px; line-height: 1.1;
    margin-bottom: 18px;
  }
  .sd-hero-title span {
    background: linear-gradient(135deg, var(--d-blue), #00C9A7);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .sd-hero-sub {
    font-size: 18px; color: #3a5568; max-width: 580px;
    margin: 0 auto; line-height: 1.7;
  }
  .sd-hero-stats {
    display: inline-flex; align-items: center; gap: 24px;
    margin-top: 28px; padding: 16px 32px;
    background: var(--n-blue); border-radius: 12px;
    box-shadow: 0 4px 20px rgba(2,38,64,0.3);
  }
  .sd-hero-stat { text-align: center; }
  .sd-hero-stat-value {
    display: block; font-family: 'DM Mono', monospace;
    font-size: 20px; font-weight: 700; color: #fff; letter-spacing: 0.5px;
  }
  .sd-hero-stat-label {
    display: block; font-size: 11px; color: rgba(255,255,255,0.6);
    text-transform: uppercase; letter-spacing: 1px; margin-top: 4px;
  }
  .sd-hero-stat-divider {
    width: 1px; height: 32px; background: rgba(255,255,255,0.15);
  }

  /* ===== RESEARCH DIVISION SECTION ===== */
  .research-section {
    padding: 48px 32px;
    text-align: center;
    position: relative;
    overflow: hidden;
  }
  .research-section::before {
    content: '';
    position: absolute; inset: 0;
    background: radial-gradient(ellipse 70% 50% at 50% 30%, rgba(7,176,232,0.06) 0%, transparent 70%);
    pointer-events: none;
  }
  .research-content { position: relative; z-index: 1; max-width: 1050px; margin: 0 auto; }
  .research-badge {
    display: inline-block;
    font-family: 'DM Mono', monospace; font-size: 11px;
    color: var(--d-blue); letter-spacing: 3px; text-transform: uppercase;
    font-weight: 700; margin-bottom: 28px;
    padding: 8px 20px; border-radius: 50px;
    border: 1px solid rgba(7,176,232,0.3);
    background: rgba(7,176,232,0.06);
  }
  .research-title {
    font-size: clamp(28px, 4vw, 44px); font-weight: 900;
    color: #fff; letter-spacing: -0.5px; line-height: 1.2;
    margin-bottom: 24px;
  }
  .research-title span { color: var(--d-blue); }
  .research-desc {
    font-size: 17px; color: #c0d0dc; line-height: 1.8;
    max-width: 640px; margin: 0 auto 36px;
  }
  .research-cards {
    display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;
    max-width: 1050px; margin: 0 auto;
  }
  .research-card {
    padding: 28px 20px; border-radius: 12px;
    background: rgba(7,176,232,0.04);
    border: 1px solid var(--border);
    transition: all 0.3s;
  }
  .research-card:hover {
    border-color: var(--border-hover);
    background: rgba(7,176,232,0.07);
    transform: translateY(-2px);
  }
  .research-card-icon {
    font-size: 28px; margin-bottom: 12px;
  }
  .research-card-title {
    font-size: 14px; font-weight: 800; color: #fff;
    letter-spacing: 0.3px; margin-bottom: 8px;
  }
  .research-card-desc {
    font-size: 13px; color: #8fa4b3; line-height: 1.6;
  }

  /* ===== RESPONSIVE ===== */
  @media (max-width: 900px) {
    .hero { padding: 48px 24px 40px; }
    .hero-layout { flex-direction: column; gap: 32px; text-align: center; }
    .hero-graphic { width: 240px; height: 240px; }
    .hero-robot-container { width: 140px; height: 140px; }
    .hero-ctas { justify-content: center; }
    .hero-desc { margin-left: auto; margin-right: auto; }
  }
  @media (max-width: 600px) {
    .topbar { padding: 12px 16px; gap: 12px; }
    .hero { padding: 32px 16px 28px; }
    .hero-graphic { width: 180px; height: 180px; }
    .hero-robot-container { width: 100px; height: 100px; }
    .main { padding: 32px 16px 60px; }
    .drop-zone { padding: 40px 20px; }
    .result-actions { flex-direction: column; }
    .btn-action { width: 100%; justify-content: center; }
    .section-header { flex-direction: column; align-items: flex-start; }
    .floating-nav { display: none; }
    .research-cards { grid-template-columns: 1fr; }
    .hero-ctas { flex-direction: column; }
    .hero-cta-primary, .hero-cta-partner { width: 100%; justify-content: center; }
    .topbar-attribution-text { display: none; }
  }
</style>
</head>
<body>
<div class="app">

  <!-- ===== TOPBAR ===== -->
  <div class="topbar">
    <div class="topbar-inner">
      <div class="topbar-left">
        <a href="https://www.linkedin.com/company/network-designs-inc-/" target="_blank"><img src="ndiautolight.png" alt="NDi Auto" class="ndi-logo"></a>
        <div class="topbar-divider"></div>
        <a href="https://netdes.com" target="_blank" class="topbar-attribution">
          <span class="topbar-attribution-text">A Division of</span>
          <img src="https://netdes.com/wp-content/uploads/logo-header.png" alt="Network Designs, Inc." class="topbar-attribution-logo">
        </a>
      </div>
      <div class="topbar-right">
        <a href="https://www.linkedin.com/company/network-designs-inc-/" target="_blank" class="btn-partner">PARTNER WITH US<span class="btn-partner-divider"></span><img src="sdvosb.png" alt="SDVOSB Certified" class="sdvosb-logo"></a>
      </div>
    </div>
  </div>

  <!-- ===== FLOATING NAV ===== -->
  <nav class="floating-nav">
    <a href="#smartdoc"><span class="nav-dot"></span>SmartDoc</a>
    <a href="#superprompt"><span class="nav-dot"></span>SuperPrompt</a>
    <a href="#raven"><span class="nav-dot"></span>RAVEN</a>
    <a href="#forge"><span class="nav-dot"></span>Forge</a>
  </nav>

  <!-- ===== HERO ===== -->
  <div class="hero">
    <div class="hero-layout">
      <div class="hero-text">
        <div class="hero-status-pill">
          <div class="status-dot"></div>OPERATIONAL | <span class="live-date"></span>
        </div>
        <h1>NDi <span>Auto</span></h1>
        <div class="hero-division">AI &amp; Automation Research Division</div>
        <p class="hero-desc">
          Production-grade intelligent tools for <strong>federal, defense, and enterprise</strong> ecosystems. Zero-trust by design. Zero backend. Nothing ever leaves your machine.
        </p>
        <div class="hero-ctas">
          <a href="#smartdoc" class="hero-cta-primary">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 4v12m0 0l4-4m-4 4l-4-4" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Explore Tools
          </a>
          <a href="https://www.linkedin.com/company/network-designs-inc-/" target="_blank" class="hero-cta-partner">PARTNER WITH US<span class="hero-cta-partner-divider"></span><img src="sdvosb.png" alt="SDVOSB"></a>
        </div>
      </div>
      <div class="hero-graphic">
        <div class="hero-hex-glow"></div>
        <div class="hero-ring hero-ring-3"></div>
        <div class="hero-ring hero-ring-2"></div>
        <div class="hero-ring hero-ring-1"></div>
        <div class="hero-bracket hero-bracket-tl"></div>
        <div class="hero-bracket hero-bracket-tr"></div>
        <div class="hero-bracket hero-bracket-bl"></div>
        <div class="hero-bracket hero-bracket-br"></div>
        <div class="hero-scan-line"></div>
        <div class="hero-robot-container">
          <img src="robot_white.png" alt="NDi Auto AI">
        </div>
        <div class="hero-robot-status">AI CORE ACTIVE</div>
      </div>
    </div>
  </div>

  <!-- ===== RESEARCH DIVISION CARDS ===== -->
  <div class="research-section">
    <div class="research-content">
      <div class="research-cards">
        <div class="research-card">
          <div class="research-card-icon">⚡</div>
          <div class="research-card-title">Zero-Trust Architecture</div>
          <div class="research-card-desc">Client-side only. No servers. No telemetry. No data ever leaves your machine. Built for environments where exposure isn't an option.</div>
        </div>
        <div class="research-card">
          <div class="research-card-icon">🔬</div>
          <div class="research-card-title">Mission-Grade Engineering</div>
          <div class="research-card-desc">Three decades of delivering on classified and unclassified networks. Every tool meets the standard our federal partners demand.</div>
        </div>
        <div class="research-card">
          <div class="research-card-icon">🛡️</div>
          <div class="research-card-title">Trusted by the Mission</div>
          <div class="research-card-desc">Partnered with DoD, DOJ, FAA, and FBI. SDVOSB certified. Set-aside eligible. Built by operators who understand the mission.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== SMARTDOC HERO (full width, like SuperPrompt) ===== -->
  <div class="sd-hero" id="smartdoc">
    <div class="sd-hero-glow"></div>
    <div class="sd-hero-content">
      <div class="sd-hero-badge">Document Serialization</div>
      <h2 class="sd-hero-title">NDi <span>SmartDoc</span></h2>
      <p class="sd-hero-sub"><strong style="color:var(--n-blue);font-size:20px;">Serialize. Compress. Deploy.</strong><br>Transform unstructured documents into a single AI-ready corpus.</p>
      <div class="sd-hero-stats">
        <div class="sd-hero-stat"><span class="sd-hero-stat-value"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" style="vertical-align:-2px;margin-right:4px;color:var(--success)"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" stroke-linecap="round" stroke-linejoin="round"/></svg>100%</span><span class="sd-hero-stat-label">Local &amp; Secure</span></div>
        <div class="sd-hero-stat-divider"></div>
        <div class="sd-hero-stat"><span class="sd-hero-stat-value">ANY</span><span class="sd-hero-stat-label">Document</span></div>
        <div class="sd-hero-stat-divider"></div>
        <div class="sd-hero-stat"><span class="sd-hero-stat-value">XML</span><span class="sd-hero-stat-label">Output Format</span></div>
        <div class="sd-hero-stat-divider"></div>
        <div class="sd-hero-stat"><span class="sd-hero-stat-value"><span class="no-cloud-icon"><svg viewBox="0 0 24 20" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M6.5 17A4.5 4.5 0 015.1 8.2a6 6 0 0111.8 0A4.5 4.5 0 0117.5 17H6.5z" stroke-linecap="round" stroke-linejoin="round"/><line x1="3" y1="19" x2="21" y2="1" stroke="#FF6B6B" stroke-width="2.5" stroke-linecap="round"/></svg></span></span><span class="sd-hero-stat-label">No Cloud</span></div>
      </div>
    </div>
  </div>

  <!-- ===== MAIN ===== -->
  <div class="main">

    <!-- DROP ZONE -->
    <div class="drop-zone" id="dropZone">
      <input type="file" id="fileInput" multiple accept=".pdf,.docx,.doc,.pptx,.ppt,.xlsx,.xls,.txt,.csv">
      <div class="drop-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="color:var(--d-blue)">
          <path d="M12 16V4m0 0L8 8m4-4l4 4" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M2 17l.621 2.485A2 2 0 004.561 21h14.878a2 2 0 001.94-1.515L22 17" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="drop-title">Drop documents here or click to browse</div>
      <div class="drop-sub">Your files never leave this browser</div>
      <div class="drop-formats">
        <span class="format-chip format-chip-pdf">.pdf</span>
        <span class="format-chip format-chip-docx">.docx</span>
        <span class="format-chip format-chip-pptx">.pptx</span>
        <span class="format-chip format-chip-xlsx">.xlsx</span>
        <span class="format-chip format-chip-csv">.csv</span>
        <span class="format-chip format-chip-txt">.txt</span>
      </div>
    </div>

    <!-- FILE LIST -->
    <div class="file-list" id="fileList"></div>

    <!-- STAGED BAR -->
    <div class="staged-bar" id="stagedBar">
      <div class="staged-text"><span class="staged-count" id="stagedCount">0</span> documents staged · <span id="stagedSize">0 KB</span></div>
      <div class="staged-actions">
        <button class="btn-sort" id="sortBtn" onclick="cycleSort()">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="15" y2="12"/><line x1="3" y1="18" x2="9" y2="18"/></svg>
          <span id="sortLabel">Uploaded</span>
        </button>
        <button class="btn-clear-all" onclick="clearAllFiles()">✕ Clear All</button>
      </div>
    </div>

    <!-- PROCESS BUTTON -->
    <div class="btn-process-wrap">
      <button class="btn-process" id="processBtn" disabled onclick="beginProcess()">
        <div class="btn-laser" id="btnLaser"></div>
        <div class="process-status" id="processStatus"></div>
        <span class="btn-label">Begin Serialization</span>
      </button>
    </div>

    <!-- RESULT (directly under button) -->
    <div class="result-section" id="resultSection">
      <div class="result-actions">
        <button class="btn-action btn-action-download" onclick="downloadCorpus()">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 4v12m0 0l-4-4m4 4l4-4M2 17l.621 2.485A2 2 0 004.561 21h14.878a2 2 0 001.94-1.515L22 17" stroke-linecap="round" stroke-linejoin="round"/></svg>
          Download SmartDoc (.txt)
        </button>
        <button class="btn-action btn-action-copy" onclick="copyCorpus()">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1" stroke-linecap="round"/></svg>
          Copy Text
        </button>
      </div>
    </div>

    <!-- WORKS WITH (under serialize button) -->
    <div class="works-with" style="margin-top:28px; padding-top:16px; border-top:none;">
      <div class="works-with-label">Works with</div>
      <div class="marquee-mask">
        <div class="marquee-track">
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=chatgpt.com&sz=64" alt="" onerror="this.style.display='none'">ChatGPT</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=claude.ai&sz=64" alt="" onerror="this.style.display='none'">Claude</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=gemini.google.com&sz=64" alt="" onerror="this.style.display='none'">Gemini</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=perplexity.ai&sz=64" alt="" onerror="this.style.display='none'">Perplexity</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=meta.ai&sz=64" alt="" onerror="this.style.display='none'">Meta AI</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=mistral.ai&sz=64" alt="" onerror="this.style.display='none'">Mistral</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=copilot.microsoft.com&sz=64" alt="" onerror="this.style.display='none'">Copilot</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=grok.com&sz=64" alt="" onerror="this.style.display='none'">Grok</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=cohere.com&sz=64" alt="" onerror="this.style.display='none'">Cohere</div>
          <!-- duplicate for seamless loop -->
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=chatgpt.com&sz=64" alt="" onerror="this.style.display='none'">ChatGPT</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=claude.ai&sz=64" alt="" onerror="this.style.display='none'">Claude</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=gemini.google.com&sz=64" alt="" onerror="this.style.display='none'">Gemini</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=perplexity.ai&sz=64" alt="" onerror="this.style.display='none'">Perplexity</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=meta.ai&sz=64" alt="" onerror="this.style.display='none'">Meta AI</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=mistral.ai&sz=64" alt="" onerror="this.style.display='none'">Mistral</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=copilot.microsoft.com&sz=64" alt="" onerror="this.style.display='none'">Copilot</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=grok.com&sz=64" alt="" onerror="this.style.display='none'">Grok</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=cohere.com&sz=64" alt="" onerror="this.style.display='none'">Cohere</div>
        </div>
      </div>
    </div>

  </div>

  <!-- NDi SUPERPROMPT HERO (full width, outside .main) -->
  <div class="sp-hero" id="superprompt">
    <div class="sp-hero-glow"></div>
    <div class="sp-hero-content">
      <div class="sp-hero-badge">AI ACCELERATION</div>
      <h2 class="sp-hero-title">NDi <span>SuperPrompt</span>™</h2>
      <p class="sp-hero-sub"><strong style="color:var(--n-blue);font-size:20px;">One prompt. Any model. Maximum intelligence.</strong><br>Deeper reasoning &amp; structured thinking. Caffeine for AI.</p>
      <div class="sp-hero-stats">
        <div class="sp-hero-stat"><span class="sp-hero-stat-value">40%</span><span class="sp-hero-stat-label">Higher Rated Outputs</span><span class="sp-hero-stat-note">when using extended thinking</span></div>
        <div class="sp-hero-stat-divider"></div>
        <div class="sp-hero-stat"><span class="sp-hero-stat-value">4-Phase</span><span class="sp-hero-stat-label">Cognitive Protocol</span></div>
        <div class="sp-hero-stat-divider"></div>
        <div class="sp-hero-stat"><span class="sp-hero-stat-value">1,000+</span><span class="sp-hero-stat-label">Models Supported</span></div>
        <div class="sp-hero-stat-divider"></div>
        <div class="sp-hero-stat"><span class="sp-hero-stat-value"><span class="no-cloud-icon"><svg viewBox="0 0 24 20" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M6.5 17A4.5 4.5 0 015.1 8.2a6 6 0 0111.8 0A4.5 4.5 0 0117.5 17H6.5z" stroke-linecap="round" stroke-linejoin="round"/><line x1="3" y1="19" x2="21" y2="1" stroke="#FF6B6B" stroke-width="2.5" stroke-linecap="round"/></svg></span></span><span class="sp-hero-stat-label">No Cloud</span></div>
      </div>
    </div>
  </div>

  <!-- NDi SUPER PROMPT™ content (back in constrained width) -->
  <div class="main" style="padding-top:32px;">
    <div class="super-prompt-section" style="margin-top:0; border-top:none; padding-top:0;">
      <div class="super-prompt-header">
        <div class="super-prompt-header-left">
          <div class="super-prompt-icon">
            <img src="robot_white.png" alt="NDi Bot" style="width:36px;height:36px;border-radius:8px;">
          </div>
          <div>
            <div class="super-prompt-title">NDi SuperPrompt™</div>
            <div class="super-prompt-sub">Paste before any prompt. Any model. Instant overdrive.</div>
          </div>
        </div>
        <button class="btn-action btn-action-primary btn-super" onclick="copySuperPrompt()">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1" stroke-linecap="round"/></svg>
          COPY SUPERPROMPT
        </button>
      </div>

      <div class="super-prompt-card">
        <div class="super-prompt-glow"></div>
        <div class="super-prompt-content" id="superPromptBox"></div>
      </div>

      <div class="works-with">
        <div class="works-with-label">Works with</div>
        <div class="marquee-mask">
          <div class="marquee-track">
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=chatgpt.com&sz=64" alt="" onerror="this.style.display='none'">ChatGPT</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=claude.ai&sz=64" alt="" onerror="this.style.display='none'">Claude</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=gemini.google.com&sz=64" alt="" onerror="this.style.display='none'">Gemini</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=perplexity.ai&sz=64" alt="" onerror="this.style.display='none'">Perplexity</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=meta.ai&sz=64" alt="" onerror="this.style.display='none'">Meta AI</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=mistral.ai&sz=64" alt="" onerror="this.style.display='none'">Mistral</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=copilot.microsoft.com&sz=64" alt="" onerror="this.style.display='none'">Copilot</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=grok.com&sz=64" alt="" onerror="this.style.display='none'">Grok</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=cohere.com&sz=64" alt="" onerror="this.style.display='none'">Cohere</div>
            <!-- duplicate set for seamless loop -->
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=chatgpt.com&sz=64" alt="" onerror="this.style.display='none'">ChatGPT</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=claude.ai&sz=64" alt="" onerror="this.style.display='none'">Claude</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=gemini.google.com&sz=64" alt="" onerror="this.style.display='none'">Gemini</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=perplexity.ai&sz=64" alt="" onerror="this.style.display='none'">Perplexity</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=meta.ai&sz=64" alt="" onerror="this.style.display='none'">Meta AI</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=mistral.ai&sz=64" alt="" onerror="this.style.display='none'">Mistral</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=copilot.microsoft.com&sz=64" alt="" onerror="this.style.display='none'">Copilot</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=grok.com&sz=64" alt="" onerror="this.style.display='none'">Grok</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=cohere.com&sz=64" alt="" onerror="this.style.display='none'">Cohere</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== RAVEN CTA ===== -->
  <div class="raven-cta-wrap" id="raven">
    <div class="raven-cta">
      <img src="raven-icon.png" alt="RAVEN" class="raven-cta-icon">
      <div class="raven-cta-text">
        <div class="raven-cta-title">Classified Streaming Over Public Infrastructure</div>
        <p class="raven-cta-desc">RAVEN delivers secure, classified-level video and data streaming across untrusted networks. The same mission-grade engineering. Different attack surface.</p>
      </div>
      <div class="raven-cta-action">
        <a href="https://ravensecurenetworks.com" target="_blank" class="raven-cta-action-link">
          <img src="raven-social.png" alt="RAVEN Secure Networks" class="raven-cta-social">
          <div class="raven-cta-btn">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6M15 3h6v6M10 14L21 3" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Visit RAVEN
          </div>
        </a>
      </div>
    </div>
  </div>

  <!-- ===== FORGE HERO ===== -->
  <div class="forge-hero" id="forge">
    <div class="forge-hero-glow"></div>
    <div class="forge-hero-content">
      <div class="forge-hero-badge">AI Acceleration</div>
      <h2 class="forge-hero-title">RAVEN <span>Forge</span></h2>
      <p class="forge-hero-sub">Local AI that runs <strong>entirely in your browser</strong>. No cloud. No data leakage. Powered by Ollama + Qwen — your documents, your machine, your control.</p>
      <div class="forge-hero-stats">
        <div class="forge-hero-stat">
          <span class="forge-hero-stat-value">100%</span>
          <span class="forge-hero-stat-label">Local</span>
        </div>
        <div class="forge-hero-stat-divider"></div>
        <div class="forge-hero-stat">
          <span class="forge-hero-stat-value">0 B</span>
          <span class="forge-hero-stat-label">Data Sent</span>
        </div>
        <div class="forge-hero-stat-divider"></div>
        <div class="forge-hero-stat">
          <span class="forge-hero-stat-value">∞</span>
          <span class="forge-hero-stat-label">Privacy</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== RAVEN FORGE ===== -->
  <div class="forge-wrap">
    <div class="forge" style="position:relative;">
      <!-- Gate Overlay -->
      <div class="forge-gate" id="forgeGate">
        <img src="raven-icon.png" alt="RAVEN" class="forge-gate-icon">
        <button class="forge-gate-btn" id="forgeGateBtn" onclick="forgeRequestAccess()">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <div class="forge-gate-spinner"></div>
          <span id="forgeGateBtnText">Connect to Local AI</span>
        </button>
        <p class="forge-gate-desc">Talk to a browser-run LLM.<br><strong>No data leakage. Totally secure.</strong></p>
        <div class="forge-gate-status" id="forgeGateStatus"></div>
      </div>

      <!-- Header -->
      <div class="forge-head">
        <div class="forge-head-left">
          <img src="raven-icon.png" alt="RAVEN" class="forge-head-icon">
          <span class="forge-head-title">RAVEN FORGE</span>
        </div>
        <div class="forge-head-right">
          <span class="forge-pill">LOCAL</span>
          <button class="forge-gear" onclick="forgeToggleSettings()" title="Settings">
            <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 00-2 2v.18a2 2 0 01-1 1.73l-.43.25a2 2 0 01-2 0l-.15-.08a2 2 0 00-2.73.73l-.22.38a2 2 0 00.73 2.73l.15.1a2 2 0 011 1.72v.51a2 2 0 01-1 1.74l-.15.09a2 2 0 00-.73 2.73l.22.38a2 2 0 002.73.73l.15-.08a2 2 0 012 0l.43.25a2 2 0 011 1.73V20a2 2 0 002 2h.44a2 2 0 002-2v-.18a2 2 0 011-1.73l.43-.25a2 2 0 012 0l.15.08a2 2 0 002.73-.73l.22-.39a2 2 0 00-.73-2.73l-.15-.08a2 2 0 01-1-1.74v-.5a2 2 0 011-1.74l.15-.09a2 2 0 00.73-2.73l-.22-.38a2 2 0 00-2.73-.73l-.15.08a2 2 0 01-2 0l-.43-.25a2 2 0 01-1-1.73V4a2 2 0 00-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
          </button>
        </div>
      </div>

      <!-- Chat -->
      <div class="forge-chat" id="forgeChat">
        <div class="forge-welcome" id="forgeWelcome">
          <img src="raven-icon.png" alt="">
          <span>Ask anything. Runs locally.</span>
        </div>
      </div>

      <!-- Input wrap -->
      <div class="forge-input-wrap">
        <!-- Doc drawer -->
        <div class="forge-doc-drawer" id="forgeDocDrawer">
          <div class="forge-doc-list" id="forgeDocList"></div>
          <div class="forge-doc-actions" id="forgeDocActions" style="display:none;">
            <button class="forge-doc-btn forge-doc-clear" onclick="forgeClearDocs()">✕ Clear</button>
            <button class="forge-doc-btn forge-doc-upload" onclick="document.getElementById('forgeFileInput').click()">Upload Documents</button>
          </div>
        </div>

        <!-- Bar -->
        <div class="forge-bar">
          <button class="forge-attach" onclick="forgeToggleDocs()" title="Documents">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.44 11.05l-9.19 9.19a6 6 0 01-8.49-8.49l9.19-9.19a4 4 0 015.66 5.66l-9.2 9.19a2 2 0 01-2.83-2.83l8.49-8.48" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <span class="forge-attach-badge" id="forgeDocBadge" style="display:none;">0</span>
          </button>
          <input type="file" id="forgeFileInput" multiple accept=".pdf,.docx,.doc,.xlsx,.xls,.csv,.txt,.pptx,.ppt" style="display:none;" onchange="forgeAddFiles(this.files);this.value='';">
          <textarea class="forge-textarea" id="forgeInput" rows="1" placeholder="Message RAVEN Forge..." onkeydown="forgeKeydown(event)" oninput="forgeResizeInput()"></textarea>
          <button class="forge-send" id="forgeSendBtn" disabled onclick="forgeSend()" title="Send">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/></svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="forge-modal-bg" id="forgeModalBg" onclick="if(event.target===this)forgeToggleSettings()">
    <div class="forge-modal">
      <h3>Forge Settings</h3>
      <label>API Endpoint</label>
      <input id="forgeSettingUrl" value="http://localhost:11434/v1/chat/completions">
      <label>Model</label>
      <input id="forgeSettingModel" value="qwen3-4b">
      <label>Temperature</label>
      <input id="forgeSettingTemp" type="number" step="0.1" min="0" max="2" value="0.7">
      <label>Max Tokens</label>
      <input id="forgeSettingTokens" type="number" step="256" min="256" max="16384" value="4096">
      <button class="forge-modal-close" onclick="forgeSaveSettings()">Save & Close</button>
    </div>
  </div>

  <!-- FORGE HELP -->
  <div class="forge-help">
    <div class="forge-help-inner">
      <img src="allowndiauto.png" alt="Allow NDi Auto local network access" class="forge-help-img">
      <div class="forge-help-text">
        <div class="forge-help-title">First-Time Setup</div>
        <p class="forge-help-desc">Your browser will ask to allow <strong>NDi Auto</strong> to connect to your local network. <strong>Click Allow.</strong> This lets Forge talk to the AI running on your machine. No data leaves your computer — everything stays local.</p>
      </div>
    </div>
  </div>

  <!-- FORGE TAGLINE -->
  <div class="forge-tagline">
    <div class="forge-tagline-text"><span>RAVEN</span> <em>|</em> Secure Local AI</div>
  </div>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-inner">
      <!-- Footer Grid -->
      <div class="footer-grid">
        <!-- Brand Column -->
        <div>
          <img src="ndiautolight.png" alt="NDi Auto" class="footer-brand-logo">
          <p class="footer-brand-desc">NDi Auto is the AI &amp; Automation Research Division of Network Designs, Inc. — a Service-Disabled Veteran-Owned Small Business delivering mission-critical IT solutions for three decades.</p>
          <div class="footer-sdvosb">
            <span class="footer-sdvosb-dot"></span>
            OPERATIONAL | <span class="live-date"></span>
          </div>
          <div class="footer-social">
            <a href="https://www.linkedin.com/company/network-designs-inc-/" target="_blank" aria-label="LinkedIn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
            </a>
            <a href="https://netdes.com" target="_blank" aria-label="Website">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"/></svg>
            </a>
          </div>
        </div>

        <!-- Tools Column -->
        <div>
          <div class="footer-col-title">Tools</div>
          <ul class="footer-links">
            <li><a href="#smartdoc">NDi SmartDoc</a></li>
            <li><a href="#superprompt">NDi SuperPrompt™</a></li>
          </ul>
        </div>

        <!-- Company Column -->
        <div>
          <div class="footer-col-title">Company</div>
          <ul class="footer-links">
            <li><a href="https://netdes.com" target="_blank">netdes.com</a></li>
            <li><a href="https://netdes.com/about/" target="_blank">About NDi</a></li>
            <li><a href="https://netdes.com/veterans-first/" target="_blank">Veterans First</a></li>
            <li><a href="https://netdes.com/contracts/" target="_blank">Contracts</a></li>
            <li><a href="https://netdes.com/capabilities/" target="_blank">Capabilities</a></li>
          </ul>
        </div>

        <!-- Contact Column -->
        <div>
          <div class="footer-col-title">Contact</div>
          <div class="footer-contact-item">
            <strong>Headquarters</strong><br>
            1651 Old Meadow Road<br>
            Suite 105, McLean, VA
          </div>
          <div class="footer-contact-item">
            <strong>Phone</strong><br>
            <a href="tel:7032552206">(703) 255-2206</a>
          </div>
          <div class="footer-contact-item">
            <strong>Email</strong><br>
            <a href="mailto:info@netdes.com">info@netdes.com</a>
          </div>
        </div>
      </div>

      <!-- Certification Logos — full width -->
      <div class="footer-certs">
        <img src="footer.jpeg" alt="SDVOSB · CMMI ML3 · ISO · CSfC Certifications">
      </div>

      <!-- Bottom Bar -->
      <div class="footer-bottom">
        <span>© 2026 Network Designs, Inc. All rights reserved.</span>
        <div class="footer-bottom-links">
          <a href="https://netdes.com/privacy-policy/" target="_blank">Privacy Policy</a>
          <a href="https://netdes.com/terms-and-conditions/" target="_blank">Terms &amp; Conditions</a>
        </div>
      </div>
    </div>
  </footer>

</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
// ========== SYSTEM PROMPT (baked into every SmartDocs output — invisible to user) ==========
const SYSTEM_PROMPT = `<SmartDocs_Instructions>
You have been given a SmartDocs Master Corpus below. This is your primary knowledge base.

Rules:
- Think step by step. Be thorough. Take your time before answering.
- ONLY use information from the corpus below. If it's not in here, say "not found in the provided documents."
- Cite the source filename from <Meta> tags when referencing specific information.
- Synthesize across multiple documents when a question spans topics.
- Never fabricate, hallucinate, or guess. Precision over speed.
- When summarizing, preserve key details — do not over-compress.
- If asked to compare documents, create structured side-by-side analysis.
- Default to being exhaustive rather than brief unless told otherwise.

Corpus format: <SmartDocs_Library> → <Doc> → <Meta>(filename)</Meta> → <Body>(content)</Body>
</SmartDocs_Instructions>`;

// ========== NDi SUPER PROMPT™ (standalone — paste before any prompt) ==========
const SUPER_PROMPT = `[System: NDi_SuperPrompt™ — Cognitive Overdrive Protocol]
[Reasoning: Maximum | Depth: Exhaustive | Precision: Absolute]

Before responding, execute the following internal sequence:

<thinking>
PHASE 1 — DECONSTRUCT
- Parse the user's request into every atomic constraint, implicit and explicit.
- Identify the core objective, secondary goals, edge cases, and unstated assumptions.
- Flag ambiguities. Resolve them with the most useful interpretation.

PHASE 2 — DIVERGE
- Generate three fundamentally different solution approaches.
- Each must differ in methodology, not just wording.
- At least one approach must be unconventional.

PHASE 3 — STRESS TEST
- For each approach, identify the top 3 failure modes.
- Ask: Where does this break? What does this miss? What would an expert critique?
- Rank approaches by robustness, clarity, and completeness.

PHASE 4 — SYNTHESIZE
- Merge the strongest elements from all approaches into one final response.
- Eliminate redundancy. Maximize signal-to-noise ratio.
- Ensure every claim is defensible and every recommendation is actionable.
</thinking>

Response standards:
- Be thorough but never verbose. Every sentence must earn its place.
- Use precise language. Avoid filler, hedging, and unnecessary qualifiers.
- Structure for clarity: lead with the answer, then support with reasoning.
- If you don't know something, say so. Never fabricate.
- Think longer than you normally would. The extra cycles are worth it.
- Default to being the smartest, most useful version of yourself.

Now respond to the following:
`;

document.getElementById('superPromptBox').textContent = SUPER_PROMPT;

// ========== SHARED UTILITIES ==========
const EXT_COLORS = {
  pdf:  { bg: 'rgba(220,53,69,0.15)', border: 'rgba(220,53,69,0.35)', color: '#e85d6f' },
  docx: { bg: 'rgba(43,87,154,0.15)', border: 'rgba(43,87,154,0.35)', color: '#5b9aed' },
  doc:  { bg: 'rgba(43,87,154,0.15)', border: 'rgba(43,87,154,0.35)', color: '#5b9aed' },
  pptx: { bg: 'rgba(209,105,46,0.15)', border: 'rgba(209,105,46,0.35)', color: '#e8874a' },
  ppt:  { bg: 'rgba(209,105,46,0.15)', border: 'rgba(209,105,46,0.35)', color: '#e8874a' },
  xlsx: { bg: 'rgba(33,115,70,0.15)', border: 'rgba(33,115,70,0.35)', color: '#3dbf6e' },
  xls:  { bg: 'rgba(33,115,70,0.15)', border: 'rgba(33,115,70,0.35)', color: '#3dbf6e' },
  csv:  { bg: 'rgba(130,150,50,0.15)', border: 'rgba(130,150,50,0.35)', color: '#a8b84a' },
  txt:  { bg: 'rgba(140,140,140,0.15)', border: 'rgba(140,140,140,0.3)', color: '#a0a0a0' },
  jpg:  { bg: 'rgba(128,60,180,0.15)', border: 'rgba(128,60,180,0.35)', color: '#b07ce0' },
  jpeg: { bg: 'rgba(128,60,180,0.15)', border: 'rgba(128,60,180,0.35)', color: '#b07ce0' },
  png:  { bg: 'rgba(128,60,180,0.15)', border: 'rgba(128,60,180,0.35)', color: '#b07ce0' },
};
const EXT_DEFAULT = { bg: 'rgba(7,176,232,0.1)', border: 'rgba(7,176,232,0.25)', color: '#4dc9f6' };

function extColor(name) {
  return EXT_COLORS[name.split('.').pop().toLowerCase()] || EXT_DEFAULT;
}

function fmtSize(bytes) {
  if (bytes >= 1073741824) return (bytes / 1073741824).toFixed(2) + ' GB';
  if (bytes >= 1048576) return (bytes / 1048576).toFixed(1) + ' MB';
  return (bytes / 1024).toFixed(1) + ' KB';
}

function esc(s) { return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

// Shared file extraction — used by both SmartDocs and Forge
async function extractFileText(file) {
  const ext = file.name.split('.').pop().toLowerCase();
  try {
    if (ext === 'txt' || ext === 'csv') return await file.text();
    if (ext === 'pdf') {
      const buf = await file.arrayBuffer();
      const pdf = await pdfjsLib.getDocument({ data: buf }).promise;
      let t = '';
      for (let i = 1; i <= pdf.numPages; i++) {
        const pg = await pdf.getPage(i);
        const tc = await pg.getTextContent();
        t += tc.items.map(x => x.str).join(' ') + '\n';
      }
      return t;
    }
    if (ext === 'docx' || ext === 'doc') {
      const buf = await file.arrayBuffer();
      return (await mammoth.extractRawText({ arrayBuffer: buf })).value;
    }
    if (ext === 'xlsx' || ext === 'xls') {
      const buf = await file.arrayBuffer();
      const wb = XLSX.read(buf, { type: 'array' });
      return wb.SheetNames.map(n => `[Sheet: ${n}]\n` + XLSX.utils.sheet_to_csv(wb.Sheets[n])).join('\n\n');
    }
    if (ext === 'pptx' || ext === 'ppt') {
      const buf = await file.arrayBuffer();
      const zip = await JSZip.loadAsync(buf);
      const slides = Object.keys(zip.files)
        .filter(n => /^ppt\/slides\/slide\d+\.xml$/.test(n))
        .sort((a,b) => parseInt(a.match(/\d+/)[0]) - parseInt(b.match(/\d+/)[0]));
      let t = '';
      for (const s of slides) {
        const xml = await zip.files[s].async('text');
        const doc = new DOMParser().parseFromString(xml, 'application/xml');
        for (const el of doc.getElementsByTagName('a:t')) t += (el.textContent || '') + ' ';
        t += '\n';
      }
      return t;
    }
    return await file.text();
  } catch (e) { return `[Error extracting ${file.name}: ${e.message}]`; }
}

// ========== STATE ==========
let stagedFiles = [];
let masterCorpus = '';

// ========== DOM ==========
const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');
const fileListEl = document.getElementById('fileList');
const stagedBar = document.getElementById('stagedBar');
const processBtn = document.getElementById('processBtn');

// ========== DRAG & DROP ==========
dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('dragover'); });
dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
dropZone.addEventListener('drop', e => { e.preventDefault(); dropZone.classList.remove('dragover'); addFiles(e.dataTransfer.files); });
fileInput.addEventListener('change', e => addFiles(e.target.files));

function addFiles(list) {
  for (const f of list) {
    if (!stagedFiles.find(s => s.name === f.name && s.size === f.size)) stagedFiles.push(f);
  }
  renderFiles();
}

function removeFile(i) { stagedFiles.splice(i, 1); renderFiles(); }

function clearAllFiles() {
  if (stagedFiles.length === 0) return;
  if (!confirm(`Remove all ${stagedFiles.length} staged documents?`)) return;
  stagedFiles = []; sortMode = 'uploaded'; renderFiles();
}

// Sort modes: uploaded → size-asc → size-desc → type
let sortMode = 'uploaded';
const sortModes = ['uploaded', 'size-asc', 'size-desc', 'type'];
const sortLabels = { 'uploaded': 'Uploaded', 'size-asc': 'Size ↑', 'size-desc': 'Size ↓', 'type': 'File Type' };

function cycleSort() {
  const idx = sortModes.indexOf(sortMode);
  sortMode = sortModes[(idx + 1) % sortModes.length];
  renderFiles();
}

function getSortedFiles() {
  const files = stagedFiles.map((f, i) => ({ file: f, origIdx: i }));
  if (sortMode === 'uploaded') return files;
  if (sortMode === 'size-asc') return files.sort((a, b) => a.file.size - b.file.size);
  if (sortMode === 'size-desc') return files.sort((a, b) => b.file.size - a.file.size);
  if (sortMode === 'type') {
    return files.sort((a, b) => {
      const extA = a.file.name.split('.').pop().toLowerCase();
      const extB = b.file.name.split('.').pop().toLowerCase();
      if (extA !== extB) return extA.localeCompare(extB);
      return b.file.size - a.file.size;
    });
  }
  return files;
}

function renderFiles() {
  const sorted = getSortedFiles();
  fileListEl.innerHTML = sorted.map(({ file: f, origIdx }) => {
    const ext = f.name.split('.').pop().toLowerCase();
    const c = extColor(f.name);
    return `<div class="file-item">
      <div class="file-info">
        <span class="file-ext" style="background:${c.bg};border:1px solid ${c.border};color:${c.color}">${ext.toUpperCase()}</span>
        <span class="file-name">${f.name}</span>
      </div>
      <div class="file-meta">
        <span class="file-size">${fmtSize(f.size)}</span>
        <button class="file-remove" onclick="removeFile(${origIdx})">✕</button>
      </div>
    </div>`;
  }).join('');

  // Update sort button
  const sortBtn = document.getElementById('sortBtn');
  const sortLabel = document.getElementById('sortLabel');
  if (sortBtn && sortLabel) {
    sortLabel.textContent = sortLabels[sortMode];
    sortBtn.classList.toggle('active', sortMode !== 'uploaded');
  }

  // Reset button to ready state
  processBtn.classList.remove('processing', 'done');
  processBtn.querySelector('.btn-label').textContent = 'Begin Serialization';
  document.getElementById('btnLaser').style.width = '0%';
  document.getElementById('processStatus').innerHTML = '';

  if (stagedFiles.length) {
    const totalBytes = stagedFiles.reduce((s,f) => s + f.size, 0);
    document.getElementById('stagedCount').textContent = stagedFiles.length;
    document.getElementById('stagedSize').textContent = fmtSize(totalBytes);
    stagedBar.classList.add('visible');
    processBtn.disabled = false;
  } else {
    stagedBar.classList.remove('visible');
    processBtn.disabled = true;
  }
  document.getElementById('resultSection').classList.remove('visible');
}

// ========== MAIN PROCESS ==========
const PROCESS_MESSAGES = [
  'Initializing serialization engine…',
  'Parsing document structure…',
  'Extracting text layers…',
  'Resolving embedded objects…',
  'Normalizing character encoding…',
  'Building semantic index…',
  'Structuring XML corpus…',
  'Assembling SmartDoc payload…',
  'Optimizing for LLM context windows…',
  'Running final validation…',
  'Compressing output…',
  'Finalizing…',
];

// Organic easing — fast start, slows in middle, surges near end
function organicEase(t) {
  // Perlin-ish feel: base cubic ease + sine wobble
  const base = t < 0.5
    ? 4 * t * t * t
    : 1 - Math.pow(-2 * t + 2, 3) / 2;
  const wobble = Math.sin(t * Math.PI * 5.7) * 0.012 * (1 - t);
  return Math.min(1, Math.max(0, base + wobble));
}

async function beginProcess() {
  const btnLaser = document.getElementById('btnLaser');
  const processStatus = document.getElementById('processStatus');
  const resultSection = document.getElementById('resultSection');

  // Random duration between 3.2–5.3s
  const totalMs = 3200 + Math.random() * 2100;

  // Reset states
  processBtn.classList.remove('done');
  processBtn.classList.add('processing');
  btnLaser.style.width = '0%';
  btnLaser.style.opacity = '0';
  processStatus.innerHTML = '';
  resultSection.classList.remove('visible');

  // Brief delay before laser starts — prevents the initial sliver flash
  await new Promise(r => setTimeout(r, 200));
  btnLaser.style.opacity = '1';

  const startTime = Date.now();

  // Rolling status messages — 1.8s each for slower readability
  const msgCount = Math.min(PROCESS_MESSAGES.length, Math.floor(totalMs / 1800) + 1);
  let msgIdx = 0;
  function showNextMessage() {
    if (msgIdx < msgCount) {
      processStatus.innerHTML = `<span>${PROCESS_MESSAGES[msgIdx]}</span>`;
      msgIdx++;
    }
  }
  showNextMessage();
  const msgInterval = setInterval(() => showNextMessage(), 1800);

  // Organic laser fill — uses easing + random micro-stutters
  let laserTarget = 0;
  let laserCurrent = 0;
  const fillFrame = () => {
    const elapsed = Date.now() - startTime;
    const t = Math.min(1, elapsed / totalMs);
    // Ease to 92% during processing, leave room for final surge
    laserTarget = organicEase(t) * 92;
    // Smooth chase with slight lag for organic feel
    laserCurrent += (laserTarget - laserCurrent) * 0.08;
    // Don't render below 0.5% to prevent sliver
    btnLaser.style.width = (laserCurrent < 0.5 ? 0 : laserCurrent).toFixed(2) + '%';
    if (t < 1) requestAnimationFrame(fillFrame);
  };
  requestAnimationFrame(fillFrame);

  // Actual processing (runs in parallel with animation)
  masterCorpus = SYSTEM_PROMPT + '\n\n<SmartDocs_Library>\n';
  for (let i = 0; i < stagedFiles.length; i++) {
    const f = stagedFiles[i];
    const text = await extractFileText(f);
    masterCorpus += `\n<Doc>\n  <Meta>${esc(f.name)}</Meta>\n  <Body>\n${esc(text)}\n  </Body>\n</Doc>\n`;
  }
  masterCorpus += '\n</SmartDocs_Library>';

  // Wait for minimum duration
  const elapsed = Date.now() - startTime;
  if (elapsed < totalMs) {
    await new Promise(r => setTimeout(r, totalMs - elapsed));
  }

  clearInterval(msgInterval);

  // Surge to 100%
  btnLaser.style.transition = 'width 0.3s cubic-bezier(0.22, 1, 0.36, 1)';
  btnLaser.style.width = '100%';
  processStatus.innerHTML = '<span>Complete</span>';

  await new Promise(r => setTimeout(r, 500));

  // Done state
  btnLaser.style.transition = '';
  processBtn.classList.remove('processing');
  processBtn.classList.add('done');
  btnLaser.style.width = '0%';
  processStatus.innerHTML = '';
  processBtn.querySelector('.btn-label').textContent = 'SERIALIZATION COMPLETE';

  resultSection.classList.add('visible');
}

// ========== ACTIONS ==========
function downloadCorpus() {
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([masterCorpus], { type: 'text/plain' }));
  const d = new Date();
  const mm = String(d.getMonth()+1).padStart(2,'0');
  const dd = String(d.getDate()).padStart(2,'0');
  const yy = String(d.getFullYear()).slice(-2);
  a.download = `NDi_SmartDoc_${mm}-${dd}-${yy}.txt`;
  a.click(); URL.revokeObjectURL(a.href);
  showToast('SmartDoc downloaded');
}

function copyCorpus() {
  navigator.clipboard.writeText(masterCorpus).then(() => showToast('SmartDoc Contents Copied to Clipboard!'));
}

function copySuperPrompt() {
  navigator.clipboard.writeText(SUPER_PROMPT).then(() => showToast('NDi SuperPrompt™ copied — paste before any prompt'));
}

function showToast(msg, raven) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.toggle('raven-toast', !!raven);
  t.classList.add('visible');
  setTimeout(() => t.classList.remove('visible'), 2400);
}

// ========== PDF.js Worker ==========
pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

// ========== FLOATING NAV: active state on scroll ==========
(function() {
  const navEl = document.querySelector('.floating-nav');
  const navLinks = document.querySelectorAll('.floating-nav a');
  const sections = [
    { id: 'smartdoc', el: document.getElementById('smartdoc') },
    { id: 'superprompt', el: document.getElementById('superprompt') },
    { id: 'raven', el: document.getElementById('raven') },
    { id: 'forge', el: document.getElementById('forge') },
  ];
  const ravenIds = new Set(['raven', 'forge']);

  function updateActiveNav() {
    const scrollY = window.scrollY + 120;
    let activeId = '';
    for (const s of sections) {
      if (s.el && s.el.offsetTop <= scrollY) activeId = s.id;
    }
    navLinks.forEach(link => {
      const isActive = link.getAttribute('href') === '#' + activeId;
      link.classList.toggle('active', isActive);
    });
    navEl.classList.toggle('raven-mode', ravenIds.has(activeId));
  }

  window.addEventListener('scroll', updateActiveNav, { passive: true });
  updateActiveNav();
})();

// ========== LIVE DATE (header + footer) ==========
(function() {
  const d = new Date();
  const mm = String(d.getMonth()+1).padStart(2,'0');
  const dd = String(d.getDate()).padStart(2,'0');
  const yy = String(d.getFullYear()).slice(-2);
  const dateStr = `${mm}.${dd}.${yy}`;
  document.querySelectorAll('.live-date').forEach(el => el.textContent = dateStr);
})();

// ========== RAVEN FORGE ==========
(function() {
  let forgeMessages = [];
  let forgeDocs = [];
  let forgeStreaming = false;

  // Config with localStorage persistence
  const FC = {
    get url() { return localStorage.getItem('forge_api_url') || 'http://localhost:11434/v1/chat/completions'; },
    get model() { return localStorage.getItem('forge_model') || 'qwen3-4b'; },
    get temp() { return parseFloat(localStorage.getItem('forge_temp') || '0.7'); },
    get tokens() { return parseInt(localStorage.getItem('forge_max_tokens') || '4096'); },
  };

  // Load saved settings into modal inputs
  const sUrl = document.getElementById('forgeSettingUrl');
  const sModel = document.getElementById('forgeSettingModel');
  const sTemp = document.getElementById('forgeSettingTemp');
  const sTokens = document.getElementById('forgeSettingTokens');
  sUrl.value = FC.url; sModel.value = FC.model;
  sTemp.value = FC.temp; sTokens.value = FC.tokens;

  const chatEl = document.getElementById('forgeChat');
  const inputEl = document.getElementById('forgeInput');
  const sendBtn = document.getElementById('forgeSendBtn');
  const docDrawer = document.getElementById('forgeDocDrawer');
  const docList = document.getElementById('forgeDocList');
  const docActions = document.getElementById('forgeDocActions');
  const docBadge = document.getElementById('forgeDocBadge');
  const welcomeEl = document.getElementById('forgeWelcome');

  // ---- DOCUMENTS ----
  window.forgeAddFiles = async function(files) {
    for (const f of files) {
      if (forgeDocs.find(d => d.name === f.name && d.size === f.size)) continue;
      const text = await extractFileText(f);
      forgeDocs.push({ name: f.name, size: f.size, text });
    }
    forgeRenderDocs();
    if (forgeDocs.length) forgeAddSysMsg(`${forgeDocs.length} document${forgeDocs.length>1?'s':''} loaded as context`);
    if (!docDrawer.classList.contains('open')) docDrawer.classList.add('open');
  };

  window.forgeRemoveDoc = function(i) { forgeDocs.splice(i, 1); forgeRenderDocs(); };

  window.forgeClearDocs = function() {
    if (!forgeDocs.length) return;
    forgeDocs = []; forgeRenderDocs();
  };

  function forgeRenderDocs() {
    docList.innerHTML = forgeDocs.map((d, i) => {
      const c = extColor(d.name);
      const ext = d.name.split('.').pop().toUpperCase();
      return `<div class="forge-doc-item">
        <span class="forge-doc-ext" style="background:${c.bg};border:1px solid ${c.border};color:${c.color}">${ext}</span>
        <span class="forge-doc-name">${d.name}</span>
        <span class="forge-doc-size">${fmtSize(d.size)}</span>
        <button class="forge-doc-x" onclick="forgeRemoveDoc(${i})">✕</button>
      </div>`;
    }).join('');
    docActions.style.display = forgeDocs.length ? 'flex' : 'none';
    docBadge.style.display = forgeDocs.length ? 'flex' : 'none';
    docBadge.textContent = forgeDocs.length;
    if (!forgeDocs.length && docDrawer.classList.contains('open')) docDrawer.classList.remove('open');
  }

  window.forgeToggleDocs = function() {
    docDrawer.classList.toggle('open');
  };

  // ---- CHAT ----
  function forgeBuildPayload() {
    let sys = 'You are RAVEN Forge, a hyper-capable local AI assistant. Be direct, concise, and precise. Use markdown formatting when helpful.';
    if (forgeDocs.length) {
      sys += '\n\nDocuments loaded as context:\n';
      forgeDocs.forEach(d => { sys += `\n<Doc name="${d.name}">\n${d.text.slice(0, 8000)}\n</Doc>\n`; });
      sys += '\nReference these documents when relevant.';
    }
    return [{ role: 'system', content: sys }, ...forgeMessages];
  }

  function forgeMd(text) {
    // Code blocks first
    text = text.replace(/```(\w*)\n?([\s\S]*?)```/g, '<pre><code>$2</code></pre>');
    // Inline code
    text = text.replace(/`([^`]+)`/g, '<code>$1</code>');
    // Bold
    text = text.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
    // Italic
    text = text.replace(/\*(.+?)\*/g, '<em>$1</em>');
    // Unordered lists
    text = text.replace(/^[-*] (.+)$/gm, '<li>$1</li>');
    text = text.replace(/(<li>.*<\/li>\n?)+/g, '<ul>$&</ul>');
    // Ordered lists
    text = text.replace(/^\d+\. (.+)$/gm, '<li>$1</li>');
    // Headers
    text = text.replace(/^### (.+)$/gm, '<strong style="font-size:14px">$1</strong>');
    text = text.replace(/^## (.+)$/gm, '<strong style="font-size:15px">$1</strong>');
    text = text.replace(/^# (.+)$/gm, '<strong style="font-size:16px">$1</strong>');
    // Line breaks
    text = text.replace(/\n/g, '<br>');
    return text;
  }

  function forgeRenderMsg(role, content, streaming) {
    if (welcomeEl) welcomeEl.style.display = 'none';
    const div = document.createElement('div');
    div.className = `forge-msg forge-msg-${role}`;
    const avatar = role === 'assistant' ? `<img src="raven-icon.png" alt="" class="forge-msg-avatar">` : '';
    const cursor = streaming ? '<span class="forge-cursor"></span>' : '';
    div.innerHTML = `${avatar}<div class="forge-msg-bubble">${forgeMd(content)}${cursor}</div>`;
    chatEl.appendChild(div);
    chatEl.scrollTop = chatEl.scrollHeight;
    return div;
  }

  function forgeAddSysMsg(text) {
    const div = document.createElement('div');
    div.className = 'forge-sys';
    div.textContent = text;
    chatEl.appendChild(div);
    chatEl.scrollTop = chatEl.scrollHeight;
  }

  // Render a clean error with hidden debug dropdown
  function forgeShowError(bubble, msg, debugInfo) {
    bubble.innerHTML = `<div style="font-size:13px;line-height:1.7">
      <span style="color:#ccc">${msg}</span>
      <details class="forge-error-details">
        <summary>Debug info ▸</summary>
        <pre>${esc(debugInfo)}</pre>
      </details>
    </div>`;
  }

  window.forgeSend = async function() {
    const text = inputEl.value.trim();
    if (!text || forgeStreaming) return;
    inputEl.value = ''; forgeResizeInput();
    sendBtn.disabled = true; sendBtn.classList.remove('active');

    forgeMessages.push({ role: 'user', content: text });
    forgeRenderMsg('user', text);

    forgeStreaming = true;
    const msgDiv = forgeRenderMsg('assistant', '', true);
    const bubble = msgDiv.querySelector('.forge-msg-bubble');
    let full = '';
    let step = 'init';

    try {
      step = 'build_payload';
      const payload = {
        model: FC.model,
        messages: forgeBuildPayload(),
        stream: true,
        temperature: FC.temp,
        max_tokens: FC.tokens,
      };

      step = 'fetch';
      const res = await fetch(FC.url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
      });

      step = 'status_' + res.status;
      if (!res.ok) {
        const errBody = await res.text();
        forgeShowError(bubble,
          res.status === 404 ? 'Model <strong>' + esc(FC.model) + '</strong> not found. Run: <code>ollama pull ' + esc(FC.model) + '</code>'
          : 'Server returned error ' + res.status + '.',
          'step: ' + step + '\nstatus: ' + res.status + ' ' + res.statusText + '\nbody: ' + errBody.slice(0,500) + '\nurl: ' + FC.url + '\nmodel: ' + FC.model
        );
        forgeMessages.push({ role: 'assistant', content: '(Error)' });
        forgeStreaming = false;
        return;
      }

      step = 'stream';
      const reader = res.body.getReader();
      const dec = new TextDecoder();
      let buf = '';

      while (true) {
        const { done, value } = await reader.read();
        if (done) break;
        buf += dec.decode(value, { stream: true });
        const lines = buf.split('\n');
        buf = lines.pop() || '';
        for (const line of lines) {
          if (!line.startsWith('data: ')) continue;
          const data = line.slice(6).trim();
          if (data === '[DONE]') continue;
          try {
            const j = JSON.parse(data);
            const token = j.choices?.[0]?.delta?.content;
            if (token) {
              full += token;
              bubble.innerHTML = forgeMd(full) + '<span class="forge-cursor"></span>';
              chatEl.scrollTop = chatEl.scrollHeight;
            }
          } catch (pe) { console.warn('[Forge] SSE parse:', pe.message); }
        }
      }
    } catch (e) {
      if (!full) {
        const isNetwork = e.name === 'TypeError' && e.message.includes('fetch');
        forgeShowError(bubble,
          isNetwork ? 'Can\'t reach Ollama. Is it running? → <code>ollama serve</code>' : e.message,
          'step: ' + step + '\nerror: ' + e.name + ': ' + e.message + '\nurl: ' + FC.url + '\nmodel: ' + FC.model + '\ntemp: ' + FC.temp + '\nmax_tokens: ' + FC.tokens
        );
        forgeMessages.push({ role: 'assistant', content: '(Error)' });
        forgeStreaming = false;
        return;
      }
    }

    bubble.innerHTML = forgeMd(full || '(Empty response)');
    forgeMessages.push({ role: 'assistant', content: full });
    forgeStreaming = false;
  };

  // ---- INPUT ----
  window.forgeKeydown = function(e) {
    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); forgeSend(); }
  };

  window.forgeResizeInput = function() {
    inputEl.style.height = 'auto';
    inputEl.style.height = Math.min(inputEl.scrollHeight, 120) + 'px';
    const hasText = inputEl.value.trim().length > 0;
    sendBtn.disabled = !hasText;
    sendBtn.classList.toggle('active', hasText);
  };

  // ---- GATE (smart one-click connection) ----
  const gateEl = document.getElementById('forgeGate');
  const gateBtn = document.getElementById('forgeGateBtn');
  const gateBtnText = document.getElementById('forgeGateBtnText');
  const gateStatus = document.getElementById('forgeGateStatus');

  // Skip gate only if we previously confirmed Ollama was actually reachable
  if (localStorage.getItem('forge_connected')) {
    gateEl.classList.add('dismissed');
  }

  function gateSetStatus(msg, isError) {
    gateStatus.textContent = msg;
    gateStatus.classList.toggle('error', !!isError);
  }

  window.forgeRequestAccess = async function() {
    gateBtn.disabled = true;
    gateBtn.classList.add('loading');
    gateBtnText.textContent = 'Connecting...';
    gateSetStatus('');

    // Base URL: strip /v1/chat/completions to get Ollama root
    const base = FC.url.replace(/\/v1\/chat\/completions\/?$/, '');

    // Step 1: Check if Ollama is reachable at all
    try {
      gateSetStatus('Checking Ollama...');
      const tagRes = await fetch(base + '/api/tags');
      if (!tagRes.ok) throw new Error('tags endpoint returned ' + tagRes.status);
      const tagData = await tagRes.json();
      const models = (tagData.models || []).map(m => m.name || m.model);

      // Step 2: Check if desired model is available
      const wanted = FC.model;
      const hasModel = models.some(m => m === wanted || m.startsWith(wanted + ':'));

      if (hasModel) {
        gateSetStatus('Connected — ' + wanted + ' ready');
        localStorage.setItem('forge_connected', '1');
        setTimeout(() => gateEl.classList.add('dismissed'), 400);
        return;
      }

      // Model not found — try to use whatever is available
      if (models.length > 0) {
        const fallback = models[0].split(':')[0];
        gateSetStatus('Using ' + fallback + ' (preferred ' + wanted + ' not found)');
        localStorage.setItem('forge_model', fallback);
        localStorage.setItem('forge_connected', '1');
        // Update settings inputs
        document.getElementById('forgeSettingModel').value = fallback;
        setTimeout(() => gateEl.classList.add('dismissed'), 600);
        return;
      }

      // Ollama running but no models
      gateSetStatus('Ollama running but no models installed. Run: ollama pull ' + wanted, true);
      gateBtn.disabled = false;
      gateBtn.classList.remove('loading');
      gateBtnText.textContent = 'Retry';

    } catch (e) {
      // Fetch failed — either loopback blocked or Ollama not running
      // The browser loopback dialog fires on the first fetch attempt
      gateSetStatus('Ollama not reachable. Start it: ollama serve', true);
      gateBtn.disabled = false;
      gateBtn.classList.remove('loading');
      gateBtnText.textContent = 'Retry';
    }
  };

  // ---- SETTINGS ----
  window.forgeToggleSettings = function() {
    document.getElementById('forgeModalBg').classList.toggle('open');
  };

  window.forgeSaveSettings = function() {
    localStorage.setItem('forge_api_url', sUrl.value);
    localStorage.setItem('forge_model', sModel.value);
    localStorage.setItem('forge_temp', sTemp.value);
    localStorage.setItem('forge_max_tokens', sTokens.value);
    document.getElementById('forgeModalBg').classList.remove('open');
    showToast('Forge settings saved', true);
  };

  // Drag and drop on the forge container
  const forgeEl = document.querySelector('.forge');
  forgeEl.addEventListener('dragover', e => { e.preventDefault(); });
  forgeEl.addEventListener('drop', e => {
    e.preventDefault();
    if (e.dataTransfer.files.length) forgeAddFiles(e.dataTransfer.files);
  });
})();
</script>
</body>
</html>
