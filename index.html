<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NDi Auto | Home</title>
<meta name="description" content="NDi Auto by Network Designs, Inc. — AI & Automation Research Division. Client-side document serialization for AI-ready corpus generation.">
<link rel="icon" href="robot_white.png" type="image/png">

<!-- Fonts: Nunito Sans (closest free match to Avenir) + DM Mono for data -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,opsz,wght@0,6..12,300;0,6..12,400;0,6..12,600;0,6..12,700;0,6..12,800;0,6..12,900;1,6..12,400&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">

<!-- Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<style>
  /* ===== NDI BRAND TOKENS (from brand guide) ===== */
  :root {
    --n-blue: #022640;
    --n-blue-deep: #011a2e;
    --d-blue: #07B0E8;
    --d-blue-hover: #05a0d4;
    --d-blue-glow: rgba(7,176,232,0.15);
    --d-blue-glow-strong: rgba(7,176,232,0.35);
    --x-blue: #003867;
    --grey-1: #F1F2F2;
    --white: #FFFFFF;
    --text-secondary: #8FA4B3;
    --text-tertiary: #5A7485;
    --surface-0: #011a2e;
    --surface-1: rgba(7,176,232,0.04);
    --surface-2: rgba(7,176,232,0.07);
    --border: rgba(7,176,232,0.12);
    --border-hover: rgba(7,176,232,0.3);
    --success: #00C9A7;
    --success-bg: rgba(0,201,167,0.08);
    --success-border: rgba(0,201,167,0.25);
    --danger: #FF6B6B;
    --radius: 8px;
    --radius-lg: 14px;
  }

  /* ===== RESET & BASE ===== */
  *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
  html { scroll-behavior: smooth; scroll-padding-top: 80px; }

  body {
    background: var(--n-blue-deep);
    color: var(--white);
    font-family: 'Nunito Sans', -apple-system, sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
    line-height: 1.55;
    -webkit-font-smoothing: antialiased;
  }

  /* ===== AMBIENT BACKGROUND ===== */
  body::before {
    content: '';
    position: fixed; inset: 0;
    background:
      radial-gradient(ellipse 80% 60% at 10% 20%, rgba(7,176,232,0.06) 0%, transparent 60%),
      radial-gradient(ellipse 60% 50% at 90% 80%, rgba(0,56,103,0.1) 0%, transparent 60%),
      radial-gradient(ellipse 40% 30% at 50% 0%, rgba(7,176,232,0.04) 0%, transparent 50%);
    pointer-events: none;
    z-index: 0;
  }

  /* ===== GRID OVERLAY (Palantir-style subtle grid) ===== */
  body::after {
    content: '';
    position: fixed; inset: 0;
    background-image:
      linear-gradient(rgba(7,176,232,0.02) 1px, transparent 1px),
      linear-gradient(90deg, rgba(7,176,232,0.02) 1px, transparent 1px);
    background-size: 60px 60px;
    pointer-events: none;
    z-index: 0;
  }

  .app { position: relative; z-index: 1; }

  /* ===== TOPBAR ===== */
  .topbar {
    display: flex; align-items: center; justify-content: space-between;
    padding: 16px 36px;
    border-bottom: 1px solid var(--border);
    backdrop-filter: blur(20px);
    background: rgba(1,26,46,0.8);
    position: sticky; top: 0; z-index: 100;
    transition: background 0.4s ease, border-color 0.4s ease;
  }
  .topbar.dark-mode {
    background: rgba(10,10,10,0.95);
    border-bottom-color: rgba(255,255,255,0.06);
  }
  .topbar.dark-mode .ndi-logo,
  .topbar.dark-mode .topbar-attribution-logo {
    filter: brightness(0) invert(1); transition: filter 0.4s ease;
  }
  .topbar.dark-mode .topbar-divider { background: rgba(255,255,255,0.15); transition: background 0.4s ease; }
  .topbar.dark-mode .topbar-attribution-text { color: #999; }
  .topbar.dark-mode .btn-partner {
    background: rgba(255,255,255,0.1); color: #eee;
    border: 1px solid rgba(255,255,255,0.12);
  }
  .topbar.dark-mode .btn-partner:hover {
    background: rgba(255,255,255,0.18); color: #fff;
    box-shadow: 0 2px 12px rgba(255,255,255,0.1);
  }
  .topbar.dark-mode .btn-partner-divider { background: rgba(255,255,255,0.2); }
  .topbar.dark-mode .sdvosb-logo { filter: none; }
  .topbar-inner {
    display: flex; align-items: center; justify-content: space-between;
    max-width: 975px; margin: 0 auto; width: 100%;
  }
  .topbar-left { display: flex; align-items: center; gap: 16px; }
  .ndi-logo { height: 30px; opacity: 0.95; }
  .topbar-divider { width: 1px; height: 20px; background: var(--border); }
  .topbar-attribution {
    display: flex; align-items: center; gap: 8px;
    text-decoration: none;
  }
  .topbar-attribution-text {
    font-family: 'DM Mono', monospace; font-size: 9px;
    color: var(--text-tertiary); letter-spacing: 1.5px;
    font-weight: 600; text-transform: uppercase;
  }
  .topbar-attribution-logo { height: 18px; opacity: 0.7; transition: opacity 0.2s; }
  .topbar-attribution:hover .topbar-attribution-logo { opacity: 1; }
  .topbar-attribution:hover .topbar-attribution-text { color: #c0d0dc; }
  .topbar-right { display: flex; align-items: center; gap: 16px; }
  .btn-partner {
    display: inline-flex; align-items: center; gap: 8px;
    padding: 0 18px; height: 38px; border-radius: 8px;
    background: var(--grey-1); color: var(--n-blue);
    font-family: 'Nunito Sans', sans-serif;
    font-size: 11px; font-weight: 800; letter-spacing: 0.8px;
    text-decoration: none; transition: all 0.2s;
  }
  .btn-partner:hover {
    background: #fff; color: var(--n-blue-deep);
    box-shadow: 0 2px 12px rgba(241,242,242,0.3);
    transform: translateY(-1px);
  }
  .sdvosb-logo { height: 24px; border-radius: 3px; flex-shrink: 0; }
  .btn-partner-divider {
    width: 1px; height: 14px; background: rgba(2,38,64,0.2);
  }
  .status-dot {
    width: 6px; height: 6px; border-radius: 50%;
    background: var(--success);
    box-shadow: 0 0 8px var(--success);
    animation: pulse-dot 2s ease-in-out infinite;
  }
  @keyframes pulse-dot {
    0%, 100% { opacity: 1; box-shadow: 0 0 8px var(--success); }
    50% { opacity: 0.5; box-shadow: 0 0 4px var(--success); }
  }

  /* ===== HERO (dark landing — compact) ===== */
  .hero {
    position: relative; overflow: hidden;
    padding: 64px 60px 56px;
    animation: fade-up 0.8s ease-out;
    display: flex; align-items: center;
    border-bottom: 1px solid var(--border);
  }
  .hero::before {
    content: '';
    position: absolute; inset: 0;
    background:
      radial-gradient(ellipse 50% 60% at 85% 40%, rgba(7,176,232,0.07) 0%, transparent 70%),
      radial-gradient(ellipse 30% 40% at 15% 70%, rgba(0,201,167,0.03) 0%, transparent 60%);
    pointer-events: none;
  }
  .hero-layout {
    position: relative; z-index: 1;
    display: flex; align-items: center; gap: 60px;
    max-width: 975px; margin: 0 auto; width: 100%;
  }
  .hero-text { flex: 1; min-width: 0; }
  .hero-eyebrow {
    font-family: 'DM Mono', monospace; font-size: 11px;
    color: var(--text-secondary); letter-spacing: 2px; text-transform: uppercase;
    margin-bottom: 16px; font-weight: 600;
  }
  .hero h1 {
    font-size: clamp(36px, 5vw, 64px); font-weight: 900;
    color: #fff; letter-spacing: -1.5px; line-height: 1.05;
    margin-bottom: 8px;
  }
  .hero h1 span {
    background: linear-gradient(135deg, var(--d-blue), #00C9A7);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .hero-division {
    font-family: 'DM Mono', monospace; font-size: 11px;
    color: var(--d-blue); letter-spacing: 2px; font-weight: 700;
    margin-bottom: 24px; text-transform: uppercase;
  }
  .hero-desc {
    font-size: 16px; color: #c0d0dc; max-width: 480px;
    line-height: 1.8; margin-bottom: 32px;
  }
  .hero-desc strong { color: #fff; }
  .hero-ctas { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
  .hero-cta-primary {
    display: inline-flex; align-items: center; gap: 10px;
    padding: 14px 28px; border-radius: 10px;
    background: linear-gradient(135deg, var(--d-blue), var(--x-blue));
    color: #fff; text-decoration: none;
    font-family: 'Nunito Sans', sans-serif;
    font-size: 13px; font-weight: 800; letter-spacing: 1.5px;
    text-transform: uppercase; transition: all 0.3s;
    box-shadow: 0 4px 20px rgba(7,176,232,0.25);
  }
  .hero-cta-primary:hover {
    box-shadow: 0 8px 32px rgba(7,176,232,0.35), 0 0 60px rgba(7,176,232,0.1);
    transform: translateY(-2px);
  }
  .hero-cta-partner {
    display: inline-flex; align-items: center; gap: 8px;
    padding: 0 22px; height: 48px; border-radius: 10px;
    background: var(--grey-1); color: var(--n-blue);
    text-decoration: none;
    font-family: 'Nunito Sans', sans-serif;
    font-size: 11px; font-weight: 800; letter-spacing: 0.8px;
    text-transform: uppercase; transition: all 0.2s;
  }
  .hero-cta-partner:hover {
    background: #fff;
    box-shadow: 0 4px 16px rgba(241,242,242,0.3);
    transform: translateY(-2px);
  }
  .hero-cta-partner-divider {
    width: 1px; height: 16px; background: rgba(2,38,64,0.15);
  }
  .hero-cta-partner img { height: 22px; border-radius: 2px; }
  .hero-status-pill {
    display: inline-flex; align-items: center; gap: 8px;
    margin-bottom: 20px; padding: 6px 16px;
    border-radius: 50px;
    background: rgba(0,201,167,0.08);
    border: 1px solid rgba(0,201,167,0.2);
    font-family: 'DM Mono', monospace; font-size: 10px;
    color: var(--success); letter-spacing: 1px; font-weight: 700;
  }

  /* ===== HERO ROBOT GRAPHIC ===== */
  .hero-graphic {
    flex-shrink: 0; width: 320px; height: 320px;
    position: relative;
    display: flex; align-items: center; justify-content: center;
  }
  /* Hexagonal glow backdrop */
  .hero-hex-glow {
    position: absolute; inset: -10px;
    background:
      radial-gradient(circle at 50% 50%, rgba(7,176,232,0.12) 0%, transparent 60%);
    filter: blur(40px);
    animation: hex-pulse 5s ease-in-out infinite;
  }
  @keyframes hex-pulse {
    0%, 100% { opacity: 0.6; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.08); }
  }
  /* Concentric rings — dashed for tech feel */
  .hero-ring {
    position: absolute; border-radius: 50%;
    border: 1px dashed rgba(7,176,232,0.1);
  }
  .hero-ring-1 { inset: 40px; border-style: solid; border-color: rgba(7,176,232,0.15); }
  .hero-ring-2 { inset: 10px; animation: ring-rotate 40s linear infinite; }
  .hero-ring-3 { inset: -20px; border-color: rgba(7,176,232,0.06); animation: ring-rotate 60s linear infinite reverse; }
  @keyframes ring-rotate { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  /* Orbiting nodes on ring 2 */
  .hero-ring-2::before, .hero-ring-2::after {
    content: ''; position: absolute;
    width: 8px; height: 8px; border-radius: 50%;
    background: var(--d-blue);
    box-shadow: 0 0 16px rgba(7,176,232,0.7), 0 0 4px rgba(7,176,232,0.9);
  }
  .hero-ring-2::before { top: -4px; left: 50%; transform: translateX(-50%); }
  .hero-ring-2::after { bottom: -4px; left: 50%; transform: translateX(-50%); background: var(--success); box-shadow: 0 0 16px rgba(0,201,167,0.6); }
  /* Corner brackets (tech HUD feel) */
  .hero-bracket {
    position: absolute; width: 20px; height: 20px;
    border-color: rgba(7,176,232,0.25); border-style: solid; border-width: 0;
  }
  .hero-bracket-tl { top: 30px; left: 30px; border-top-width: 1.5px; border-left-width: 1.5px; }
  .hero-bracket-tr { top: 30px; right: 30px; border-top-width: 1.5px; border-right-width: 1.5px; }
  .hero-bracket-bl { bottom: 30px; left: 30px; border-bottom-width: 1.5px; border-left-width: 1.5px; }
  .hero-bracket-br { bottom: 30px; right: 30px; border-bottom-width: 1.5px; border-right-width: 1.5px; }
  /* Robot image */
  .hero-robot-container {
    position: relative; z-index: 2;
    width: 180px; height: 180px;
  }
  .hero-robot-container img {
    width: 100%; height: 100%; object-fit: contain;
    filter: drop-shadow(0 0 30px rgba(7,176,232,0.25)) drop-shadow(0 12px 40px rgba(0,0,0,0.3));
    animation: robot-float 6s ease-in-out infinite;
  }
  @keyframes robot-float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }
  /* Status readout under robot */
  .hero-robot-status {
    position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
    z-index: 3;
    font-family: 'DM Mono', monospace; font-size: 9px;
    color: var(--d-blue); letter-spacing: 2px;
    text-transform: uppercase; white-space: nowrap;
    opacity: 0.6;
  }
  /* Scan line */
  .hero-scan-line {
    position: absolute; z-index: 1;
    width: 200px; height: 1px; left: 50%; transform: translateX(-50%);
    background: linear-gradient(90deg, transparent, rgba(7,176,232,0.3), transparent);
    animation: scan-sweep 5s ease-in-out infinite;
  }
  @keyframes scan-sweep {
    0%, 100% { top: 35%; opacity: 0; }
    15% { opacity: 1; }
    50% { top: 65%; opacity: 0.8; }
    85% { opacity: 0; }
  }

  /* ===== MAIN CONTENT ===== */
  .main { max-width: 975px; margin: 0 auto; padding: 48px 24px 80px; }

  /* ===== NO-CLOUD ICON (replaces "Free Forever") ===== */
  .no-cloud-icon {
    display: inline-block; position: relative;
    width: 22px; height: 18px; vertical-align: -3px; margin-right: 4px;
  }
  .no-cloud-icon svg { width: 100%; height: 100%; }


  /* ===== DROP ZONE ===== */
  .drop-zone {
    position: relative;
    border: 1.5px dashed var(--border-hover);
    border-radius: var(--radius-lg);
    padding: 60px 32px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background: var(--surface-1);
    overflow: hidden;
    animation: fade-up 0.8s ease-out 0.2s both;
  }
  .drop-zone::before {
    content: ''; position: absolute; inset: 0;
    border-radius: var(--radius-lg);
    background: radial-gradient(ellipse at center, var(--d-blue-glow) 0%, transparent 70%);
    opacity: 0; transition: opacity 0.4s;
  }
  .drop-zone:hover, .drop-zone.dragover {
    border-color: var(--d-blue);
    background: var(--surface-2);
  }
  .drop-zone:hover::before, .drop-zone.dragover::before { opacity: 1; }
  .drop-zone input {
    position: absolute; inset: 0; opacity: 0; cursor: pointer; z-index: 2;
  }
  .drop-icon {
    position: relative; z-index: 1;
    width: 56px; height: 56px; margin: 0 auto 20px;
    border-radius: 12px;
    background: var(--surface-2);
    border: 1px solid var(--border);
    display: flex; align-items: center; justify-content: center;
    transition: all 0.3s;
  }
  .drop-zone:hover .drop-icon {
    border-color: var(--d-blue);
    box-shadow: 0 0 20px var(--d-blue-glow);
  }
  .drop-icon svg { width: 24px; height: 24px; }
  .drop-title {
    position: relative; z-index: 1;
    font-size: 20px; font-weight: 800; color: #fff; margin-bottom: 8px;
  }
  .drop-sub {
    position: relative; z-index: 1;
    font-size: 15px; color: #c0d0dc; font-weight: 500;
  }
  .drop-formats {
    position: relative; z-index: 1;
    display: flex; gap: 8px; justify-content: center; margin-top: 20px;
    flex-wrap: wrap;
  }
  .format-chip {
    font-family: 'DM Mono', monospace; font-size: 13px;
    padding: 8px 16px; border-radius: 6px;
    letter-spacing: 0.5px; font-weight: 500;
  }
  .format-chip-pdf { background: rgba(220,53,69,0.12); border: 1px solid rgba(220,53,69,0.3); color: #e85d6f; }
  .format-chip-docx { background: rgba(43,87,154,0.12); border: 1px solid rgba(43,87,154,0.3); color: #5b9aed; }
  .format-chip-pptx { background: rgba(209,105,46,0.12); border: 1px solid rgba(209,105,46,0.3); color: #e8874a; }
  .format-chip-xlsx { background: rgba(33,115,70,0.12); border: 1px solid rgba(33,115,70,0.3); color: #3dbf6e; }
  .format-chip-csv { background: rgba(130,150,50,0.12); border: 1px solid rgba(130,150,50,0.3); color: #a8b84a; }
  .format-chip-txt { background: rgba(140,140,140,0.12); border: 1px solid rgba(140,140,140,0.3); color: #a0a0a0; }

  /* ===== FILE LIST ===== */
  .file-list { margin-top: 20px; }
  .file-item {
    display: flex; align-items: center; justify-content: space-between;
    padding: 12px 16px; margin-bottom: 4px;
    background: var(--surface-1);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    transition: all 0.2s;
    animation: fade-up 0.25s ease-out;
  }
  .file-item:hover { border-color: var(--border-hover); }
  .file-info { display: flex; align-items: center; gap: 12px; min-width: 0; }
  .file-ext {
    font-family: 'DM Mono', monospace; font-size: 9px; font-weight: 600;
    padding: 4px 8px; border-radius: 4px; letter-spacing: 0.8px;
    text-transform: uppercase; flex-shrink: 0;
  }
  .file-name {
    font-size: 15px; font-weight: 700; color: #fff;
    overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
  }
  .file-meta { display: flex; align-items: center; gap: 12px; flex-shrink: 0; }
  .file-size {
    font-family: 'DM Mono', monospace; font-size: 13px; color: #c0d0dc;
  }
  .file-remove {
    width: 24px; height: 24px; border-radius: 4px;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; color: var(--text-tertiary);
    transition: all 0.15s; border: none; background: transparent;
    font-size: 14px; font-family: inherit;
  }
  .file-remove:hover { color: var(--danger); background: rgba(255,107,107,0.1); }

  /* ===== STAGED INFO ===== */
  .staged-bar {
    display: none;
    justify-content: space-between; align-items: center;
    margin-top: 16px; padding: 14px 18px;
    background: var(--surface-1);
    border: 1px solid var(--border);
    border-radius: var(--radius);
  }
  .staged-bar.visible { display: flex; }
  .staged-text {
    font-family: 'DM Mono', monospace; font-size: 14px; color: #c0d0dc; font-weight: 500;
  }
  .staged-count { color: var(--d-blue); font-weight: 500; }
  .staged-actions { display: flex; align-items: center; gap: 8px; }
  .btn-sort, .btn-clear-all {
    display: inline-flex; align-items: center; gap: 6px;
    padding: 6px 14px; border-radius: 6px;
    background: rgba(140,140,140,0.1); border: 1px solid rgba(140,140,140,0.2);
    color: #8fa4b3; font-family: 'DM Mono', monospace;
    font-size: 11px; font-weight: 600; letter-spacing: 0.5px;
    cursor: pointer; transition: all 0.2s;
  }
  .btn-sort:hover {
    background: rgba(7,176,232,0.1); border-color: rgba(7,176,232,0.3);
    color: var(--d-blue);
  }
  .btn-sort.active {
    background: rgba(7,176,232,0.08); border-color: rgba(7,176,232,0.25);
    color: var(--d-blue);
  }
  .btn-clear-all:hover {
    background: rgba(255,107,107,0.1); border-color: rgba(255,107,107,0.3);
    color: var(--danger);
  }

  /* ===== BUTTON ===== */
  .btn-process-wrap { position: relative; margin-top: 24px; }
  .btn-process {
    width: 100%; height: 64px;
    border: none; border-radius: 10px;
    font-family: 'Nunito Sans', sans-serif;
    font-size: 16px; font-weight: 900; letter-spacing: 2.5px;
    text-transform: uppercase; cursor: pointer;
    color: #fff;
    background: linear-gradient(135deg, var(--x-blue), var(--n-blue));
    position: relative; overflow: hidden;
    transition: all 0.3s;
    box-shadow: 0 4px 16px rgba(7,176,232,0.2);
  }
  .btn-process .btn-label { position: relative; z-index: 2; transition: opacity 0.3s; }
  .btn-process::before {
    content: ''; position: absolute; inset: 0;
    background: linear-gradient(135deg, var(--d-blue-hover), var(--d-blue));
    opacity: 0; transition: opacity 0.3s;
  }
  .btn-process:hover::before { opacity: 1; }
  .btn-process:hover {
    box-shadow: 0 4px 24px rgba(7,176,232,0.3), 0 0 60px rgba(7,176,232,0.1);
    transform: translateY(-1px);
  }
  .btn-process:disabled {
    opacity: 0.25; cursor: not-allowed; transform: none;
    box-shadow: none;
  }
  .btn-process:disabled::before { display: none; }
  .btn-process.processing {
    cursor: default; pointer-events: none;
    background: var(--surface-1); border: 1px solid var(--border);
    box-shadow: none;
  }
  .btn-process.processing::before { display: none; }
  .btn-process.processing .btn-label { opacity: 0; }

  /* Laser fill overlay */
  .btn-laser {
    position: absolute; top: 0; left: 0; bottom: 0; width: 0%;
    background: linear-gradient(90deg, var(--d-blue) 0%, #0ad4ff 70%, #5de8ff 100%);
    border-radius: 10px 0 0 10px;
    z-index: 1;
    box-shadow: 4px 0 24px rgba(7,176,232,0.5), 0 0 40px rgba(7,176,232,0.15);
  }
  .btn-laser::after {
    content: ''; position: absolute; top: 0; right: -2px; bottom: 0; width: 6px;
    background: #fff; border-radius: 0 1px 1px 0;
    box-shadow: 0 0 16px rgba(255,255,255,0.9), 0 0 40px rgba(7,176,232,0.8);
    opacity: 0.9;
  }

  /* Rolling status text */
  .process-status {
    position: absolute; inset: 0; z-index: 2;
    display: flex; align-items: center; justify-content: center;
    font-family: 'DM Mono', monospace; font-size: 13px; font-weight: 600;
    color: rgba(255,255,255,0.95); letter-spacing: 0.8px;
    pointer-events: none;
  }
  .process-status span {
    animation: status-roll 0.4s ease-out;
  }
  @keyframes status-roll {
    from { opacity: 0; transform: translateY(12px); filter: blur(2px); }
    to { opacity: 1; transform: translateY(0); filter: blur(0); }
  }

  /* Done state */
  .btn-process.done {
    background: var(--success); cursor: default; pointer-events: none;
    box-shadow: 0 4px 20px rgba(46,204,113,0.3);
  }
  .btn-process.done::before { display: none; }
  .btn-process.done .btn-label { opacity: 1; }

  /* ===== RESULT ===== */
  .result-section { display: none; margin-top: 8px; }
  .result-section.visible { display: block; animation: fade-up 0.4s ease-out; }
  .result-actions { display: flex; gap: 6px; width: 100%; }
  .btn-action {
    display: inline-flex; align-items: center; justify-content: center; gap: 8px;
    height: 42px;
    font-family: 'DM Mono', monospace;
    font-size: 11px; font-weight: 600; letter-spacing: 0.5px;
    cursor: pointer;
    transition: all 0.2s;
    background: rgba(7,176,232,0.06);
    border: 1px solid rgba(7,176,232,0.2);
    color: var(--d-blue);
    border-radius: 8px;
  }
  .btn-action:hover {
    background: rgba(7,176,232,0.12);
    border-color: rgba(7,176,232,0.35);
    color: #fff;
  }
  .btn-action-download { flex: 3; }
  .btn-action-copy { flex: 2; }

  /* ===== PROMPT SECTION ===== */
  .prompt-section {
    margin-top: 40px; padding-top: 32px;
    border-top: 1px solid var(--border);
    animation: fade-up 0.8s ease-out 0.3s both;
  }
  .section-header {
    display: flex; align-items: center; justify-content: space-between;
    margin-bottom: 16px; flex-wrap: wrap; gap: 8px;
  }
  .section-title {
    font-size: 12px; font-weight: 700; color: var(--text-secondary);
    text-transform: uppercase; letter-spacing: 1.5px;
  }
  .section-badge {
    font-family: 'DM Mono', monospace; font-size: 9px;
    padding: 3px 8px; border-radius: 3px;
    background: var(--success-bg); border: 1px solid var(--success-border);
    color: var(--success); letter-spacing: 0.8px;
  }
  .prompt-box {
    background: var(--surface-0);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px;
    font-family: 'DM Mono', monospace; font-size: 11.5px;
    color: var(--text-tertiary); line-height: 1.7;
    max-height: 180px; overflow-y: auto;
    white-space: pre-wrap; word-break: break-word;
  }
  .prompt-box::-webkit-scrollbar { width: 4px; }
  .prompt-box::-webkit-scrollbar-track { background: transparent; }
  .prompt-box::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  .super-prompt-hint {
    font-family: 'DM Mono', monospace; font-size: 11px;
    color: var(--text-tertiary); letter-spacing: 0.3px;
  }

  /* ===== WORKS WITH MARQUEE ===== */
  .works-with {
    margin-top: 24px; padding-top: 20px;
    border-top: 1px solid var(--border);
  }
  .works-with-label {
    font-family: 'DM Mono', monospace; font-size: 13px;
    color: #c0d0dc; text-transform: uppercase;
    letter-spacing: 1.5px; margin-bottom: 14px; font-weight: 600;
  }
  .marquee-mask {
    overflow: hidden;
    -webkit-mask-image: linear-gradient(90deg, transparent 0%, black 8%, black 92%, transparent 100%);
    mask-image: linear-gradient(90deg, transparent 0%, black 8%, black 92%, transparent 100%);
  }
  .marquee-track {
    display: flex; gap: 10px;
    width: max-content;
    animation: marquee-scroll 35s linear infinite;
  }
  .marquee-track:hover { animation-play-state: paused; }
  @keyframes marquee-scroll {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }
  .ai-logo-chip {
    display: inline-flex; align-items: center; gap: 7px;
    padding: 8px 14px; border-radius: 6px;
    background: var(--surface-1);
    border: 1px solid var(--border);
    font-size: 13px; font-weight: 700; color: #c0d0dc;
    transition: all 0.2s;
    white-space: nowrap; flex-shrink: 0;
  }
  .marquee-track:hover .ai-logo-chip { border-color: var(--border-hover); }
  .ai-logo-chip img {
    width: 16px; height: 16px; border-radius: 3px;
    object-fit: contain;
  }

  /* ===== SUPERPROMPT HERO ===== */
  .sp-hero {
    position: relative; overflow: hidden;
    background: #fff;
    border-top: 3px solid var(--d-blue);
    border-bottom: 3px solid var(--d-blue);
    margin-top: 56px;
    padding: 64px 32px;
    text-align: center;
    animation: fade-up 0.8s ease-out 0.2s both;
  }
  .sp-hero-glow {
    position: absolute; top: 0; left: 0; right: 0; height: 3px;
    background: linear-gradient(90deg, transparent, var(--d-blue), var(--success), var(--d-blue), transparent);
    background-size: 200% 100%;
    animation: glow-sweep 4s ease-in-out infinite;
  }
  .sp-hero-content { position: relative; z-index: 1; max-width: 975px; margin: 0 auto; }
  .sp-hero-badge {
    display: inline-block;
    font-family: 'DM Mono', monospace; font-size: 12px;
    color: var(--d-blue); letter-spacing: 3px; text-transform: uppercase;
    font-weight: 700; margin-bottom: 20px;
    padding: 6px 16px; border-radius: 50px;
    border: 1.5px solid var(--d-blue);
    background: rgba(7,176,232,0.06);
  }
  .sp-hero-title {
    font-size: clamp(32px, 5vw, 52px); font-weight: 900;
    color: var(--n-blue); letter-spacing: -1px; line-height: 1.1;
    margin-bottom: 18px;
  }
  .sp-hero-title span {
    background: linear-gradient(135deg, var(--d-blue), #00C9A7);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .sp-hero-sub {
    font-size: 18px; color: #3a5568; max-width: 580px;
    margin: 0 auto; line-height: 1.7;
  }
  .sp-hero-stats {
    display: inline-flex; align-items: center; gap: 24px;
    margin-top: 28px; padding: 16px 32px;
    background: var(--n-blue); border-radius: 12px;
    box-shadow: 0 4px 20px rgba(2,38,64,0.3);
  }
  .sp-hero-stat { text-align: center; }
  .sp-hero-stat-value {
    display: block; font-family: 'DM Mono', monospace;
    font-size: 20px; font-weight: 700; color: #fff; letter-spacing: 0.5px;
  }
  .sp-hero-stat-label {
    display: block; font-size: 11px; color: rgba(255,255,255,0.6);
    text-transform: uppercase; letter-spacing: 1px; margin-top: 4px;
  }
  .sp-hero-stat-note {
    display: block; font-family: 'Nunito Sans', sans-serif;
    font-size: 9px; color: rgba(255,255,255,0.4);
    letter-spacing: 0.5px; margin-top: 2px; font-style: italic;
  }
  .sp-hero-stat-divider {
    width: 1px; height: 32px; background: rgba(255,255,255,0.15);
  }

  /* ===== NDi SUPER PROMPT™ ===== */
  .super-prompt-section {
    margin-top: 48px; padding-top: 40px;
    border-top: 1px solid var(--border);
    animation: fade-up 0.8s ease-out 0.3s both;
  }
  .super-prompt-header {
    display: flex; align-items: center; gap: 16px;
    margin-bottom: 24px; justify-content: space-between;
  }
  .super-prompt-header-left {
    display: flex; align-items: center; gap: 16px;
  }
  .super-prompt-icon {
    width: 52px; height: 52px; border-radius: 12px;
    background: linear-gradient(135deg, rgba(7,176,232,0.15), rgba(0,56,103,0.2));
    border: 1px solid var(--border-hover);
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
  }
  .super-prompt-title {
    font-size: 26px; font-weight: 900; color: #fff;
    letter-spacing: -0.3px;
  }
  .super-prompt-sub {
    font-size: 15px; color: #c0d0dc; margin-top: 4px; font-weight: 500;
  }
  .super-prompt-card {
    position: relative;
    background: var(--surface-0);
    border: 1px solid var(--border-hover);
    border-radius: var(--radius-lg);
    overflow: hidden;
  }
  .super-prompt-glow {
    position: absolute; top: 0; left: 0; right: 0; height: 2px;
    background: linear-gradient(90deg, transparent, var(--d-blue), var(--success), var(--d-blue), transparent);
    background-size: 200% 100%;
    animation: glow-sweep 4s ease-in-out infinite;
  }
  @keyframes glow-sweep {
    0%, 100% { background-position: -200% 0; }
    50% { background-position: 200% 0; }
  }
  .super-prompt-content {
    padding: 24px;
    font-family: 'DM Mono', monospace; font-size: 13px;
    color: #c0d0dc; line-height: 1.8;
    max-height: 340px; overflow-y: auto;
    white-space: pre-wrap; word-break: break-word;
  }
  .super-prompt-content::-webkit-scrollbar { width: 4px; }
  .super-prompt-content::-webkit-scrollbar-track { background: transparent; }
  .super-prompt-content::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
  .super-prompt-actions {
    display: flex; align-items: center; gap: 16px;
    margin-top: 16px; flex-wrap: wrap;
  }
  .btn-action-primary {
    background: linear-gradient(135deg, var(--d-blue), var(--x-blue));
    border: none; color: #fff;
  }
  .btn-action-primary:hover {
    background: linear-gradient(135deg, var(--d-blue-hover), var(--d-blue));
    border: none; color: #fff;
  }
  .btn-super {
    padding: 0 28px !important; height: 48px !important;
    font-size: 13px !important;
    box-shadow: 0 0 20px rgba(7,176,232,0.15);
  }
  .btn-super:hover {
    box-shadow: 0 0 30px rgba(7,176,232,0.3) !important;
  }
  .super-prompt-hint {
    font-family: 'DM Mono', monospace; font-size: 11px;
    color: var(--text-tertiary); letter-spacing: 0.3px;
  }

  /* ===== RAVEN CTA ===== */
  .raven-cta-wrap {
    position: relative;
    padding: 56px 24px;
    background: #ffffff;
    border-top: 3px solid #F8B42C;
  }
  .raven-cta-glow {
    position: absolute; top: 0; left: 0; right: 0; height: 3px;
    background: linear-gradient(90deg, transparent, #F8B42C, #ff6b3d, #F8B42C, transparent);
    background-size: 200% 100%;
    animation: glow-sweep 4s ease-in-out infinite;
  }
  .raven-cta {
    max-width: 975px; margin: 0 auto;
    display: flex; align-items: center; gap: 40px;
  }
  .raven-cta-text {
    text-align: left;
    flex: 2;
    min-width: 0;
  }
  .raven-cta-title {
    font-size: 30px; font-weight: 900; color: #1a1a1a;
    letter-spacing: -0.5px; margin-bottom: 8px; line-height: 1.15;
  }
  .raven-cta-desc {
    font-size: 14px; color: #555; line-height: 1.7;
  }
  .raven-cta-icon {
    flex-shrink: 0;
    width: 96px; height: 96px; border-radius: 20px;
    object-fit: contain;
    filter: drop-shadow(0 4px 12px rgba(0,0,0,0.12));
  }
  .raven-cta-action {
    flex-shrink: 0;
    display: flex; flex-direction: column;
    align-items: center; gap: 0;
  }
  .raven-cta-action-link {
    display: flex; flex-direction: column;
    align-items: center; gap: 0;
    text-decoration: none; color: inherit;
    transition: transform 0.3s ease;
    cursor: pointer;
  }
  .raven-cta-action-link:hover {
    transform: translateY(-3px);
  }
  .raven-cta-action-link:hover .raven-cta-social {
    box-shadow: 0 12px 40px rgba(0,0,0,0.28), 0 4px 12px rgba(0,0,0,0.12);
  }
  .raven-cta-action-link:hover .raven-cta-btn {
    background: #000;
    box-shadow: 0 8px 28px rgba(0,0,0,0.25);
  }
  .raven-cta-social {
    width: 240px;
    border-radius: 14px 14px 0 0;
    object-fit: cover;
    box-shadow: 0 8px 32px rgba(0,0,0,0.2), 0 2px 8px rgba(0,0,0,0.08);
    transition: box-shadow 0.3s ease;
  }
  .raven-cta-btn {
    width: 240px; box-sizing: border-box;
    display: flex; align-items: center; justify-content: center; gap: 10px;
    padding: 13px 28px;
    border-radius: 0 0 14px 14px;
    background: #1a1a1a; color: #fff;
    font-family: 'Nunito Sans', sans-serif;
    font-size: 11px; font-weight: 800; letter-spacing: 1.5px;
    text-transform: uppercase; transition: all 0.3s;
    box-shadow: 0 8px 32px rgba(0,0,0,0.2), 0 2px 8px rgba(0,0,0,0.08);
  }
  @media (max-width: 768px) {
    .raven-cta { flex-direction: column; gap: 28px; text-align: center; }
    .raven-cta-icon { width: 72px; height: 72px; }
    .raven-cta-text { text-align: center; }
    .raven-cta-desc { margin: 0 auto; }
  }

  /* ===== FOOTER ===== */
  .footer {
    border-top: 1px solid rgba(2,38,64,0.08);
    background: #fff;
    padding: 0;
  }
  .footer-inner {
    max-width: 975px; margin: 0 auto;
    padding: 56px 32px 0;
  }
  /* Certification logos bar — full width, dark blue tint */
  .footer-certs {
    display: flex; align-items: center; justify-content: center;
    padding: 16px 0;
    position: relative;
  }
  .footer-certs img {
    width: 100%; max-width: 100%; height: auto;
    object-fit: contain;
    filter: brightness(0) saturate(100%) invert(10%) sepia(60%) saturate(1200%) hue-rotate(180deg) brightness(0.7);
    opacity: 0.7; transition: opacity 0.2s;
  }
  .footer-certs img:hover { opacity: 0.9; }
  /* Main footer grid */
  .footer-grid {
    display: grid;
    grid-template-columns: 1.4fr 1fr 1fr 1fr;
    gap: 40px;
    padding-bottom: 48px;
    border-bottom: 1px solid rgba(2,38,64,0.08);
  }
  .footer-brand-logo { height: 28px; margin-bottom: 16px; opacity: 0.9; }
  .footer-brand-desc {
    font-size: 13px; color: #5a7485; line-height: 1.75; margin-bottom: 20px;
  }
  .footer-sdvosb {
    display: inline-flex; align-items: center; gap: 8px;
    font-family: 'DM Mono', monospace; font-size: 10px;
    color: var(--success); letter-spacing: 1px;
    text-transform: uppercase; font-weight: 700;
  }
  .footer-sdvosb-dot {
    width: 6px; height: 6px; border-radius: 50%;
    background: var(--success); box-shadow: 0 0 6px var(--success);
  }
  .footer-col-title {
    font-family: 'DM Mono', monospace; font-size: 10px;
    color: var(--n-blue); letter-spacing: 2px;
    text-transform: uppercase; font-weight: 700;
    margin-bottom: 20px;
  }
  .footer-links { list-style: none; }
  .footer-links li { margin-bottom: 10px; }
  .footer-links a {
    font-size: 13px; color: #5a7485; text-decoration: none;
    transition: color 0.2s; letter-spacing: 0.2px;
  }
  .footer-links a:hover { color: var(--n-blue); }
  .footer-contact-item {
    font-size: 13px; color: #5a7485; margin-bottom: 10px;
    line-height: 1.6;
  }
  .footer-contact-item strong { color: var(--n-blue); font-weight: 700; }
  .footer-contact-item a { color: var(--d-blue); text-decoration: none; }
  .footer-contact-item a:hover { text-decoration: underline; }
  /* Social */
  .footer-social {
    display: flex; gap: 10px; margin-top: 16px;
  }
  .footer-social a {
    display: flex; align-items: center; justify-content: center;
    width: 36px; height: 36px; border-radius: 8px;
    background: rgba(2,38,64,0.04);
    border: 1px solid rgba(2,38,64,0.1);
    color: #5a7485; transition: all 0.2s;
  }
  .footer-social a:hover {
    border-color: var(--d-blue); color: var(--d-blue);
    background: rgba(7,176,232,0.06);
  }
  /* Bottom bar */
  .footer-bottom {
    display: flex; justify-content: space-between; align-items: center;
    padding: 20px 0;
    font-size: 12px; color: #8fa4b3; letter-spacing: 0.3px;
  }
  .footer-bottom a { color: #5a7485; text-decoration: none; transition: color 0.2s; }
  .footer-bottom a:hover { color: var(--d-blue); }
  .footer-bottom-links { display: flex; gap: 20px; }

  @media (max-width: 768px) {
    .footer-grid { grid-template-columns: 1fr; gap: 32px; }
    .footer-bottom { flex-direction: column; gap: 8px; text-align: center; }
    .footer-certs { flex-wrap: wrap; gap: 16px; }
  }

  /* ===== FORGE HERO ===== */
  .forge-hero {
    position: relative; overflow: hidden;
    background: #fff;
    padding: 48px 32px 40px;
    text-align: center;
  }
  .forge-hero-content { position: relative; z-index: 1; max-width: 975px; margin: 0 auto; }
  .forge-hero-badge {
    display: inline-block;
    font-family: 'DM Mono', monospace; font-size: 12px;
    color: #F8B42C; letter-spacing: 3px; text-transform: uppercase;
    font-weight: 700; margin-bottom: 20px;
    padding: 6px 16px; border-radius: 50px;
    border: 1.5px solid #F8B42C;
    background: rgba(248,180,44,0.06);
  }
  .forge-hero-title {
    font-size: clamp(32px, 5vw, 52px); font-weight: 900;
    color: #111; letter-spacing: -1px; line-height: 1.1;
    margin-bottom: 18px;
  }
  .forge-hero-title span {
    color: #F8B42C;
  }
  .forge-hero-sub {
    font-size: 18px; color: #444; max-width: 580px;
    margin: 0 auto; line-height: 1.7;
  }
  .forge-hero-sub strong { color: #111; }
  .forge-hero-stats {
    display: inline-flex; align-items: center; gap: 24px;
    margin-top: 28px; padding: 16px 32px;
    background: #1a1a1a; border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
  }
  .forge-hero-stat { text-align: center; }
  .forge-hero-stat-value {
    display: block; font-family: 'DM Mono', monospace;
    font-size: 20px; font-weight: 700; color: #F8B42C; letter-spacing: 0.5px;
  }
  .forge-hero-stat-label {
    display: block; font-size: 11px; color: rgba(255,255,255,0.55);
    text-transform: uppercase; letter-spacing: 1px; margin-top: 4px;
  }
  .forge-hero-stat-divider {
    width: 1px; height: 32px; background: rgba(255,255,255,0.1);
  }

  /* ===== RAVEN FORGE ===== */
  .forge-wrap {
    background: #fff;
    padding: 48px 24px 40px;
  }
  .forge {
    max-width: 975px; margin: 0 auto;
    height: 600px;
    display: flex; flex-direction: column;
    background: #242424;
    border-radius: 14px;
    overflow: hidden;
    border: 1px solid rgba(255,255,255,0.08);
    box-shadow: 0 8px 40px rgba(0,0,0,0.18), 0 2px 10px rgba(0,0,0,0.08);
  }
  .forge-head {
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 18px; height: 44px; flex-shrink: 0;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    background: #1e1e1e;
  }
  .forge-head-left { display: flex; align-items: center; gap: 10px; }
  .forge-head-icon { width: 20px; height: 20px; border-radius: 5px; }
  .forge-head-title {
    font-family: 'DM Mono', monospace; font-size: 11px; font-weight: 700;
    color: #e8e8e8; letter-spacing: 2px; text-transform: uppercase;
  }
  .forge-head-right { display: flex; align-items: center; gap: 10px; }
  .forge-pill {
    font-family: 'DM Mono', monospace; font-size: 9px; font-weight: 700;
    color: #F8B42C; letter-spacing: 1.5px; text-transform: uppercase;
    padding: 3px 8px; border-radius: 4px;
    border: 1px solid rgba(248,180,44,0.35);
    background: rgba(248,180,44,0.08);
  }
  .forge-gear {
    background: none; border: none; color: #888; cursor: pointer;
    padding: 4px; border-radius: 4px; transition: color 0.2s;
    display: flex; align-items: center;
  }
  .forge-gear:hover { color: #ddd; }

  /* Chat */
  .forge-chat {
    flex: 1; overflow-y: auto; padding: 20px 18px;
    display: flex; flex-direction: column; gap: 16px;
    scroll-behavior: smooth;
  }
  .forge-chat::-webkit-scrollbar { width: 4px; }
  .forge-chat::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 2px; }
  .forge-welcome {
    flex: 1; display: flex; flex-direction: column;
    align-items: center; justify-content: center; gap: 12px;
  }
  .forge-welcome img { width: 48px; height: 48px; opacity: 0.35; border-radius: 12px; }
  .forge-welcome span {
    font-family: 'DM Mono', monospace; font-size: 12px;
    color: #888; letter-spacing: 0.5px;
  }
  .forge-msg { display: flex; gap: 8px; max-width: 85%; animation: fade-up 0.25s ease-out; }
  .forge-msg-assistant { align-self: flex-start; }
  .forge-msg-user { align-self: flex-end; flex-direction: row-reverse; }
  .forge-msg-avatar {
    width: 20px; height: 20px; border-radius: 5px;
    flex-shrink: 0; margin-top: 11px; /* 10px bubble padding + 1px to center with first text line */
  }
  .forge-msg-user .forge-msg-avatar { display: none; }
  .forge-msg-bubble {
    padding: 10px 14px; border-radius: 12px;
    font-size: 13.5px; line-height: 1.6; color: #ececec;
    word-break: break-word;
  }
  .forge-msg-assistant .forge-msg-bubble {
    background: #303030;
    border: 1px solid rgba(255,255,255,0.07);
  }
  .forge-msg-user .forge-msg-bubble {
    background: #362f1f;
    border: 1px solid rgba(248,180,44,0.12);
    border-left: 2px solid rgba(248,180,44,0.4);
  }
  .forge-msg-bubble code {
    background: rgba(255,255,255,0.08); padding: 1px 5px;
    border-radius: 3px; font-family: 'DM Mono', monospace; font-size: 12px;
    color: #F8B42C;
  }
  .forge-msg-bubble pre {
    background: #161616; padding: 12px; border-radius: 8px;
    overflow-x: auto; margin: 8px 0; font-size: 12px;
    border: 1px solid rgba(255,255,255,0.08);
  }
  .forge-msg-bubble pre code { background: none; padding: 0; color: #ddd; }
  .forge-msg-bubble strong { color: #fff; }
  .forge-msg-bubble ul, .forge-msg-bubble ol { padding-left: 20px; margin: 6px 0; }
  .forge-msg-bubble ul { list-style: disc; }
  .forge-msg-bubble ol { list-style: decimal; }
  .forge-msg-bubble li { margin: 3px 0; line-height: 1.5; }
  .forge-msg-bubble h2, .forge-msg-bubble h3, .forge-msg-bubble h4 { line-height: 1.3; }
  /* Error bubble */
  .forge-error-details {
    margin-top: 10px; border: none; font-size: 11px;
  }
  .forge-error-details summary {
    cursor: pointer; color: #555; font-family: 'DM Mono', monospace;
    font-size: 10px; letter-spacing: 0.5px; user-select: none;
    padding: 4px 0;
  }
  .forge-error-details summary:hover { color: #888; }
  .forge-error-details pre {
    margin: 6px 0 0; padding: 10px; border-radius: 6px;
    background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.04);
    color: #555; font-family: 'DM Mono', monospace; font-size: 10px;
    line-height: 1.6; white-space: pre-wrap; word-break: break-all;
  }
  .forge-cursor {
    display: inline-block; width: 2px; height: 15px;
    background: #F8B42C; margin-left: 1px; vertical-align: text-bottom;
    animation: forge-blink 1s ease-in-out infinite;
    border-radius: 1px;
  }
  @keyframes forge-blink { 0%,100%{opacity:1} 50%{opacity:0.2} }
  .forge-sys {
    text-align: center; font-family: 'DM Mono', monospace;
    font-size: 11px; color: #888; letter-spacing: 0.3px;
    padding: 4px 0;
  }

  /* Input bar */
  .forge-input-wrap {
    flex-shrink: 0; position: relative;
    border-top: 1px solid rgba(255,255,255,0.1);
    background: #1e1e1e;
  }
  .forge-bar {
    display: flex; align-items: flex-end; gap: 8px;
    padding: 12px 14px;
  }
  .forge-textarea {
    flex: 1; resize: none; border: none; outline: none;
    background: transparent; color: #eee;
    font-family: 'Nunito Sans', sans-serif; font-size: 14px;
    line-height: 1.5; padding: 6px 0;
    max-height: 120px; /* ~6 lines */
  }
  .forge-textarea::placeholder { color: #777; }
  .forge-send {
    background: none; border: none; cursor: pointer;
    padding: 6px; border-radius: 6px; transition: all 0.2s;
    flex-shrink: 0; display: flex; align-items: center;
    color: #444;
  }
  .forge-send.active { color: #F8B42C; }
  .forge-send:disabled { opacity: 0.3; cursor: default; }

  /* Settings modal */
  .forge-modal-bg {
    display: none; position: fixed; inset: 0; z-index: 300;
    background: rgba(0,0,0,0.7); backdrop-filter: blur(4px);
    align-items: center; justify-content: center;
  }
  .forge-modal-bg.open { display: flex; }
  .forge-modal {
    background: #222; border: 1px solid rgba(255,255,255,0.1);
    border-radius: 14px; padding: 28px; width: 380px; max-width: 90vw;
  }
  .forge-modal h3 {
    font-family: 'DM Mono', monospace; font-size: 12px; font-weight: 700;
    color: #bbb; letter-spacing: 1.5px; text-transform: uppercase;
    margin: 0 0 20px;
  }
  .forge-modal label {
    display: block; font-family: 'DM Mono', monospace; font-size: 10px;
    color: #777; letter-spacing: 0.8px; text-transform: uppercase;
    margin: 14px 0 6px;
  }
  .forge-modal label:first-of-type { margin-top: 0; }
  .forge-modal input, .forge-modal select {
    width: 100%; box-sizing: border-box;
    padding: 8px 12px; border-radius: 6px;
    background: #1a1a1a; border: 1px solid rgba(255,255,255,0.1);
    color: #ddd; font-family: 'DM Mono', monospace; font-size: 12px;
    outline: none; transition: border-color 0.2s;
  }
  .forge-modal input:focus { border-color: rgba(248,180,44,0.3); }
  .forge-modal-close {
    margin-top: 20px; width: 100%; height: 36px;
    background: rgba(255,255,255,0.08); border: none; border-radius: 8px;
    color: #999; font-family: 'DM Mono', monospace; font-size: 11px;
    font-weight: 600; letter-spacing: 1px; text-transform: uppercase;
    cursor: pointer; transition: all 0.2s;
  }
  .forge-modal-close:hover { background: rgba(255,255,255,0.14); color: #ccc; }

  /* Forge Loading Gate */
  .forge-gate {
    position: absolute; inset: 0; z-index: 10;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    background: rgba(16,16,16,0.95);
    backdrop-filter: blur(18px); -webkit-backdrop-filter: blur(18px);
    border-radius: 14px;
    transition: opacity 0.5s ease, visibility 0.5s ease;
    padding: 32px 24px;
  }
  .forge-gate.dismissed { opacity: 0; visibility: hidden; pointer-events: none; }
  .forge-setup { max-width: 380px; width: 100%; text-align: center; }
  .forge-setup-icon { width: 40px; height: 40px; border-radius: 10px; opacity: 0.5; margin-bottom: 16px; }
  .forge-setup-title {
    font-family: 'Nunito Sans', sans-serif; font-size: 20px; font-weight: 800;
    color: #f0f0f0; margin-bottom: 8px;
  }
  .forge-setup-sub {
    font-size: 13px; color: #bbb; line-height: 1.7; margin-bottom: 24px;
  }
  .forge-setup-sub strong { color: #eee; font-weight: 700; }
  .forge-setup-btn {
    display: inline-flex; align-items: center; gap: 10px;
    padding: 13px 32px; border-radius: 10px;
    background: #F8B42C; color: #000; border: none; cursor: pointer;
    font-family: 'Nunito Sans', sans-serif; font-size: 13px;
    font-weight: 800; letter-spacing: 0.5px; text-transform: uppercase;
    transition: all 0.2s;
    box-shadow: 0 2px 16px rgba(248,180,44,0.25);
  }
  .forge-setup-btn:hover { background: #f9c35a; transform: translateY(-1px); }
  .forge-setup-btn:disabled { opacity: 0.5; cursor: default; transform: none; }
  .forge-spin {
    width: 14px; height: 14px; border: 2px solid rgba(0,0,0,0.15);
    border-top-color: #000; border-radius: 50%;
    animation: forge-spin 0.6s linear infinite;
  }
  @keyframes forge-spin { to { transform: rotate(360deg); } }
  /* Loading progress area */
  .forge-load-progress {
    margin-top: 28px; display: inline-block;
  }
  .forge-load-bar {
    height: 6px; border-radius: 3px; width: 100%;
    background: rgba(255,255,255,0.08); overflow: hidden;
  }
  .forge-load-fill {
    height: 100%; width: 0%; border-radius: 3px;
    background: linear-gradient(90deg, #F8B42C, #f9c35a);
    transition: width 0.4s ease;
  }
  .forge-load-status {
    font-family: 'DM Mono', monospace; font-size: 11px;
    color: #999; margin-top: 12px; text-align: center;
  }
  .forge-setup-error {
    font-size: 12px; color: #FF6B6B; margin-top: 14px; line-height: 1.6;
  }

  @media (max-width: 768px) {
    .forge { height: 500px; }
    .forge-msg { max-width: 92%; }
    .forge-hero-stats { flex-wrap: wrap; gap: 16px; padding: 14px 20px; justify-content: center; }
    .forge-hero-stat-divider { display: none; }
  }

  /* Forge dark zone (runner + tagline) */
  .forge-dark-zone {
    position: relative;
    background: #0a0a0a;
    border-top: 3px solid #F8B42C;
  }
  .forge-dark-glow {
    position: absolute; top: 0; left: 0; right: 0; height: 3px;
    background: linear-gradient(90deg, transparent, #F8B42C, #ff6b3d, #F8B42C, transparent);
    background-size: 200% 100%;
    animation: glow-sweep 4s ease-in-out infinite;
  }

  /* Forge model runner */
  .forge-runner {
    padding: 0 24px;
    max-width: 1098px; margin: 0 auto;
  }
  .forge-works-with {
    margin-top: 0; padding: 40px 0 32px;
    border-top: none;
  }
  .forge-works-label {
    color: #777;
  }
  .forge-chip {
    background: rgba(255,255,255,0.06); border-color: rgba(255,255,255,0.1);
    color: #ccc;
  }
  .marquee-track:hover .forge-chip { border-color: rgba(248,180,44,0.3); }

  /* Forge tagline */
  .forge-tagline {
    padding: 20px 24px 40px; text-align: center;
  }
  .forge-tagline-text {
    max-width: 975px; margin: 0 auto;
    font-family: 'DM Mono', monospace; font-size: 12px;
    color: #555; letter-spacing: 2px; text-transform: uppercase;
  }
  .forge-tagline-text span { color: #F8B42C; font-weight: 700; }
  .forge-tagline-text em { color: #444; font-style: normal; font-weight: 400; }

  /* ===== EVA — Unified Dark Section ===== */
  .eva-section {
    position: relative; overflow: hidden;
    background: var(--n-blue-deep);
    border-top: 3px solid var(--d-blue);
  }
  .eva-section::before {
    content: '';
    position: absolute; inset: 0;
    background:
      radial-gradient(ellipse 70% 50% at 50% 0%, rgba(7,176,232,0.08) 0%, transparent 60%),
      radial-gradient(ellipse 50% 60% at 20% 80%, rgba(99,102,241,0.05) 0%, transparent 50%),
      radial-gradient(ellipse 40% 40% at 80% 60%, rgba(7,176,232,0.04) 0%, transparent 50%);
    pointer-events: none; z-index: 0;
  }
  .eva-section::after {
    content: '';
    position: absolute; inset: 0;
    background-image:
      linear-gradient(rgba(7,176,232,0.015) 1px, transparent 1px),
      linear-gradient(90deg, rgba(7,176,232,0.015) 1px, transparent 1px);
    background-size: 48px 48px;
    pointer-events: none; z-index: 0;
  }
  .eva-glow-bar {
    position: absolute; top: 0; left: 0; right: 0; height: 3px; z-index: 2;
    background: linear-gradient(90deg, transparent, var(--d-blue), #6366f1, var(--d-blue), transparent);
    background-size: 200% 100%;
    animation: glow-sweep 4s ease-in-out infinite;
  }

  /* EVA Hero (top area with title) */
  .vt-hero {
    position: relative; z-index: 1;
    padding: 56px 32px 32px;
    text-align: center;
  }
  .vt-hero-content { max-width: 975px; margin: 0 auto; }
  .vt-hero-badge {
    display: inline-block;
    font-family: 'DM Mono', monospace; font-size: 11px;
    color: var(--d-blue); letter-spacing: 3px; text-transform: uppercase;
    font-weight: 700; margin-bottom: 20px;
    padding: 6px 16px; border-radius: 50px;
    border: 1.5px solid rgba(7,176,232,0.3);
    background: rgba(7,176,232,0.06);
  }
  .vt-hero-title {
    font-size: clamp(32px, 5vw, 52px); font-weight: 900;
    color: #fff; letter-spacing: -1px; line-height: 1.1;
    margin-bottom: 18px;
  }
  .vt-hero-title span {
    background: linear-gradient(135deg, var(--d-blue), #6366f1);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .vt-hero-sub {
    font-size: 18px; color: var(--text-secondary); max-width: 580px;
    margin: 0 auto; line-height: 1.7;
  }
  .vt-hero-sub strong { color: #fff; }
  .vt-hero-stats {
    display: inline-flex; align-items: center; gap: 24px;
    margin-top: 28px; padding: 16px 32px;
    background: rgba(7,176,232,0.04); border-radius: 12px;
    border: 1px solid rgba(7,176,232,0.1);
  }
  .vt-hero-stat { text-align: center; }
  .vt-hero-stat-value {
    display: block; font-family: 'DM Mono', monospace;
    font-size: 20px; font-weight: 700; color: #fff; letter-spacing: 0.5px;
  }
  .vt-hero-stat-label {
    display: block; font-size: 11px; color: rgba(255,255,255,0.45);
    text-transform: uppercase; letter-spacing: 1px; margin-top: 4px;
  }
  .vt-hero-stat-divider {
    width: 1px; height: 32px; background: rgba(255,255,255,0.08);
  }

  /* EVA Tool area */
  .eva-tool-area {
    position: relative; z-index: 1;
    max-width: 975px; margin: 0 auto;
    padding: 0 24px 48px;
  }

  /* EVA Tool — horizontal pill */
  .vt-tool {
    max-width: 975px; margin: 0 auto;
    background: rgba(2,38,64,0.6);
    backdrop-filter: blur(20px);
    border-radius: 60px;
    padding: 10px 10px 10px 28px;
    border: 1px solid rgba(7,176,232,0.12);
    box-shadow: 0 8px 40px rgba(0,0,0,0.25), inset 0 1px 0 rgba(255,255,255,0.03);
    display: flex; align-items: center; gap: 16px;
    min-height: 68px;
    transition: all 0.4s cubic-bezier(0.4,0,0.2,1);
  }
  .vt-tool.recording {
    border-color: rgba(239,68,68,0.25);
    box-shadow: 0 0 0 1px rgba(239,68,68,0.15), 0 0 60px rgba(239,68,68,0.1), 0 8px 40px rgba(0,0,0,0.25);
  }
  .vt-tool.loading {
    border-color: rgba(99,102,241,0.2);
    box-shadow: 0 0 0 1px rgba(99,102,241,0.1), 0 0 40px rgba(99,102,241,0.08), 0 8px 40px rgba(0,0,0,0.25);
  }

  /* Waveform — left side of pill */
  .vt-wave-area {
    flex: 1; height: 48px; position: relative; overflow: hidden;
    display: flex; align-items: center;
  }
  .vt-wave-canvas {
    width: 100%; height: 100%;
    display: block;
  }

  /* Squiggle loading animation (SVG sine wave) */
  .vt-squiggle {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    opacity: 0; transition: opacity 0.4s;
  }
  .vt-tool.loading .vt-squiggle { opacity: 1; }
  .vt-squiggle path {
    fill: none; stroke: url(#vtSquiggleGrad); stroke-width: 2;
    stroke-linecap: round;
    animation: vt-squiggle-flow 1.5s ease-in-out infinite;
  }
  @keyframes vt-squiggle-flow {
    0% { stroke-dashoffset: 0; }
    100% { stroke-dashoffset: -60; }
  }

  /* Status text — left of waveform during loading */
  .vt-pill-status {
    font-family: 'DM Mono', monospace; font-size: 12px; font-weight: 500;
    color: rgba(255,255,255,0.35); letter-spacing: 0.3px;
    white-space: nowrap; flex-shrink: 0;
    transition: color 0.3s;
  }
  .vt-tool.recording .vt-pill-status { color: rgba(255,255,255,0.7); }
  .vt-tool.loading .vt-pill-status { color: rgba(99,102,241,0.7); }

  /* Right side controls */
  .vt-pill-right {
    display: flex; align-items: center; gap: 10px; flex-shrink: 0;
  }
  .vt-timer {
    font-family: 'DM Mono', monospace; font-size: 16px; font-weight: 500;
    color: rgba(255,255,255,0.25); letter-spacing: -0.02em;
    min-width: 42px; text-align: right;
    transition: color 0.3s;
  }
  .vt-tool.recording .vt-timer { color: #fff; }

  /* Record / Stop button — circle on right of pill */
  .vt-rec-btn {
    width: 48px; height: 48px; border-radius: 50%; border: none;
    background: linear-gradient(135deg, var(--d-blue), #6366f1);
    color: #fff; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 0 0 3px rgba(7,176,232,0.08);
    transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
    flex-shrink: 0; position: relative;
  }
  .vt-rec-btn:hover { transform: scale(1.06); }
  .vt-rec-btn.recording {
    background: #ef4444;
    box-shadow: 0 0 0 3px rgba(239,68,68,0.12), 0 0 20px rgba(239,68,68,0.2);
    animation: vt-breathe 2s ease-in-out infinite;
  }
  .vt-rec-btn.processing {
    background: linear-gradient(135deg, #6366f1, var(--d-blue));
    cursor: wait;
    animation: none;
  }
  .vt-rec-btn.processing:hover { transform: none; }
  @keyframes vt-breathe {
    0%,100% { box-shadow: 0 0 0 3px rgba(239,68,68,0.12), 0 0 12px rgba(239,68,68,0.15); }
    50% { box-shadow: 0 0 0 3px rgba(239,68,68,0.12), 0 0 24px rgba(239,68,68,0.3); }
  }
  .vt-rec-btn .vt-stop-shape {
    width: 16px; height: 16px; border-radius: 3px; background: #fff;
    display: none;
  }
  .vt-rec-btn.recording .vt-mic-icon { display: none; }
  .vt-rec-btn.recording .vt-stop-shape { display: block; }
  .vt-rec-btn .vt-spin {
    width: 22px; height: 22px; border: 2.5px solid rgba(255,255,255,0.2);
    border-top-color: #fff; border-radius: 50%;
    animation: forge-spin 0.6s linear infinite;
    display: none;
  }
  .vt-rec-btn.processing .vt-mic-icon { display: none; }
  .vt-rec-btn.processing .vt-stop-shape { display: none; }
  .vt-rec-btn.processing .vt-spin { display: block; }

  /* Transcript — below the pill (dark theme) */
  .vt-transcript {
    max-width: 975px; margin: 16px auto 0; text-align: left;
    background: rgba(7,176,232,0.03); border-radius: 14px;
    border: 1px solid rgba(7,176,232,0.08);
    overflow: hidden;
    animation: fade-up 0.3s ease-out;
  }
  .vt-transcript-header {
    display: flex; justify-content: space-between; align-items: center;
    padding: 12px 20px; border-bottom: 1px solid rgba(7,176,232,0.06);
    font-family: 'DM Mono', monospace; font-size: 10px; font-weight: 600;
    color: rgba(255,255,255,0.35); letter-spacing: 1.5px; text-transform: uppercase;
  }
  .vt-word-count {
    font-family: 'DM Mono', monospace; font-size: 10px;
    color: var(--d-blue); letter-spacing: 0.5px;
  }
  .vt-transcript-body {
    padding: 16px 20px;
    font-size: 15px; color: rgba(255,255,255,0.85);
    line-height: 1.7; white-space: pre-wrap;
    max-height: 180px; overflow-y: auto;
  }
  .vt-transcript-body::-webkit-scrollbar { width: 4px; }
  .vt-transcript-body::-webkit-scrollbar-thumb { background: rgba(7,176,232,0.15); border-radius: 2px; }
  .vt-actions {
    display: flex; gap: 8px; padding: 12px 20px; border-top: 1px solid rgba(7,176,232,0.06);
  }
  .vt-btn-copy {
    flex: 1; display: flex; align-items: center; justify-content: center; gap: 8px;
    padding: 10px; border-radius: 10px; border: none; cursor: pointer;
    background: linear-gradient(135deg, var(--d-blue), #6366f1);
    color: #fff; font-family: 'Nunito Sans', sans-serif; font-size: 13px; font-weight: 700;
    letter-spacing: 0.5px; transition: all 0.2s;
    box-shadow: 0 2px 12px rgba(7,176,232,0.15);
  }
  .vt-btn-copy:hover { transform: translateY(-1px); box-shadow: 0 4px 16px rgba(7,176,232,0.25); }
  .vt-btn-download {
    display: flex; align-items: center; justify-content: center; gap: 6px;
    padding: 10px 16px; border-radius: 10px; cursor: pointer;
    background: rgba(7,176,232,0.04); border: 1px solid rgba(7,176,232,0.1);
    color: rgba(255,255,255,0.7); font-family: 'DM Mono', monospace; font-size: 11px;
    font-weight: 600; letter-spacing: 0.5px; transition: all 0.2s;
  }
  .vt-btn-download:hover { background: rgba(7,176,232,0.08); }

  /* EVA works-with (dark variant) */
  .eva-works-with {
    position: relative; z-index: 1;
    max-width: 975px; margin: 0 auto;
    padding: 16px 24px 0;
  }
  .eva-works-with .works-with-label { color: rgba(255,255,255,0.25); }
  .eva-works-with .ai-logo-chip {
    background: rgba(255,255,255,0.04); border-color: rgba(255,255,255,0.08);
    color: rgba(255,255,255,0.5);
  }
  .eva-works-with .marquee-track:hover .ai-logo-chip { border-color: rgba(7,176,232,0.25); }

  /* EVA tagline */
  .eva-tagline {
    position: relative; z-index: 1;
    padding: 24px 24px 48px; text-align: center;
  }
  .eva-tagline-text {
    max-width: 975px; margin: 0 auto;
    font-family: 'DM Mono', monospace; font-size: 12px;
    color: rgba(255,255,255,0.2); letter-spacing: 2px; text-transform: uppercase;
  }
  .eva-tagline-text span { color: var(--d-blue); font-weight: 700; }

  @media (max-width: 768px) {
    .vt-hero-stats { flex-wrap: wrap; gap: 16px; padding: 14px 20px; justify-content: center; }
    .vt-hero-stat-divider { display: none; }
    .vt-tool { max-width: 100%; border-radius: 50px; padding: 8px 8px 8px 20px; }
    .vt-transcript { border-radius: 12px; }
    .vt-actions { flex-direction: column; }
    .eva-tool-area { padding: 0 16px 40px; }
  }

  /* ===== ANIMATIONS ===== */
  @keyframes fade-up {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* ===== TOAST ===== */
  .toast {
    position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%) translateY(80px);
    padding: 12px 24px; border-radius: var(--radius);
    background: var(--x-blue); border: 1px solid var(--border-hover);
    color: var(--white); font-size: 13px; font-weight: 600;
    box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    transition: transform 0.3s ease, opacity 0.3s ease, background 0.3s, border-color 0.3s;
    opacity: 0; z-index: 200;
  }
  .toast.visible { transform: translateX(-50%) translateY(0); opacity: 1; }
  .toast.raven-toast {
    background: #1a1a1a; border-color: rgba(248,180,44,0.35);
    color: #F8B42C;
    box-shadow: 0 8px 32px rgba(0,0,0,0.5), 0 0 0 1px rgba(248,180,44,0.08);
  }

  /* ===== FLOATING NAV ===== */
  .floating-nav {
    position: fixed; right: 20px; top: 120px;
    z-index: 99; display: flex; flex-direction: column; gap: 6px;
  }
  .floating-nav a {
    display: flex; align-items: center; gap: 10px;
    padding: 12px 18px; border-radius: 12px;
    background: rgba(2,38,64,0.95);
    backdrop-filter: blur(20px);
    border: 1.5px solid rgba(7,176,232,0.25);
    color: #fff; text-decoration: none;
    font-family: 'DM Mono', monospace; font-size: 11px;
    font-weight: 700; letter-spacing: 1px; text-transform: uppercase;
    transition: background 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease, transform 0.3s ease;
    white-space: nowrap;
    box-shadow: 0 4px 16px rgba(0,0,0,0.3);
  }
  .floating-nav a:hover {
    border-color: var(--d-blue);
    background: rgba(7,176,232,0.15);
    box-shadow: 0 8px 32px rgba(7,176,232,0.25);
    transform: translateX(-6px);
  }
  .floating-nav a.active {
    border-color: var(--d-blue);
    background: rgba(0,56,103,0.9);
    box-shadow: 0 4px 20px rgba(7,176,232,0.2);
  }
  .floating-nav a .nav-dot {
    width: 7px; height: 7px; border-radius: 50%;
    background: var(--d-blue); flex-shrink: 0;
    box-shadow: 0 0 8px rgba(7,176,232,0.6);
    transition: background 0.5s ease, box-shadow 0.5s ease, transform 0.3s ease;
  }
  .floating-nav a:hover .nav-dot,
  .floating-nav a.active .nav-dot {
    box-shadow: 0 0 12px rgba(7,176,232,0.9);
    transform: scale(1.3);
  }
  /* RAVEN mode — black & gold, smooth crossfade */
  .floating-nav.raven-mode a {
    background: rgba(18,18,18,0.95);
    border-color: rgba(248,180,44,0.25);
    box-shadow: 0 4px 16px rgba(0,0,0,0.4);
  }
  .floating-nav.raven-mode a:hover {
    border-color: #F8B42C;
    background: rgba(248,180,44,0.1);
    box-shadow: 0 8px 32px rgba(248,180,44,0.2);
  }
  .floating-nav.raven-mode a.active {
    border-color: rgba(248,180,44,0.5);
    background: rgba(30,25,15,0.95);
    box-shadow: 0 4px 20px rgba(248,180,44,0.15);
  }
  .floating-nav.raven-mode a .nav-dot {
    background: #F8B42C;
    box-shadow: 0 0 8px rgba(248,180,44,0.6);
  }
  .floating-nav.raven-mode a:hover .nav-dot,
  .floating-nav.raven-mode a.active .nav-dot {
    box-shadow: 0 0 12px rgba(248,180,44,0.9);
  }

  /* ===== SMARTDOC HERO ===== */
  .sd-hero {
    position: relative; overflow: hidden;
    background: #fff;
    border-top: 3px solid var(--d-blue);
    border-bottom: 3px solid var(--d-blue);
    padding: 64px 32px;
    text-align: center;
    animation: fade-up 0.8s ease-out 0.2s both;
  }
  .sd-hero-glow {
    position: absolute; top: 0; left: 0; right: 0; height: 3px;
    background: linear-gradient(90deg, transparent, var(--d-blue), var(--success), var(--d-blue), transparent);
    background-size: 200% 100%;
    animation: glow-sweep 4s ease-in-out infinite;
  }
  .sd-hero-content { position: relative; z-index: 1; max-width: 975px; margin: 0 auto; }
  .sd-hero-badge {
    display: inline-block;
    font-family: 'DM Mono', monospace; font-size: 12px;
    color: var(--d-blue); letter-spacing: 3px; text-transform: uppercase;
    font-weight: 700; margin-bottom: 20px;
    padding: 6px 16px; border-radius: 50px;
    border: 1.5px solid var(--d-blue);
    background: rgba(7,176,232,0.06);
  }
  .sd-hero-title {
    font-size: clamp(32px, 5vw, 52px); font-weight: 900;
    color: var(--n-blue); letter-spacing: -1px; line-height: 1.1;
    margin-bottom: 18px;
  }
  .sd-hero-title span {
    background: linear-gradient(135deg, var(--d-blue), #00C9A7);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .sd-hero-sub {
    font-size: 18px; color: #3a5568; max-width: 580px;
    margin: 0 auto; line-height: 1.7;
  }
  .sd-hero-stats {
    display: inline-flex; align-items: center; gap: 24px;
    margin-top: 28px; padding: 16px 32px;
    background: var(--n-blue); border-radius: 12px;
    box-shadow: 0 4px 20px rgba(2,38,64,0.3);
  }
  .sd-hero-stat { text-align: center; }
  .sd-hero-stat-value {
    display: block; font-family: 'DM Mono', monospace;
    font-size: 20px; font-weight: 700; color: #fff; letter-spacing: 0.5px;
  }
  .sd-hero-stat-label {
    display: block; font-size: 11px; color: rgba(255,255,255,0.6);
    text-transform: uppercase; letter-spacing: 1px; margin-top: 4px;
  }
  .sd-hero-stat-divider {
    width: 1px; height: 32px; background: rgba(255,255,255,0.15);
  }

  /* ===== RESEARCH DIVISION SECTION ===== */
  .research-section {
    padding: 48px 32px;
    text-align: center;
    position: relative;
    overflow: hidden;
  }
  .research-section::before {
    content: '';
    position: absolute; inset: 0;
    background: radial-gradient(ellipse 70% 50% at 50% 30%, rgba(7,176,232,0.06) 0%, transparent 70%);
    pointer-events: none;
  }
  .research-content { position: relative; z-index: 1; max-width: 975px; margin: 0 auto; }
  .research-badge {
    display: inline-block;
    font-family: 'DM Mono', monospace; font-size: 11px;
    color: var(--d-blue); letter-spacing: 3px; text-transform: uppercase;
    font-weight: 700; margin-bottom: 28px;
    padding: 8px 20px; border-radius: 50px;
    border: 1px solid rgba(7,176,232,0.3);
    background: rgba(7,176,232,0.06);
  }
  .research-title {
    font-size: clamp(28px, 4vw, 44px); font-weight: 900;
    color: #fff; letter-spacing: -0.5px; line-height: 1.2;
    margin-bottom: 24px;
  }
  .research-title span { color: var(--d-blue); }
  .research-desc {
    font-size: 17px; color: #c0d0dc; line-height: 1.8;
    max-width: 640px; margin: 0 auto 36px;
  }
  .research-cards {
    display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;
    max-width: 975px; margin: 0 auto;
  }
  .research-card {
    padding: 28px 20px; border-radius: 12px;
    background: rgba(7,176,232,0.04);
    border: 1px solid var(--border);
    transition: all 0.3s;
  }
  .research-card:hover {
    border-color: var(--border-hover);
    background: rgba(7,176,232,0.07);
    transform: translateY(-2px);
  }
  .research-card-icon {
    font-size: 28px; margin-bottom: 12px;
  }
  .research-card-title {
    font-size: 14px; font-weight: 800; color: #fff;
    letter-spacing: 0.3px; margin-bottom: 8px;
  }
  .research-card-desc {
    font-size: 13px; color: #8fa4b3; line-height: 1.6;
  }

  /* ===== RESPONSIVE ===== */
  @media (max-width: 900px) {
    .hero { padding: 48px 24px 40px; }
    .hero-layout { flex-direction: column; gap: 32px; text-align: center; }
    .hero-graphic { width: 240px; height: 240px; }
    .hero-robot-container { width: 140px; height: 140px; }
    .hero-ctas { justify-content: center; }
    .hero-desc { margin-left: auto; margin-right: auto; }
  }
  @media (max-width: 600px) {
    .topbar { padding: 12px 16px; gap: 12px; }
    .hero { padding: 32px 16px 28px; }
    .hero-graphic { width: 180px; height: 180px; }
    .hero-robot-container { width: 100px; height: 100px; }
    .main { padding: 32px 16px 60px; }
    .drop-zone { padding: 40px 20px; }
    .result-actions { flex-direction: column; }
    .btn-action { width: 100%; justify-content: center; }
    .section-header { flex-direction: column; align-items: flex-start; }
    .floating-nav { display: none; }
    .research-cards { grid-template-columns: 1fr; }
    .hero-ctas { flex-direction: column; }
    .hero-cta-primary, .hero-cta-partner { width: 100%; justify-content: center; }
    .topbar-attribution-text { display: none; }
  }
</style>
</head>
<body>
<div class="app">

  <!-- ===== TOPBAR ===== -->
  <div class="topbar">
    <div class="topbar-inner">
      <div class="topbar-left">
        <a href="https://www.linkedin.com/company/network-designs-inc-/" target="_blank"><img src="ndiautolight.png" alt="NDi Auto" class="ndi-logo"></a>
        <div class="topbar-divider"></div>
        <a href="https://netdes.com" target="_blank" class="topbar-attribution">
          <span class="topbar-attribution-text">A Division of</span>
          <img src="https://netdes.com/wp-content/uploads/logo-header.png" alt="Network Designs, Inc." class="topbar-attribution-logo">
        </a>
      </div>
      <div class="topbar-right">
        <a href="https://www.linkedin.com/company/network-designs-inc-/" target="_blank" class="btn-partner">PARTNER WITH US<span class="btn-partner-divider"></span><img src="sdvosb.png" alt="SDVOSB Certified" class="sdvosb-logo"></a>
      </div>
    </div>
  </div>

  <!-- ===== FLOATING NAV ===== -->
  <nav class="floating-nav">
    <a href="#smartdoc"><span class="nav-dot"></span>SmartDoc</a>
    <a href="#superprompt"><span class="nav-dot"></span>SuperPrompt</a>
    <a href="#raven"><span class="nav-dot"></span>RAVEN</a>
    <a href="#forge"><span class="nav-dot"></span>Forge</a>
    <a href="#eva"><span class="nav-dot"></span>EVA</a>
  </nav>

  <!-- ===== HERO ===== -->
  <div class="hero">
    <div class="hero-layout">
      <div class="hero-text">
        <div class="hero-status-pill">
          <div class="status-dot"></div>OPERATIONAL | <span class="live-date"></span>
        </div>
        <h1>NDi <span>Auto</span></h1>
        <div class="hero-division">AI &amp; Automation Research Division</div>
        <p class="hero-desc">
          Production-grade intelligent tools for <strong>federal, defense, and enterprise</strong> ecosystems. Zero-trust by design. Zero backend. Nothing ever leaves your machine.
        </p>
        <div class="hero-ctas">
          <a href="#smartdoc" class="hero-cta-primary">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 4v12m0 0l4-4m-4 4l-4-4" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Explore Tools
          </a>
          <a href="https://www.linkedin.com/company/network-designs-inc-/" target="_blank" class="hero-cta-partner">PARTNER WITH US<span class="hero-cta-partner-divider"></span><img src="sdvosb.png" alt="SDVOSB"></a>
        </div>
      </div>
      <div class="hero-graphic">
        <div class="hero-hex-glow"></div>
        <div class="hero-ring hero-ring-3"></div>
        <div class="hero-ring hero-ring-2"></div>
        <div class="hero-ring hero-ring-1"></div>
        <div class="hero-bracket hero-bracket-tl"></div>
        <div class="hero-bracket hero-bracket-tr"></div>
        <div class="hero-bracket hero-bracket-bl"></div>
        <div class="hero-bracket hero-bracket-br"></div>
        <div class="hero-scan-line"></div>
        <div class="hero-robot-container">
          <img src="robot_white.png" alt="NDi Auto AI">
        </div>
        <div class="hero-robot-status">AI CORE ACTIVE</div>
      </div>
    </div>
  </div>

  <!-- ===== RESEARCH DIVISION CARDS ===== -->
  <div class="research-section">
    <div class="research-content">
      <div class="research-cards">
        <div class="research-card">
          <div class="research-card-icon">⚡</div>
          <div class="research-card-title">Zero-Trust Architecture</div>
          <div class="research-card-desc">Client-side only. No servers. No telemetry. No data ever leaves your machine. Built for environments where exposure isn't an option.</div>
        </div>
        <div class="research-card">
          <div class="research-card-icon">🔬</div>
          <div class="research-card-title">Mission-Grade Engineering</div>
          <div class="research-card-desc">Three decades of delivering on classified and unclassified networks. Every tool meets the standard our federal partners demand.</div>
        </div>
        <div class="research-card">
          <div class="research-card-icon">🛡️</div>
          <div class="research-card-title">Mission Oriented</div>
          <div class="research-card-desc">Partnered with DoD, DOJ, FAA, and FBI. SDVOSB certified. Set-aside eligible. Built by operators who understand the mission.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== SMARTDOC HERO (full width, like SuperPrompt) ===== -->
  <div class="sd-hero" id="smartdoc">
    <div class="sd-hero-glow"></div>
    <div class="sd-hero-content">
      <div class="sd-hero-badge">Document Serialization</div>
      <h2 class="sd-hero-title">NDi <span>SmartDoc</span></h2>
      <p class="sd-hero-sub"><strong style="color:var(--n-blue);font-size:20px;">Serialize. Compress. Deploy.</strong><br>Transform unstructured documents into a single AI-ready corpus.</p>
      <div class="sd-hero-stats">
        <div class="sd-hero-stat"><span class="sd-hero-stat-value"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" style="vertical-align:-2px;margin-right:4px;color:var(--success)"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" stroke-linecap="round" stroke-linejoin="round"/></svg>100%</span><span class="sd-hero-stat-label">Local &amp; Secure</span></div>
        <div class="sd-hero-stat-divider"></div>
        <div class="sd-hero-stat"><span class="sd-hero-stat-value">ANY</span><span class="sd-hero-stat-label">Document</span></div>
        <div class="sd-hero-stat-divider"></div>
        <div class="sd-hero-stat"><span class="sd-hero-stat-value">XML</span><span class="sd-hero-stat-label">Output Format</span></div>
        <div class="sd-hero-stat-divider"></div>
        <div class="sd-hero-stat"><span class="sd-hero-stat-value"><span class="no-cloud-icon"><svg viewBox="0 0 24 20" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M6.5 17A4.5 4.5 0 015.1 8.2a6 6 0 0111.8 0A4.5 4.5 0 0117.5 17H6.5z" stroke-linecap="round" stroke-linejoin="round"/><line x1="3" y1="19" x2="21" y2="1" stroke="#FF6B6B" stroke-width="2.5" stroke-linecap="round"/></svg></span></span><span class="sd-hero-stat-label">No Cloud</span></div>
      </div>
    </div>
  </div>

  <!-- ===== MAIN ===== -->
  <div class="main">

    <!-- DROP ZONE -->
    <div class="drop-zone" id="dropZone">
      <input type="file" id="fileInput" multiple accept=".pdf,.docx,.doc,.pptx,.ppt,.xlsx,.xls,.txt,.csv">
      <div class="drop-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="color:var(--d-blue)">
          <path d="M12 16V4m0 0L8 8m4-4l4 4" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M2 17l.621 2.485A2 2 0 004.561 21h14.878a2 2 0 001.94-1.515L22 17" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="drop-title">Drop documents here or click to browse</div>
      <div class="drop-sub">Your files never leave this browser</div>
      <div class="drop-formats">
        <span class="format-chip format-chip-pdf">.pdf</span>
        <span class="format-chip format-chip-docx">.docx</span>
        <span class="format-chip format-chip-pptx">.pptx</span>
        <span class="format-chip format-chip-xlsx">.xlsx</span>
        <span class="format-chip format-chip-csv">.csv</span>
        <span class="format-chip format-chip-txt">.txt</span>
      </div>
    </div>

    <!-- FILE LIST -->
    <div class="file-list" id="fileList"></div>

    <!-- STAGED BAR -->
    <div class="staged-bar" id="stagedBar">
      <div class="staged-text"><span class="staged-count" id="stagedCount">0</span> documents staged · <span id="stagedSize">0 KB</span></div>
      <div class="staged-actions">
        <button class="btn-sort" id="sortBtn" onclick="cycleSort()">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="15" y2="12"/><line x1="3" y1="18" x2="9" y2="18"/></svg>
          <span id="sortLabel">Uploaded</span>
        </button>
        <button class="btn-clear-all" onclick="clearAllFiles()">✕ Clear All</button>
      </div>
    </div>

    <!-- PROCESS BUTTON -->
    <div class="btn-process-wrap">
      <button class="btn-process" id="processBtn" disabled onclick="beginProcess()">
        <div class="btn-laser" id="btnLaser"></div>
        <div class="process-status" id="processStatus"></div>
        <span class="btn-label">Begin Serialization</span>
      </button>
    </div>

    <!-- RESULT (directly under button) -->
    <div class="result-section" id="resultSection">
      <div class="result-actions">
        <button class="btn-action btn-action-download" onclick="downloadCorpus()">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 4v12m0 0l-4-4m4 4l4-4M2 17l.621 2.485A2 2 0 004.561 21h14.878a2 2 0 001.94-1.515L22 17" stroke-linecap="round" stroke-linejoin="round"/></svg>
          Download SmartDoc (.txt)
        </button>
        <button class="btn-action btn-action-copy" onclick="copyCorpus()">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1" stroke-linecap="round"/></svg>
          Copy Text
        </button>
      </div>
    </div>

    <!-- WORKS WITH (under serialize button) -->
    <div class="works-with" style="margin-top:28px; padding-top:16px; border-top:none;">
      <div class="works-with-label">Works with</div>
      <div class="marquee-mask">
        <div class="marquee-track">
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=chatgpt.com&sz=64" alt="" onerror="this.style.display='none'">ChatGPT</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=claude.ai&sz=64" alt="" onerror="this.style.display='none'">Claude</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=gemini.google.com&sz=64" alt="" onerror="this.style.display='none'">Gemini</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=perplexity.ai&sz=64" alt="" onerror="this.style.display='none'">Perplexity</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=meta.ai&sz=64" alt="" onerror="this.style.display='none'">Meta AI</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=mistral.ai&sz=64" alt="" onerror="this.style.display='none'">Mistral</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=copilot.microsoft.com&sz=64" alt="" onerror="this.style.display='none'">Copilot</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=grok.com&sz=64" alt="" onerror="this.style.display='none'">Grok</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=cohere.com&sz=64" alt="" onerror="this.style.display='none'">Cohere</div>
          <!-- duplicate for seamless loop -->
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=chatgpt.com&sz=64" alt="" onerror="this.style.display='none'">ChatGPT</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=claude.ai&sz=64" alt="" onerror="this.style.display='none'">Claude</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=gemini.google.com&sz=64" alt="" onerror="this.style.display='none'">Gemini</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=perplexity.ai&sz=64" alt="" onerror="this.style.display='none'">Perplexity</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=meta.ai&sz=64" alt="" onerror="this.style.display='none'">Meta AI</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=mistral.ai&sz=64" alt="" onerror="this.style.display='none'">Mistral</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=copilot.microsoft.com&sz=64" alt="" onerror="this.style.display='none'">Copilot</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=grok.com&sz=64" alt="" onerror="this.style.display='none'">Grok</div>
          <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=cohere.com&sz=64" alt="" onerror="this.style.display='none'">Cohere</div>
        </div>
      </div>
    </div>

  </div>

  <!-- NDi SUPERPROMPT HERO (full width, outside .main) -->
  <div class="sp-hero" id="superprompt">
    <div class="sp-hero-glow"></div>
    <div class="sp-hero-content">
      <div class="sp-hero-badge">AI ACCELERATION</div>
      <h2 class="sp-hero-title">NDi <span>SuperPrompt</span>™</h2>
      <p class="sp-hero-sub"><strong style="color:var(--n-blue);font-size:20px;">One prompt. Any model. Maximum intelligence.</strong><br>Deeper reasoning &amp; structured thinking. Caffeine for AI.</p>
      <div class="sp-hero-stats">
        <div class="sp-hero-stat"><span class="sp-hero-stat-value">40%</span><span class="sp-hero-stat-label">Higher Rated Outputs</span><span class="sp-hero-stat-note">when using extended thinking</span></div>
        <div class="sp-hero-stat-divider"></div>
        <div class="sp-hero-stat"><span class="sp-hero-stat-value">4-Phase</span><span class="sp-hero-stat-label">Cognitive Protocol</span></div>
        <div class="sp-hero-stat-divider"></div>
        <div class="sp-hero-stat"><span class="sp-hero-stat-value">1,000+</span><span class="sp-hero-stat-label">Models Supported</span></div>
        <div class="sp-hero-stat-divider"></div>
        <div class="sp-hero-stat"><span class="sp-hero-stat-value"><span class="no-cloud-icon"><svg viewBox="0 0 24 20" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M6.5 17A4.5 4.5 0 015.1 8.2a6 6 0 0111.8 0A4.5 4.5 0 0117.5 17H6.5z" stroke-linecap="round" stroke-linejoin="round"/><line x1="3" y1="19" x2="21" y2="1" stroke="#FF6B6B" stroke-width="2.5" stroke-linecap="round"/></svg></span></span><span class="sp-hero-stat-label">No Cloud</span></div>
      </div>
    </div>
  </div>

  <!-- NDi SUPER PROMPT™ content (back in constrained width) -->
  <div class="main" style="padding-top:32px;">
    <div class="super-prompt-section" style="margin-top:0; border-top:none; padding-top:0;">
      <div class="super-prompt-header">
        <div class="super-prompt-header-left">
          <div class="super-prompt-icon">
            <img src="robot_white.png" alt="NDi Bot" style="width:36px;height:36px;border-radius:8px;">
          </div>
          <div>
            <div class="super-prompt-title">NDi SuperPrompt™</div>
            <div class="super-prompt-sub">Paste before any prompt. Any model. Instant overdrive.</div>
          </div>
        </div>
        <button class="btn-action btn-action-primary btn-super" onclick="copySuperPrompt()">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1" stroke-linecap="round"/></svg>
          COPY SUPERPROMPT
        </button>
      </div>

      <div class="super-prompt-card">
        <div class="super-prompt-glow"></div>
        <div class="super-prompt-content" id="superPromptBox"></div>
      </div>

      <div class="works-with">
        <div class="works-with-label">Works with</div>
        <div class="marquee-mask">
          <div class="marquee-track">
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=chatgpt.com&sz=64" alt="" onerror="this.style.display='none'">ChatGPT</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=claude.ai&sz=64" alt="" onerror="this.style.display='none'">Claude</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=gemini.google.com&sz=64" alt="" onerror="this.style.display='none'">Gemini</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=perplexity.ai&sz=64" alt="" onerror="this.style.display='none'">Perplexity</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=meta.ai&sz=64" alt="" onerror="this.style.display='none'">Meta AI</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=mistral.ai&sz=64" alt="" onerror="this.style.display='none'">Mistral</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=copilot.microsoft.com&sz=64" alt="" onerror="this.style.display='none'">Copilot</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=grok.com&sz=64" alt="" onerror="this.style.display='none'">Grok</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=cohere.com&sz=64" alt="" onerror="this.style.display='none'">Cohere</div>
            <!-- duplicate set for seamless loop -->
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=chatgpt.com&sz=64" alt="" onerror="this.style.display='none'">ChatGPT</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=claude.ai&sz=64" alt="" onerror="this.style.display='none'">Claude</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=gemini.google.com&sz=64" alt="" onerror="this.style.display='none'">Gemini</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=perplexity.ai&sz=64" alt="" onerror="this.style.display='none'">Perplexity</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=meta.ai&sz=64" alt="" onerror="this.style.display='none'">Meta AI</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=mistral.ai&sz=64" alt="" onerror="this.style.display='none'">Mistral</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=copilot.microsoft.com&sz=64" alt="" onerror="this.style.display='none'">Copilot</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=grok.com&sz=64" alt="" onerror="this.style.display='none'">Grok</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=cohere.com&sz=64" alt="" onerror="this.style.display='none'">Cohere</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== RAVEN CTA ===== -->
  <div class="raven-cta-wrap" id="raven">
    <div class="raven-cta-glow"></div>
    <div class="raven-cta">
      <img src="raven-icon.png" alt="RAVEN" class="raven-cta-icon">
      <div class="raven-cta-text">
        <div class="raven-cta-title">Classified Streaming Over Public Infrastructure</div>
        <p class="raven-cta-desc">RAVEN delivers secure, classified-level video and data streaming across untrusted networks. The same mission-grade engineering. Different attack surface.</p>
      </div>
      <div class="raven-cta-action">
        <a href="https://ravensecurenetworks.com" target="_blank" class="raven-cta-action-link">
          <img src="raven-social.png" alt="RAVEN Secure Networks" class="raven-cta-social">
          <div class="raven-cta-btn">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6M15 3h6v6M10 14L21 3" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Visit RAVEN
          </div>
        </a>
      </div>
    </div>
  </div>

  <!-- ===== FORGE HERO ===== -->
  <div class="forge-hero" id="forge">
    <div class="forge-hero-content">
      <div class="forge-hero-badge">AI Acceleration</div>
      <h2 class="forge-hero-title">RAVEN <span>Forge</span></h2>
      <p class="forge-hero-sub">Local AI that runs <strong>entirely in your browser</strong>. No cloud. No data leakage.</p>
      <div class="forge-hero-stats">
        <div class="forge-hero-stat"><span class="forge-hero-stat-value">3 Billion</span><span class="forge-hero-stat-label">Parameters</span></div>
        <div class="forge-hero-stat-divider"></div>
        <div class="forge-hero-stat"><span class="forge-hero-stat-value">WebGPU</span><span class="forge-hero-stat-label">Accelerated</span></div>
        <div class="forge-hero-stat-divider"></div>
        <div class="forge-hero-stat"><span class="forge-hero-stat-value">32K</span><span class="forge-hero-stat-label">Context Window</span></div>
        <div class="forge-hero-stat-divider"></div>
        <div class="forge-hero-stat"><span class="forge-hero-stat-value"><span class="no-cloud-icon"><svg viewBox="0 0 24 20" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M6.5 17A4.5 4.5 0 015.1 8.2a6 6 0 0111.8 0A4.5 4.5 0 0117.5 17H6.5z" stroke-linecap="round" stroke-linejoin="round"/><line x1="3" y1="19" x2="21" y2="1" stroke="#FF6B6B" stroke-width="2.5" stroke-linecap="round"/></svg></span></span><span class="forge-hero-stat-label">No Cloud</span></div>
      </div>
    </div>
  </div>

  <!-- ===== RAVEN FORGE ===== -->
  <div class="forge-wrap">
    <div class="forge" style="position:relative;">
      <!-- Loading Overlay -->
      <div class="forge-gate" id="forgeGate">
        <div class="forge-setup">
          <img src="raven-icon.png" alt="RAVEN" class="forge-setup-icon">
          <div class="forge-setup-title">RAVEN Forge</div>
          <p class="forge-setup-sub">3B Parameter AI — Entirely in your browser.<br>Download &amp; cache once. <strong>No data ever leaves your device.</strong></p>
          <button class="forge-setup-btn" id="forgeLoadBtn" onclick="forgeStartEngine()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polygon points="5 3 19 12 5 21 5 3"/></svg>
            <span id="forgeLoadBtnText">Load AI Model</span>
          </button>
          <div class="forge-load-progress" id="forgeLoadProgress" style="display:none;">
            <div class="forge-load-bar"><div class="forge-load-fill" id="forgeLoadFill"></div></div>
            <div class="forge-load-status" id="forgeLoadStatus">Preparing download...</div>
          </div>
          <div class="forge-setup-error" id="forgeLoadError" style="display:none;"></div>
        </div>
      </div>

      <!-- Header -->
      <div class="forge-head">
        <div class="forge-head-left">
          <img src="raven-icon.png" alt="RAVEN" class="forge-head-icon">
          <span class="forge-head-title">RAVEN FORGE</span>
        </div>
        <div class="forge-head-right">
          <span class="forge-pill">IN-BROWSER</span>
          <button class="forge-gear" onclick="forgeToggleSettings()" title="Settings">
            <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 00-2 2v.18a2 2 0 01-1 1.73l-.43.25a2 2 0 01-2 0l-.15-.08a2 2 0 00-2.73.73l-.22.38a2 2 0 00.73 2.73l.15.1a2 2 0 011 1.72v.51a2 2 0 01-1 1.74l-.15.09a2 2 0 00-.73 2.73l.22.38a2 2 0 002.73.73l.15-.08a2 2 0 012 0l.43.25a2 2 0 011 1.73V20a2 2 0 002 2h.44a2 2 0 002-2v-.18a2 2 0 011-1.73l.43-.25a2 2 0 012 0l.15.08a2 2 0 002.73-.73l.22-.39a2 2 0 00-.73-2.73l-.15-.08a2 2 0 01-1-1.74v-.5a2 2 0 011-1.74l.15-.09a2 2 0 00.73-2.73l-.22-.38a2 2 0 00-2.73-.73l-.15.08a2 2 0 01-2 0l-.43-.25a2 2 0 01-1-1.73V4a2 2 0 00-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
          </button>
        </div>
      </div>

      <!-- Chat -->
      <div class="forge-chat" id="forgeChat">
        <div class="forge-welcome" id="forgeWelcome">
          <img src="raven-icon.png" alt="">
          <span>Ask anything. Runs in your browser.</span>
        </div>
      </div>

      <!-- Input -->
      <div class="forge-input-wrap">
        <div class="forge-bar">
          <textarea class="forge-textarea" id="forgeInput" rows="1" placeholder="Message RAVEN Forge..." onkeydown="forgeKeydown(event)" oninput="forgeResizeInput()"></textarea>
          <button class="forge-send" id="forgeSendBtn" disabled onclick="forgeSend()" title="Send">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/></svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="forge-modal-bg" id="forgeModalBg" onclick="if(event.target===this)forgeToggleSettings()">
    <div class="forge-modal">
      <h3>Forge Settings</h3>
      <label>Temperature</label>
      <input id="forgeSettingTemp" type="number" step="0.1" min="0" max="2" value="0.7">
      <label>Max Tokens</label>
      <input id="forgeSettingTokens" type="number" step="256" min="256" max="4096" value="1024">
      <button class="forge-modal-close" onclick="forgeSaveSettings()">Save & Close</button>
    </div>
  </div>


  <!-- FORGE DARK ZONE -->
  <div class="forge-dark-zone">
    <div class="forge-dark-glow"></div>

  <!-- FORGE MODEL RUNNER -->
  <div class="forge-runner">
    <div class="works-with forge-works-with">
      <div class="works-with-label forge-works-label">Works with open source models from</div>
      <div class="marquee-mask">
        <div class="marquee-track">
          <div class="ai-logo-chip forge-chip"><img src="https://www.google.com/s2/favicons?domain=qwenlm.ai&sz=64" alt="" onerror="this.style.display='none'">Qwen</div>
          <div class="ai-logo-chip forge-chip"><img src="https://www.google.com/s2/favicons?domain=llama.meta.com&sz=64" alt="" onerror="this.style.display='none'">Llama</div>
          <div class="ai-logo-chip forge-chip"><img src="https://www.google.com/s2/favicons?domain=ai.google.dev&sz=64" alt="" onerror="this.style.display='none'">Gemma</div>
          <div class="ai-logo-chip forge-chip"><img src="https://www.google.com/s2/favicons?domain=mistral.ai&sz=64" alt="" onerror="this.style.display='none'">Mistral</div>
          <div class="ai-logo-chip forge-chip"><img src="https://www.google.com/s2/favicons?domain=microsoft.com&sz=64" alt="" onerror="this.style.display='none'">Phi</div>
          <div class="ai-logo-chip forge-chip"><img src="https://www.google.com/s2/favicons?domain=huggingface.co&sz=64" alt="" onerror="this.style.display='none'">SmolLM</div>
          <div class="ai-logo-chip forge-chip"><img src="https://www.google.com/s2/favicons?domain=stability.ai&sz=64" alt="" onerror="this.style.display='none'">StableLM</div>
          <div class="ai-logo-chip forge-chip"><img src="https://www.google.com/s2/favicons?domain=together.ai&sz=64" alt="" onerror="this.style.display='none'">RedPajama</div>
          <!-- duplicate set for seamless loop -->
          <div class="ai-logo-chip forge-chip"><img src="https://www.google.com/s2/favicons?domain=qwenlm.ai&sz=64" alt="" onerror="this.style.display='none'">Qwen</div>
          <div class="ai-logo-chip forge-chip"><img src="https://www.google.com/s2/favicons?domain=llama.meta.com&sz=64" alt="" onerror="this.style.display='none'">Llama</div>
          <div class="ai-logo-chip forge-chip"><img src="https://www.google.com/s2/favicons?domain=ai.google.dev&sz=64" alt="" onerror="this.style.display='none'">Gemma</div>
          <div class="ai-logo-chip forge-chip"><img src="https://www.google.com/s2/favicons?domain=mistral.ai&sz=64" alt="" onerror="this.style.display='none'">Mistral</div>
          <div class="ai-logo-chip forge-chip"><img src="https://www.google.com/s2/favicons?domain=microsoft.com&sz=64" alt="" onerror="this.style.display='none'">Phi</div>
          <div class="ai-logo-chip forge-chip"><img src="https://www.google.com/s2/favicons?domain=huggingface.co&sz=64" alt="" onerror="this.style.display='none'">SmolLM</div>
          <div class="ai-logo-chip forge-chip"><img src="https://www.google.com/s2/favicons?domain=stability.ai&sz=64" alt="" onerror="this.style.display='none'">StableLM</div>
          <div class="ai-logo-chip forge-chip"><img src="https://www.google.com/s2/favicons?domain=together.ai&sz=64" alt="" onerror="this.style.display='none'">RedPajama</div>
        </div>
      </div>
    </div>
  </div>

  <!-- FORGE TAGLINE -->
  <div class="forge-tagline">
    <div class="forge-tagline-text"><span>RAVEN</span> <em>|</em> Secure Local AI</div>
  </div>

  </div><!-- /forge-dark-zone -->

  <!-- ===== EVA ===== -->
  <div class="eva-section" id="eva">
    <div class="eva-glow-bar"></div>

    <!-- Hero -->
    <div class="vt-hero">
      <div class="vt-hero-content">
        <div class="vt-hero-badge">Voice Intelligence</div>
        <h2 class="vt-hero-title">NDi <span>EVA</span></h2>
        <p class="vt-hero-sub"><strong style="color:#fff;font-size:20px;">Speak. Transcribe. Deploy.</strong><br>Real-time voice-to-text running entirely in your browser. Zero latency.</p>
        <div class="vt-hero-stats">
          <div class="vt-hero-stat"><span class="vt-hero-stat-value">0ms</span><span class="vt-hero-stat-label">Latency</span></div>
          <div class="vt-hero-stat-divider"></div>
          <div class="vt-hero-stat"><span class="vt-hero-stat-value">WASM</span><span class="vt-hero-stat-label">Accelerated</span></div>
          <div class="vt-hero-stat-divider"></div>
          <div class="vt-hero-stat"><span class="vt-hero-stat-value">Local</span><span class="vt-hero-stat-label">Transcription</span></div>
          <div class="vt-hero-stat-divider"></div>
          <div class="vt-hero-stat"><span class="vt-hero-stat-value"><span class="no-cloud-icon"><svg viewBox="0 0 24 20" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M6.5 17A4.5 4.5 0 015.1 8.2a6 6 0 0111.8 0A4.5 4.5 0 0117.5 17H6.5z" stroke-linecap="round" stroke-linejoin="round"/><line x1="3" y1="19" x2="21" y2="1" stroke="#FF6B6B" stroke-width="2.5" stroke-linecap="round"/></svg></span></span><span class="vt-hero-stat-label">No Cloud</span></div>
        </div>
      </div>
    </div>

    <!-- Tool area -->
    <div class="eva-tool-area">

    <!-- SVG gradient defs for waveform + squiggle -->
    <svg width="0" height="0" style="position:absolute">
      <defs>
        <linearGradient id="vtWaveGrad" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="#07B0E8"/>
          <stop offset="100%" stop-color="#6366f1"/>
        </linearGradient>
        <linearGradient id="vtWaveRedGrad" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="#ef4444"/>
          <stop offset="100%" stop-color="#f87171"/>
        </linearGradient>
        <linearGradient id="vtSquiggleGrad" x1="0" y1="0" x2="1" y2="0">
          <stop offset="0%" stop-color="rgba(99,102,241,0)"/>
          <stop offset="30%" stop-color="#6366f1"/>
          <stop offset="70%" stop-color="#07B0E8"/>
          <stop offset="100%" stop-color="rgba(7,176,232,0)"/>
        </linearGradient>
      </defs>
    </svg>

    <!-- Horizontal pill -->
    <div class="vt-tool" id="vtPill">

      <!-- Left: status text (shown during loading/transcribing) -->
      <span class="vt-pill-status" id="vtPillStatus"></span>

      <!-- Center: waveform area -->
      <div class="vt-wave-area">
        <!-- Squiggle for loading state -->
        <svg class="vt-squiggle" viewBox="0 0 300 48" preserveAspectRatio="none" id="vtSquiggle">
          <path d="" stroke-dasharray="30 30"/>
        </svg>
        <!-- Canvas for live waveform -->
        <canvas class="vt-wave-canvas" id="vtWaveCanvas"></canvas>
      </div>

      <!-- Right: timer + button -->
      <div class="vt-pill-right">
        <span class="vt-timer" id="vtTimer">0:00</span>
        <button class="vt-rec-btn" id="vtRecBtn" onclick="vtToggleRecord()">
          <svg class="vt-mic-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="9" y="1" width="6" height="12" rx="3"/>
            <path d="M19 10v1a7 7 0 01-14 0v-1"/>
            <line x1="12" y1="18" x2="12" y2="23"/>
            <line x1="8" y1="23" x2="16" y2="23"/>
          </svg>
          <div class="vt-stop-shape"></div>
          <div class="vt-spin"></div>
        </button>
      </div>
    </div>

    <!-- Transcript (appears below pill after recording) -->
    <div class="vt-transcript" id="vtTranscript" style="display:none">
      <div class="vt-transcript-header">
        <span>Transcript</span>
        <span class="vt-word-count" id="vtWordCount">0 words</span>
      </div>
      <div class="vt-transcript-body" id="vtTranscriptBody"></div>
      <div class="vt-actions">
        <button class="vt-btn-copy" onclick="vtCopy()">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1" stroke-linecap="round"/></svg>
          Save
        </button>
        <button class="vt-btn-download" onclick="vtDownload()">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4" stroke-linecap="round" stroke-linejoin="round"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          Download
        </button>
      </div>
    </div>

    </div><!-- /eva-tool-area -->

    <!-- Works with (dark variant) -->
    <div class="eva-works-with">
      <div class="works-with" style="margin-top:0; padding-top:16px; border-top:none;">
        <div class="works-with-label">Works with</div>
        <div class="marquee-mask">
          <div class="marquee-track">
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=docs.google.com&sz=64" alt="" onerror="this.style.display='none'">Google Docs</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=notion.so&sz=64" alt="" onerror="this.style.display='none'">Notion</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=slack.com&sz=64" alt="" onerror="this.style.display='none'">Slack</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=chatgpt.com&sz=64" alt="" onerror="this.style.display='none'">ChatGPT</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=claude.ai&sz=64" alt="" onerror="this.style.display='none'">Claude</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=mail.google.com&sz=64" alt="" onerror="this.style.display='none'">Gmail</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=microsoft.com&sz=64" alt="" onerror="this.style.display='none'">Word</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=teams.microsoft.com&sz=64" alt="" onerror="this.style.display='none'">Teams</div>
            <!-- duplicate for seamless loop -->
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=docs.google.com&sz=64" alt="" onerror="this.style.display='none'">Google Docs</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=notion.so&sz=64" alt="" onerror="this.style.display='none'">Notion</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=slack.com&sz=64" alt="" onerror="this.style.display='none'">Slack</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=chatgpt.com&sz=64" alt="" onerror="this.style.display='none'">ChatGPT</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=claude.ai&sz=64" alt="" onerror="this.style.display='none'">Claude</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=mail.google.com&sz=64" alt="" onerror="this.style.display='none'">Gmail</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=microsoft.com&sz=64" alt="" onerror="this.style.display='none'">Word</div>
            <div class="ai-logo-chip"><img src="https://www.google.com/s2/favicons?domain=teams.microsoft.com&sz=64" alt="" onerror="this.style.display='none'">Teams</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tagline -->
    <div class="eva-tagline">
      <div class="eva-tagline-text">Powered by <span>local transcription</span> · Runs on device · Your voice never leaves the browser</div>
    </div>

  </div><!-- /eva-section -->

  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-inner">
      <!-- Footer Grid -->
      <div class="footer-grid">
        <!-- Brand Column -->
        <div>
          <img src="ndiautodark.png" alt="NDi Auto" class="footer-brand-logo">
          <p class="footer-brand-desc">NDi Auto is the AI &amp; Automation Research Division of Network Designs, Inc. — a Service-Disabled Veteran-Owned Small Business delivering mission-critical IT solutions for three decades.</p>
          <div class="footer-sdvosb">
            <span class="footer-sdvosb-dot"></span>
            OPERATIONAL | <span class="live-date"></span>
          </div>
          <div class="footer-social">
            <a href="https://www.linkedin.com/company/network-designs-inc-/" target="_blank" aria-label="LinkedIn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
            </a>
            <a href="https://netdes.com" target="_blank" aria-label="Website">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"/></svg>
            </a>
          </div>
        </div>

        <!-- Tools Column -->
        <div>
          <div class="footer-col-title">Tools</div>
          <ul class="footer-links">
            <li><a href="#smartdoc">NDi SmartDoc</a></li>
            <li><a href="#superprompt">NDi SuperPrompt™</a></li>
          </ul>
        </div>

        <!-- Company Column -->
        <div>
          <div class="footer-col-title">Company</div>
          <ul class="footer-links">
            <li><a href="https://netdes.com" target="_blank">netdes.com</a></li>
            <li><a href="https://netdes.com/about/" target="_blank">About NDi</a></li>
            <li><a href="https://netdes.com/veterans-first/" target="_blank">Veterans First</a></li>
            <li><a href="https://netdes.com/contracts/" target="_blank">Contracts</a></li>
            <li><a href="https://netdes.com/capabilities/" target="_blank">Capabilities</a></li>
          </ul>
        </div>

        <!-- Contact Column -->
        <div>
          <div class="footer-col-title">Contact</div>
          <div class="footer-contact-item">
            <strong>Headquarters</strong><br>
            1651 Old Meadow Road<br>
            Suite 105, McLean, VA
          </div>
          <div class="footer-contact-item">
            <strong>Phone</strong><br>
            <a href="tel:7032552206">(703) 255-2206</a>
          </div>
          <div class="footer-contact-item">
            <strong>Email</strong><br>
            <a href="mailto:info@netdes.com">info@netdes.com</a>
          </div>
        </div>
      </div>

      <!-- Bottom Bar -->
      <div class="footer-bottom">
        <span>© 2026 Network Designs, Inc. All rights reserved.</span>
        <div class="footer-bottom-links">
          <a href="https://netdes.com/privacy-policy/" target="_blank">Privacy Policy</a>
          <a href="https://netdes.com/terms-and-conditions/" target="_blank">Terms &amp; Conditions</a>
        </div>
      </div>
    </div>
  </footer>

</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
// ========== SYSTEM PROMPT (baked into every SmartDocs output — invisible to user) ==========
const SYSTEM_PROMPT = `<SmartDocs_Instructions>
You have been given a SmartDocs Master Corpus below. This is your primary knowledge base.

Rules:
- Think step by step. Be thorough. Take your time before answering.
- ONLY use information from the corpus below. If it's not in here, say "not found in the provided documents."
- Cite the source filename from <Meta> tags when referencing specific information.
- Synthesize across multiple documents when a question spans topics.
- Never fabricate, hallucinate, or guess. Precision over speed.
- When summarizing, preserve key details — do not over-compress.
- If asked to compare documents, create structured side-by-side analysis.
- Default to being exhaustive rather than brief unless told otherwise.

Corpus format: <SmartDocs_Library> → <Doc> → <Meta>(filename)</Meta> → <Body>(content)</Body>
</SmartDocs_Instructions>`;

// ========== NDi SUPER PROMPT™ (standalone — paste before any prompt) ==========
const SUPER_PROMPT = `[System: NDi_SuperPrompt™ — Cognitive Overdrive Protocol]
[Reasoning: Maximum | Depth: Exhaustive | Precision: Absolute]

Before responding, execute the following internal sequence:

<thinking>
PHASE 1 — DECONSTRUCT
- Parse the user's request into every atomic constraint, implicit and explicit.
- Identify the core objective, secondary goals, edge cases, and unstated assumptions.
- Flag ambiguities. Resolve them with the most useful interpretation.

PHASE 2 — DIVERGE
- Generate three fundamentally different solution approaches.
- Each must differ in methodology, not just wording.
- At least one approach must be unconventional.

PHASE 3 — STRESS TEST
- For each approach, identify the top 3 failure modes.
- Ask: Where does this break? What does this miss? What would an expert critique?
- Rank approaches by robustness, clarity, and completeness.

PHASE 4 — SYNTHESIZE
- Merge the strongest elements from all approaches into one final response.
- Eliminate redundancy. Maximize signal-to-noise ratio.
- Ensure every claim is defensible and every recommendation is actionable.
</thinking>

Response standards:
- Be thorough but never verbose. Every sentence must earn its place.
- Use precise language. Avoid filler, hedging, and unnecessary qualifiers.
- Structure for clarity: lead with the answer, then support with reasoning.
- If you don't know something, say so. Never fabricate.
- Think longer than you normally would. The extra cycles are worth it.
- Default to being the smartest, most useful version of yourself.

Now respond to the following:
`;

document.getElementById('superPromptBox').textContent = SUPER_PROMPT;

// ========== SHARED UTILITIES ==========
const EXT_COLORS = {
  pdf:  { bg: 'rgba(220,53,69,0.15)', border: 'rgba(220,53,69,0.35)', color: '#e85d6f' },
  docx: { bg: 'rgba(43,87,154,0.15)', border: 'rgba(43,87,154,0.35)', color: '#5b9aed' },
  doc:  { bg: 'rgba(43,87,154,0.15)', border: 'rgba(43,87,154,0.35)', color: '#5b9aed' },
  pptx: { bg: 'rgba(209,105,46,0.15)', border: 'rgba(209,105,46,0.35)', color: '#e8874a' },
  ppt:  { bg: 'rgba(209,105,46,0.15)', border: 'rgba(209,105,46,0.35)', color: '#e8874a' },
  xlsx: { bg: 'rgba(33,115,70,0.15)', border: 'rgba(33,115,70,0.35)', color: '#3dbf6e' },
  xls:  { bg: 'rgba(33,115,70,0.15)', border: 'rgba(33,115,70,0.35)', color: '#3dbf6e' },
  csv:  { bg: 'rgba(130,150,50,0.15)', border: 'rgba(130,150,50,0.35)', color: '#a8b84a' },
  txt:  { bg: 'rgba(140,140,140,0.15)', border: 'rgba(140,140,140,0.3)', color: '#a0a0a0' },
  jpg:  { bg: 'rgba(128,60,180,0.15)', border: 'rgba(128,60,180,0.35)', color: '#b07ce0' },
  jpeg: { bg: 'rgba(128,60,180,0.15)', border: 'rgba(128,60,180,0.35)', color: '#b07ce0' },
  png:  { bg: 'rgba(128,60,180,0.15)', border: 'rgba(128,60,180,0.35)', color: '#b07ce0' },
};
const EXT_DEFAULT = { bg: 'rgba(7,176,232,0.1)', border: 'rgba(7,176,232,0.25)', color: '#4dc9f6' };

function extColor(name) {
  return EXT_COLORS[name.split('.').pop().toLowerCase()] || EXT_DEFAULT;
}

function fmtSize(bytes) {
  if (bytes >= 1073741824) return (bytes / 1073741824).toFixed(2) + ' GB';
  if (bytes >= 1048576) return (bytes / 1048576).toFixed(1) + ' MB';
  return (bytes / 1024).toFixed(1) + ' KB';
}

function esc(s) { return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

// Shared file extraction — used by both SmartDocs and Forge
async function extractFileText(file) {
  const ext = file.name.split('.').pop().toLowerCase();
  try {
    if (ext === 'txt' || ext === 'csv') return await file.text();
    if (ext === 'pdf') {
      const buf = await file.arrayBuffer();
      const pdf = await pdfjsLib.getDocument({ data: buf }).promise;
      let t = '';
      for (let i = 1; i <= pdf.numPages; i++) {
        const pg = await pdf.getPage(i);
        const tc = await pg.getTextContent();
        t += tc.items.map(x => x.str).join(' ') + '\n';
      }
      return t;
    }
    if (ext === 'docx' || ext === 'doc') {
      const buf = await file.arrayBuffer();
      return (await mammoth.extractRawText({ arrayBuffer: buf })).value;
    }
    if (ext === 'xlsx' || ext === 'xls') {
      const buf = await file.arrayBuffer();
      const wb = XLSX.read(buf, { type: 'array' });
      return wb.SheetNames.map(n => `[Sheet: ${n}]\n` + XLSX.utils.sheet_to_csv(wb.Sheets[n])).join('\n\n');
    }
    if (ext === 'pptx' || ext === 'ppt') {
      const buf = await file.arrayBuffer();
      const zip = await JSZip.loadAsync(buf);
      const slides = Object.keys(zip.files)
        .filter(n => /^ppt\/slides\/slide\d+\.xml$/.test(n))
        .sort((a,b) => parseInt(a.match(/\d+/)[0]) - parseInt(b.match(/\d+/)[0]));
      let t = '';
      for (const s of slides) {
        const xml = await zip.files[s].async('text');
        const doc = new DOMParser().parseFromString(xml, 'application/xml');
        for (const el of doc.getElementsByTagName('a:t')) t += (el.textContent || '') + ' ';
        t += '\n';
      }
      return t;
    }
    return await file.text();
  } catch (e) { return `[Error extracting ${file.name}: ${e.message}]`; }
}

// ========== STATE ==========
let stagedFiles = [];
let masterCorpus = '';

// ========== DOM ==========
const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');
const fileListEl = document.getElementById('fileList');
const stagedBar = document.getElementById('stagedBar');
const processBtn = document.getElementById('processBtn');

// ========== DRAG & DROP ==========
dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('dragover'); });
dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
dropZone.addEventListener('drop', e => { e.preventDefault(); dropZone.classList.remove('dragover'); addFiles(e.dataTransfer.files); });
fileInput.addEventListener('change', e => addFiles(e.target.files));

function addFiles(list) {
  for (const f of list) {
    if (!stagedFiles.find(s => s.name === f.name && s.size === f.size)) stagedFiles.push(f);
  }
  renderFiles();
}

function removeFile(i) { stagedFiles.splice(i, 1); renderFiles(); }

function clearAllFiles() {
  if (stagedFiles.length === 0) return;
  if (!confirm(`Remove all ${stagedFiles.length} staged documents?`)) return;
  stagedFiles = []; sortMode = 'uploaded'; renderFiles();
}

// Sort modes: uploaded → size-asc → size-desc → type
let sortMode = 'uploaded';
const sortModes = ['uploaded', 'size-asc', 'size-desc', 'type'];
const sortLabels = { 'uploaded': 'Uploaded', 'size-asc': 'Size ↑', 'size-desc': 'Size ↓', 'type': 'File Type' };

function cycleSort() {
  const idx = sortModes.indexOf(sortMode);
  sortMode = sortModes[(idx + 1) % sortModes.length];
  renderFiles();
}

function getSortedFiles() {
  const files = stagedFiles.map((f, i) => ({ file: f, origIdx: i }));
  if (sortMode === 'uploaded') return files;
  if (sortMode === 'size-asc') return files.sort((a, b) => a.file.size - b.file.size);
  if (sortMode === 'size-desc') return files.sort((a, b) => b.file.size - a.file.size);
  if (sortMode === 'type') {
    return files.sort((a, b) => {
      const extA = a.file.name.split('.').pop().toLowerCase();
      const extB = b.file.name.split('.').pop().toLowerCase();
      if (extA !== extB) return extA.localeCompare(extB);
      return b.file.size - a.file.size;
    });
  }
  return files;
}

function renderFiles() {
  const sorted = getSortedFiles();
  fileListEl.innerHTML = sorted.map(({ file: f, origIdx }) => {
    const ext = f.name.split('.').pop().toLowerCase();
    const c = extColor(f.name);
    return `<div class="file-item">
      <div class="file-info">
        <span class="file-ext" style="background:${c.bg};border:1px solid ${c.border};color:${c.color}">${ext.toUpperCase()}</span>
        <span class="file-name">${f.name}</span>
      </div>
      <div class="file-meta">
        <span class="file-size">${fmtSize(f.size)}</span>
        <button class="file-remove" onclick="removeFile(${origIdx})">✕</button>
      </div>
    </div>`;
  }).join('');

  // Update sort button
  const sortBtn = document.getElementById('sortBtn');
  const sortLabel = document.getElementById('sortLabel');
  if (sortBtn && sortLabel) {
    sortLabel.textContent = sortLabels[sortMode];
    sortBtn.classList.toggle('active', sortMode !== 'uploaded');
  }

  // Reset button to ready state
  processBtn.classList.remove('processing', 'done');
  processBtn.querySelector('.btn-label').textContent = 'Begin Serialization';
  document.getElementById('btnLaser').style.width = '0%';
  document.getElementById('processStatus').innerHTML = '';

  if (stagedFiles.length) {
    const totalBytes = stagedFiles.reduce((s,f) => s + f.size, 0);
    document.getElementById('stagedCount').textContent = stagedFiles.length;
    document.getElementById('stagedSize').textContent = fmtSize(totalBytes);
    stagedBar.classList.add('visible');
    processBtn.disabled = false;
  } else {
    stagedBar.classList.remove('visible');
    processBtn.disabled = true;
  }
  document.getElementById('resultSection').classList.remove('visible');
}

// ========== MAIN PROCESS ==========
const PROCESS_MESSAGES = [
  'Initializing serialization engine…',
  'Parsing document structure…',
  'Extracting text layers…',
  'Resolving embedded objects…',
  'Normalizing character encoding…',
  'Building semantic index…',
  'Structuring XML corpus…',
  'Assembling SmartDoc payload…',
  'Optimizing for LLM context windows…',
  'Running final validation…',
  'Compressing output…',
  'Finalizing…',
];

// Organic easing — fast start, slows in middle, surges near end
function organicEase(t) {
  // Perlin-ish feel: base cubic ease + sine wobble
  const base = t < 0.5
    ? 4 * t * t * t
    : 1 - Math.pow(-2 * t + 2, 3) / 2;
  const wobble = Math.sin(t * Math.PI * 5.7) * 0.012 * (1 - t);
  return Math.min(1, Math.max(0, base + wobble));
}

async function beginProcess() {
  const btnLaser = document.getElementById('btnLaser');
  const processStatus = document.getElementById('processStatus');
  const resultSection = document.getElementById('resultSection');

  // Random duration between 3.2–5.3s
  const totalMs = 3200 + Math.random() * 2100;

  // Reset states
  processBtn.classList.remove('done');
  processBtn.classList.add('processing');
  btnLaser.style.width = '0%';
  btnLaser.style.opacity = '0';
  processStatus.innerHTML = '';
  resultSection.classList.remove('visible');

  // Brief delay before laser starts — prevents the initial sliver flash
  await new Promise(r => setTimeout(r, 200));
  btnLaser.style.opacity = '1';

  const startTime = Date.now();

  // Rolling status messages — 1.8s each for slower readability
  const msgCount = Math.min(PROCESS_MESSAGES.length, Math.floor(totalMs / 1800) + 1);
  let msgIdx = 0;
  function showNextMessage() {
    if (msgIdx < msgCount) {
      processStatus.innerHTML = `<span>${PROCESS_MESSAGES[msgIdx]}</span>`;
      msgIdx++;
    }
  }
  showNextMessage();
  const msgInterval = setInterval(() => showNextMessage(), 1800);

  // Organic laser fill — uses easing + random micro-stutters
  let laserTarget = 0;
  let laserCurrent = 0;
  const fillFrame = () => {
    const elapsed = Date.now() - startTime;
    const t = Math.min(1, elapsed / totalMs);
    // Ease to 92% during processing, leave room for final surge
    laserTarget = organicEase(t) * 92;
    // Smooth chase with slight lag for organic feel
    laserCurrent += (laserTarget - laserCurrent) * 0.08;
    // Don't render below 0.5% to prevent sliver
    btnLaser.style.width = (laserCurrent < 0.5 ? 0 : laserCurrent).toFixed(2) + '%';
    if (t < 1) requestAnimationFrame(fillFrame);
  };
  requestAnimationFrame(fillFrame);

  // Actual processing (runs in parallel with animation)
  masterCorpus = SYSTEM_PROMPT + '\n\n<SmartDocs_Library>\n';
  for (let i = 0; i < stagedFiles.length; i++) {
    const f = stagedFiles[i];
    const text = await extractFileText(f);
    masterCorpus += `\n<Doc>\n  <Meta>${esc(f.name)}</Meta>\n  <Body>\n${esc(text)}\n  </Body>\n</Doc>\n`;
  }
  masterCorpus += '\n</SmartDocs_Library>';

  // Wait for minimum duration
  const elapsed = Date.now() - startTime;
  if (elapsed < totalMs) {
    await new Promise(r => setTimeout(r, totalMs - elapsed));
  }

  clearInterval(msgInterval);

  // Surge to 100%
  btnLaser.style.transition = 'width 0.3s cubic-bezier(0.22, 1, 0.36, 1)';
  btnLaser.style.width = '100%';
  processStatus.innerHTML = '<span>Complete</span>';

  await new Promise(r => setTimeout(r, 500));

  // Done state
  btnLaser.style.transition = '';
  processBtn.classList.remove('processing');
  processBtn.classList.add('done');
  btnLaser.style.width = '0%';
  processStatus.innerHTML = '';
  processBtn.querySelector('.btn-label').textContent = 'SERIALIZATION COMPLETE';

  resultSection.classList.add('visible');
}

// ========== ACTIONS ==========
function downloadCorpus() {
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([masterCorpus], { type: 'text/plain' }));
  const d = new Date();
  const mm = String(d.getMonth()+1).padStart(2,'0');
  const dd = String(d.getDate()).padStart(2,'0');
  const yy = String(d.getFullYear()).slice(-2);
  a.download = `NDi_SmartDoc_${mm}-${dd}-${yy}.txt`;
  a.click(); URL.revokeObjectURL(a.href);
  showToast('SmartDoc downloaded');
}

function copyCorpus() {
  navigator.clipboard.writeText(masterCorpus).then(() => showToast('SmartDoc Contents Copied to Clipboard!'));
}

function copySuperPrompt() {
  navigator.clipboard.writeText(SUPER_PROMPT).then(() => showToast('NDi SuperPrompt™ copied — paste before any prompt'));
}

function showToast(msg, raven) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.toggle('raven-toast', !!raven);
  t.classList.add('visible');
  setTimeout(() => t.classList.remove('visible'), 2400);
}

// ========== NDi EVA ==========
(function() {
  // State
  let vtRecording = false;
  let vtProcessing = false;
  let vtStream = null;
  let vtAudioCtx = null;
  let vtAnalyser = null;
  let vtAnimFrame = null;
  let vtMediaRecorder = null;
  let vtChunks = [];
  let vtTranscriptText = '';
  let vtTimerInterval = null;
  let vtSeconds = 0;
  let vtWhisperPipeline = null;
  let vtModelLoaded = false;
  let vtSquigglePhase = 0;

  // DOM refs
  const vtPill = document.getElementById('vtPill');
  const vtTimer = document.getElementById('vtTimer');
  const vtPillStatus = document.getElementById('vtPillStatus');
  const vtCanvas = document.getElementById('vtWaveCanvas');
  const vtCtx = vtCanvas.getContext('2d');
  const vtSquiggle = document.getElementById('vtSquiggle');
  const vtRecBtn = document.getElementById('vtRecBtn');
  const vtTranscript = document.getElementById('vtTranscript');
  const vtTranscriptBody = document.getElementById('vtTranscriptBody');
  const vtWordCount = document.getElementById('vtWordCount');

  // Canvas sizing
  function vtSizeCanvas() {
    const rect = vtCanvas.parentElement.getBoundingClientRect();
    vtCanvas.width = rect.width * 2;
    vtCanvas.height = rect.height * 2;
    vtCanvas.style.width = rect.width + 'px';
    vtCanvas.style.height = rect.height + 'px';
    vtCtx.scale(2, 2);
  }
  vtSizeCanvas();
  window.addEventListener('resize', vtSizeCanvas);

  // Draw idle flat line with faint glow
  function vtDrawIdle() {
    const w = vtCanvas.width / 2;
    const h = vtCanvas.height / 2;
    vtCtx.clearRect(0, 0, w, h);
    vtCtx.beginPath();
    vtCtx.moveTo(0, h / 2);
    vtCtx.lineTo(w, h / 2);
    vtCtx.strokeStyle = 'rgba(255,255,255,0.1)';
    vtCtx.lineWidth = 1.5;
    vtCtx.stroke();
  }
  vtDrawIdle();

  // Squiggle path animation for loading state
  function vtUpdateSquiggle() {
    vtSquigglePhase += 0.06;
    const path = vtSquiggle.querySelector('path');
    let d = 'M 0 24';
    for (let x = 0; x <= 300; x += 2) {
      const y = 24 + Math.sin((x / 20) + vtSquigglePhase) * 8 * Math.sin((x / 300) * Math.PI);
      d += ` L ${x} ${y.toFixed(1)}`;
    }
    path.setAttribute('d', d);
    path.setAttribute('stroke-dasharray', '30 30');
    if (vtPill.classList.contains('loading')) {
      requestAnimationFrame(vtUpdateSquiggle);
    }
  }

  // Smoothed waveform state — lerp between frames for buttery animation
  const VT_NUM_POINTS = 48;
  const VT_SMOOTH = 0.18; // lower = smoother (0-1)
  let vtSmoothed = new Float32Array(VT_NUM_POINTS);

  function vtDrawWaveform() {
    if (!vtAnalyser) return;
    const w = vtCanvas.width / 2;
    const h = vtCanvas.height / 2;
    const mid = h / 2;
    const data = new Uint8Array(vtAnalyser.frequencyBinCount);
    vtAnalyser.getByteFrequencyData(data);

    vtCtx.clearRect(0, 0, w, h);

    // Sample frequency bins → target values with center boost
    const step = Math.floor(data.length / VT_NUM_POINTS);
    for (let i = 0; i < VT_NUM_POINTS; i++) {
      const raw = data[i * step] / 255;
      const distFromCenter = Math.abs(i - VT_NUM_POINTS / 2) / (VT_NUM_POINTS / 2);
      const target = raw * (1 - distFromCenter * 0.5);
      // Lerp toward target — rise fast, fall slow for natural decay
      const speed = target > vtSmoothed[i] ? 0.35 : VT_SMOOTH;
      vtSmoothed[i] += (target - vtSmoothed[i]) * speed;
    }

    // Gradient
    const grad = vtCtx.createLinearGradient(0, mid - 20, 0, mid + 20);
    if (vtRecording) {
      grad.addColorStop(0, 'rgba(239,68,68,0.85)');
      grad.addColorStop(0.5, 'rgba(248,113,113,0.5)');
      grad.addColorStop(1, 'rgba(239,68,68,0.85)');
    } else {
      grad.addColorStop(0, 'rgba(7,176,232,0.8)');
      grad.addColorStop(0.5, 'rgba(99,102,241,0.5)');
      grad.addColorStop(1, 'rgba(7,176,232,0.8)');
    }

    // Draw mirrored smooth wave using quadratic bezier
    vtCtx.beginPath();
    for (let i = 0; i < VT_NUM_POINTS; i++) {
      const x = (i / (VT_NUM_POINTS - 1)) * w;
      const amp = vtSmoothed[i] * (mid - 4);
      if (i === 0) { vtCtx.moveTo(x, mid - amp); continue; }
      const px = ((i - 1) / (VT_NUM_POINTS - 1)) * w;
      vtCtx.quadraticCurveTo((px + x) / 2, mid - vtSmoothed[i - 1] * (mid - 4), x, mid - amp);
    }
    for (let i = VT_NUM_POINTS - 1; i >= 0; i--) {
      const x = (i / (VT_NUM_POINTS - 1)) * w;
      const amp = vtSmoothed[i] * (mid - 4);
      if (i === VT_NUM_POINTS - 1) { vtCtx.lineTo(x, mid + amp); continue; }
      const nx = ((i + 1) / (VT_NUM_POINTS - 1)) * w;
      vtCtx.quadraticCurveTo((nx + x) / 2, mid + vtSmoothed[i + 1] * (mid - 4), x, mid + amp);
    }
    vtCtx.closePath();
    vtCtx.fillStyle = grad;
    vtCtx.fill();

    // Center glow line
    vtCtx.beginPath();
    for (let i = 0; i < VT_NUM_POINTS; i++) {
      const x = (i / (VT_NUM_POINTS - 1)) * w;
      const y = mid - vtSmoothed[i] * (mid - 4) * 0.12;
      if (i === 0) { vtCtx.moveTo(x, y); continue; }
      const px = ((i - 1) / (VT_NUM_POINTS - 1)) * w;
      vtCtx.quadraticCurveTo((px + x) / 2, mid - vtSmoothed[i - 1] * (mid - 4) * 0.12, x, y);
    }
    vtCtx.strokeStyle = vtRecording ? 'rgba(255,255,255,0.5)' : 'rgba(255,255,255,0.3)';
    vtCtx.lineWidth = 1.5;
    vtCtx.stroke();

    vtAnimFrame = requestAnimationFrame(vtDrawWaveform);
  }

  // Timer
  function vtStartTimer() {
    vtSeconds = 0;
    vtTimer.textContent = '0:00';
    vtTimerInterval = setInterval(() => {
      vtSeconds++;
      const m = Math.floor(vtSeconds / 60);
      const s = String(vtSeconds % 60).padStart(2, '0');
      vtTimer.textContent = m + ':' + s;
    }, 1000);
  }
  function vtStopTimer() { clearInterval(vtTimerInterval); vtTimerInterval = null; }

  const EVA_CDN = 'https://files.ndiauto.com/ndi-r2-upload';

  // Load Whisper model — self-hosted from files.ndiauto.com
  async function vtLoadModel() {
    if (vtWhisperPipeline) return;
    vtPill.classList.add('loading');
    vtPillStatus.textContent = 'Loading model...';
    vtUpdateSquiggle();

    const { pipeline, env } = await import(EVA_CDN + '/lib/transformers.min.js');

    // Point model loading at our R2 CDN — zero HuggingFace requests
    // WASM files live in /lib/ next to the JS (webpack resolves relative to itself)
    env.remoteHost = EVA_CDN + '/models';
    env.remotePathTemplate = '{model}/';
    env.allowLocalModels = false;

    vtWhisperPipeline = await pipeline(
      'automatic-speech-recognition',
      'onnx-community/whisper-tiny.en',
      { dtype: 'q8', device: 'wasm' }
    );
    vtModelLoaded = true;
    vtPill.classList.remove('loading');
    vtPillStatus.textContent = '';
    vtDrawIdle();
  }

  // Background preload — silently cache model files after page settles
  function vtPreload() {
    if (vtModelLoaded) return;
    const files = [
      EVA_CDN + '/lib/transformers.min.js',
      EVA_CDN + '/lib/ort.bundle.min.mjs',
      EVA_CDN + '/lib/ort-wasm-simd-threaded.jsep.wasm',
      EVA_CDN + '/lib/ort-wasm-simd-threaded.jsep.mjs',
      EVA_CDN + '/models/onnx-community/whisper-tiny.en/config.json',
      EVA_CDN + '/models/onnx-community/whisper-tiny.en/generation_config.json',
      EVA_CDN + '/models/onnx-community/whisper-tiny.en/preprocessor_config.json',
      EVA_CDN + '/models/onnx-community/whisper-tiny.en/tokenizer.json',
      EVA_CDN + '/models/onnx-community/whisper-tiny.en/tokenizer_config.json',
      EVA_CDN + '/models/onnx-community/whisper-tiny.en/onnx/encoder_model_quantized.onnx',
      EVA_CDN + '/models/onnx-community/whisper-tiny.en/onnx/decoder_model_merged_quantized.onnx',
    ];
    // Use low-priority fetch to avoid blocking UI
    files.forEach(url => {
      fetch(url, { priority: 'low' }).catch(() => {});
    });
  }

  // Trigger preload after 5s idle or when user scrolls past halfway
  let vtPreloaded = false;
  setTimeout(() => { if (!vtPreloaded) { vtPreloaded = true; vtPreload(); } }, 5000);
  window.addEventListener('scroll', function vtScrollPreload() {
    if (vtPreloaded) { window.removeEventListener('scroll', vtScrollPreload); return; }
    if (window.scrollY > document.body.scrollHeight * 0.4) {
      vtPreloaded = true;
      vtPreload();
      window.removeEventListener('scroll', vtScrollPreload);
    }
  }, { passive: true });

  // Audio → 16kHz Float32
  async function vtBlobToFloat32(blob) {
    const buf = await blob.arrayBuffer();
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const decoded = await ctx.decodeAudioData(buf);
    const srcData = decoded.getChannelData(0);
    const srcRate = decoded.sampleRate;
    ctx.close();
    // Resample to 16kHz for Whisper
    if (srcRate === 16000) return srcData;
    const ratio = srcRate / 16000;
    const outLen = Math.floor(srcData.length / ratio);
    const out = new Float32Array(outLen);
    for (let i = 0; i < outLen; i++) {
      const srcIdx = i * ratio;
      const lo = Math.floor(srcIdx);
      const hi = Math.min(lo + 1, srcData.length - 1);
      const frac = srcIdx - lo;
      out[i] = srcData[lo] * (1 - frac) + srcData[hi] * frac;
    }
    return out;
  }

  function vtUpdateTranscript() {
    if (!vtTranscriptText.trim()) return;
    vtTranscript.style.display = 'block';
    vtTranscriptBody.textContent = vtTranscriptText;
    const words = vtTranscriptText.trim().split(/\s+/).filter(Boolean).length;
    vtWordCount.textContent = words + ' word' + (words !== 1 ? 's' : '');
    vtTranscriptBody.scrollTop = vtTranscriptBody.scrollHeight;
  }

  // Start recording
  async function vtStartRecording() {
    if (!vtModelLoaded) {
      vtRecBtn.classList.add('processing');
      try { await vtLoadModel(); } catch(e) {
        console.error('EVA model load failed:', e);
        vtPillStatus.textContent = 'Error: ' + (e.message || e).toString().slice(0, 60);
        vtPill.classList.remove('loading');
        vtRecBtn.classList.remove('processing');
        setTimeout(() => { vtPillStatus.textContent = ''; }, 8000);
        return;
      }
      vtRecBtn.classList.remove('processing');
    }

    try {
      vtStream = await navigator.mediaDevices.getUserMedia({ audio: true });
    } catch(e) {
      vtPillStatus.textContent = 'Mic access denied';
      setTimeout(() => { vtPillStatus.textContent = ''; }, 2000);
      return;
    }

    vtRecording = true;
    vtChunks = [];
    vtPill.classList.add('recording');
    vtRecBtn.classList.add('recording');

    // Audio analyser
    vtAudioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const source = vtAudioCtx.createMediaStreamSource(vtStream);
    vtAnalyser = vtAudioCtx.createAnalyser();
    vtAnalyser.fftSize = 256;
    vtAnalyser.smoothingTimeConstant = 0.85;
    source.connect(vtAnalyser);
    vtDrawWaveform();

    // MediaRecorder
    vtMediaRecorder = new MediaRecorder(vtStream, { mimeType: 'audio/webm;codecs=opus' });
    vtMediaRecorder.ondataavailable = (e) => { if (e.data.size > 0) vtChunks.push(e.data); };
    vtMediaRecorder.start(1000);

    vtStartTimer();
  }

  // Stop + transcribe
  async function vtStopRecording() {
    vtRecording = false;
    vtPill.classList.remove('recording');
    vtRecBtn.classList.remove('recording');
    vtStopTimer();
    vtSmoothed.fill(0);

    if (vtStream) { vtStream.getTracks().forEach(t => t.stop()); vtStream = null; }
    if (vtAudioCtx) { vtAudioCtx.close(); vtAudioCtx = null; vtAnalyser = null; }
    cancelAnimationFrame(vtAnimFrame);
    vtDrawIdle();

    // Wait for MediaRecorder to flush final chunks
    if (vtMediaRecorder && vtMediaRecorder.state !== 'inactive') {
      await new Promise(resolve => {
        vtMediaRecorder.onstop = resolve;
        vtMediaRecorder.stop();
      });
    }

    if (vtChunks.length === 0) return;

    // Transcribe
    vtProcessing = true;
    vtRecBtn.classList.add('processing');
    vtPillStatus.textContent = 'Transcribing...';

    try {
      const blob = new Blob(vtChunks, { type: 'audio/webm' });
      const audioData = await vtBlobToFloat32(blob);
      console.log('EVA: audio length', audioData.length, 'samples (' + (audioData.length/16000).toFixed(1) + 's)');
      const result = await vtWhisperPipeline(audioData, {
        chunk_length_s: 30, stride_length_s: 5,
      });
      console.log('EVA: pipeline result', JSON.stringify(result).slice(0, 300));
      let text = (result.text || (Array.isArray(result) && result[0]?.text) || '').trim();
      // Filter Whisper hallucinations on silence/noise
      text = text.replace(/\[.*?\]/g, '').replace(/\(.*?\)/g, '').trim();
      if (text && text.length > 1) {
        vtTranscriptText += (vtTranscriptText ? ' ' : '') + text;
        vtUpdateTranscript();
      } else {
        vtPillStatus.textContent = 'No speech detected';
        setTimeout(() => { vtPillStatus.textContent = ''; }, 3000);
      }
    } catch(e) {
      console.error('EVA transcription error:', e);
      vtPillStatus.textContent = 'Error: ' + (e.message || e).toString().slice(0, 50);
      setTimeout(() => { vtPillStatus.textContent = ''; }, 6000);
    }

    vtProcessing = false;
    vtRecBtn.classList.remove('processing');
    if (!vtPillStatus.textContent.startsWith('Error')) vtPillStatus.textContent = '';
  }

  // Toggle
  window.vtToggleRecord = function() {
    if (vtProcessing) return;
    vtRecording ? vtStopRecording() : vtStartRecording();
  };

  // Copy
  window.vtCopy = function() {
    const text = vtTranscriptText.trim();
    if (!text) return;
    navigator.clipboard.writeText(text).then(() => {
      const btn = document.querySelector('.vt-btn-copy');
      const orig = btn.innerHTML;
      btn.innerHTML = '<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12" stroke-linecap="round" stroke-linejoin="round"/></svg> Copied!';
      setTimeout(() => btn.innerHTML = orig, 1500);
    });
  };

  // Download
  window.vtDownload = function() {
    const text = vtTranscriptText.trim();
    if (!text) return;
    const blob = new Blob([text], { type: 'text/plain' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'eva-transcript-' + new Date().toISOString().slice(0,10) + '.txt';
    a.click();
    URL.revokeObjectURL(a.href);
  };

  // Spacebar toggle
  document.addEventListener('keydown', (e) => {
    if (e.code === 'Space' && !['INPUT','TEXTAREA'].includes(e.target.tagName) && !e.target.isContentEditable) {
      const rect = document.getElementById('eva').getBoundingClientRect();
      if (rect.top < window.innerHeight && rect.bottom > 0) {
        e.preventDefault();
        vtToggleRecord();
      }
    }
  });
})();

// ========== PDF.js Worker ==========
pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

// ========== FLOATING NAV + TOPBAR: scroll-aware theming ==========
(function() {
  const navEl = document.querySelector('.floating-nav');
  const navLinks = document.querySelectorAll('.floating-nav a');
  const topbar = document.querySelector('.topbar');
  const sections = [
    { id: 'smartdoc', el: document.getElementById('smartdoc') },
    { id: 'superprompt', el: document.getElementById('superprompt') },
    { id: 'raven', el: document.getElementById('raven') },
    { id: 'forge', el: document.getElementById('forge') },
    { id: 'eva', el: document.getElementById('eva') },
  ];
  const ravenIds = new Set(['raven', 'forge']);
  const ravenEl = document.getElementById('raven');

  function updateActiveNav() {
    const scrollY = window.scrollY + 120;
    let activeId = '';
    for (const s of sections) {
      if (s.el && s.el.offsetTop <= scrollY) activeId = s.id;
    }
    navLinks.forEach(link => {
      const isActive = link.getAttribute('href') === '#' + activeId;
      link.classList.toggle('active', isActive);
    });
    const inRavenZone = ravenIds.has(activeId);
    navEl.classList.toggle('raven-mode', inRavenZone);
    topbar.classList.toggle('dark-mode', inRavenZone);
  }

  window.addEventListener('scroll', updateActiveNav, { passive: true });
  updateActiveNav();
})();

// ========== LIVE DATE (header + footer) ==========
(function() {
  const d = new Date();
  const mm = String(d.getMonth()+1).padStart(2,'0');
  const dd = String(d.getDate()).padStart(2,'0');
  const yy = String(d.getFullYear()).slice(-2);
  const dateStr = `${mm}.${dd}.${yy}`;
  document.querySelectorAll('.live-date').forEach(el => el.textContent = dateStr);
})();

// ========== RAVEN FORGE (WebLLM — runs entirely in browser) ==========
(function() {
  let forgeMessages = JSON.parse(localStorage.getItem('forge_history') || '[]');
  let forgeStreaming = false;
  let forgeEngine = null;

  const FORGE_MODEL = 'Qwen2.5-3B-Instruct-q4f16_1-MLC';

  // Config with localStorage persistence
  const FC = {
    get temp() { return parseFloat(localStorage.getItem('forge_temp') || '0.7'); },
    get tokens() { return parseInt(localStorage.getItem('forge_max_tokens') || '1024'); },
  };

  // Load saved settings into modal inputs
  const sTemp = document.getElementById('forgeSettingTemp');
  const sTokens = document.getElementById('forgeSettingTokens');
  sTemp.value = FC.temp; sTokens.value = FC.tokens;

  const chatEl = document.getElementById('forgeChat');
  const inputEl = document.getElementById('forgeInput');
  const sendBtn = document.getElementById('forgeSendBtn');
  const welcomeEl = document.getElementById('forgeWelcome');

  // ---- CHAT ----
  function forgeBuildPayload() {
    const sys = 'You are RAVEN Forge, a hyper-capable local AI assistant. Be direct, concise, and precise. Use markdown formatting when helpful.';
    return [{ role: 'system', content: sys }, ...forgeMessages];
  }

  function forgeMd(text) {
    // Code blocks — preserve content
    const codeBlocks = [];
    text = text.replace(/```(\w*)\n?([\s\S]*?)```/g, (_, lang, code) => {
      codeBlocks.push(`<pre><code>${code}</code></pre>`);
      return `\x00CB${codeBlocks.length - 1}\x00`;
    });
    // Inline code
    text = text.replace(/`([^`]+)`/g, '<code>$1</code>');
    // Bold before italic
    text = text.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
    text = text.replace(/(?<!\*)\*([^*]+?)\*(?!\*)/g, '<em>$1</em>');
    // Headers
    text = text.replace(/^### (.+)$/gm, '<h4 style="font-size:14px;font-weight:700;color:#fff;margin:10px 0 4px">$1</h4>');
    text = text.replace(/^## (.+)$/gm, '<h3 style="font-size:15px;font-weight:700;color:#fff;margin:12px 0 4px">$1</h3>');
    text = text.replace(/^# (.+)$/gm, '<h2 style="font-size:16px;font-weight:700;color:#fff;margin:14px 0 6px">$1</h2>');
    // Lists — group consecutive lines
    text = text.replace(/(^[-*] .+$\n?)+/gm, m => {
      const items = m.trim().split('\n').map(l => `<li>${l.replace(/^[-*] /, '')}</li>`).join('');
      return `<ul>${items}</ul>`;
    });
    text = text.replace(/(^\d+\. .+$\n?)+/gm, m => {
      const items = m.trim().split('\n').map(l => `<li>${l.replace(/^\d+\. /, '')}</li>`).join('');
      return `<ol>${items}</ol>`;
    });
    // Line breaks — but not after block elements
    text = text.replace(/\n/g, '<br>');
    text = text.replace(/(<\/ul>|<\/ol>|<\/h[234]>|<\/pre>)<br>/g, '$1');
    text = text.replace(/<br>(<ul>|<ol>|<h[234]|<pre>)/g, '$1');
    // Restore code blocks
    text = text.replace(/\x00CB(\d+)\x00/g, (_, i) => codeBlocks[i]);
    return text;
  }

  function forgeRenderMsg(role, content, streaming) {
    if (welcomeEl) welcomeEl.style.display = 'none';
    const div = document.createElement('div');
    div.className = `forge-msg forge-msg-${role}`;
    const avatar = role === 'assistant' ? `<img src="raven-icon.png" alt="" class="forge-msg-avatar">` : '';
    const cursor = streaming ? '<span class="forge-cursor"></span>' : '';
    div.innerHTML = `${avatar}<div class="forge-msg-bubble">${forgeMd(content)}${cursor}</div>`;
    chatEl.appendChild(div);
    chatEl.scrollTop = chatEl.scrollHeight;
    return div;
  }

  function forgeAddSysMsg(text) {
    const div = document.createElement('div');
    div.className = 'forge-sys';
    div.textContent = text;
    chatEl.appendChild(div);
    chatEl.scrollTop = chatEl.scrollHeight;
  }

  // Render a clean error with hidden debug dropdown
  function forgeShowError(bubble, msg, debugInfo) {
    bubble.innerHTML = `<div style="font-size:13px;line-height:1.7">
      <span style="color:#ccc">${msg}</span>
      <details class="forge-error-details">
        <summary>Debug info ▸</summary>
        <pre>${esc(debugInfo)}</pre>
      </details>
    </div>`;
  }

  window.forgeSend = async function() {
    const text = inputEl.value.trim();
    if (!text || forgeStreaming || !forgeEngine) return;
    inputEl.value = ''; forgeResizeInput();
    sendBtn.disabled = true; sendBtn.classList.remove('active');

    forgeMessages.push({ role: 'user', content: text });
    forgeRenderMsg('user', text);

    forgeStreaming = true;
    const msgDiv = forgeRenderMsg('assistant', '', true);
    const bubble = msgDiv.querySelector('.forge-msg-bubble');
    let full = '';
    let renderQueued = false;

    function renderStream() {
      renderQueued = false;
      bubble.innerHTML = forgeMd(full) + '<span class="forge-cursor"></span>';
      chatEl.scrollTop = chatEl.scrollHeight;
    }

    function queueRender() {
      if (!renderQueued) {
        renderQueued = true;
        requestAnimationFrame(renderStream);
      }
    }

    try {
      const chunks = await forgeEngine.chat.completions.create({
        messages: forgeBuildPayload(),
        stream: true,
        temperature: FC.temp,
        max_tokens: FC.tokens,
      });

      for await (const chunk of chunks) {
        const token = chunk.choices?.[0]?.delta?.content || '';
        if (token) {
          full += token;
          queueRender();
        }
      }
    } catch (e) {
      if (!full) {
        forgeShowError(bubble, e.message, 'error: ' + e.name + ': ' + e.message + '\nmodel: ' + FORGE_MODEL);
        forgeMessages.push({ role: 'assistant', content: '(Error)' });
        forgeStreaming = false;
        return;
      }
    }

    bubble.innerHTML = forgeMd(full || '(Empty response)');
    forgeMessages.push({ role: 'assistant', content: full });
    localStorage.setItem('forge_history', JSON.stringify(forgeMessages));
    forgeStreaming = false;
  };

  // ---- INPUT ----
  window.forgeKeydown = function(e) {
    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); forgeSend(); }
  };

  window.forgeResizeInput = function() {
    inputEl.style.height = 'auto';
    inputEl.style.height = Math.min(inputEl.scrollHeight, 120) + 'px';
    const hasText = inputEl.value.trim().length > 0;
    sendBtn.disabled = !hasText;
    sendBtn.classList.toggle('active', hasText);
  };

  // ---- WEBLLM ENGINE ----
  const gateEl = document.getElementById('forgeGate');
  const loadBtn = document.getElementById('forgeLoadBtn');
  const loadBtnText = document.getElementById('forgeLoadBtnText');
  const loadProgress = document.getElementById('forgeLoadProgress');
  const loadFill = document.getElementById('forgeLoadFill');
  const loadStatus = document.getElementById('forgeLoadStatus');
  const loadError = document.getElementById('forgeLoadError');

  window.forgeStartEngine = async function() {
    if (!navigator.gpu) {
      loadError.style.display = 'block';
      loadError.innerHTML = 'Your browser doesn\'t support WebGPU.<br>Use <strong>Chrome 113+</strong> or <strong>Edge 113+</strong>.';
      return;
    }

    loadProgress.style.width = loadBtn.offsetWidth + 'px';
    loadBtn.disabled = true;
    loadBtnText.textContent = 'Downloading...';
    loadBtn.querySelector('svg').style.display = 'none';
    loadProgress.style.display = 'block';
    loadError.style.display = 'none';

    const startTime = Date.now();
    let timerInterval = setInterval(() => {
      const s = Math.floor((Date.now() - startTime) / 1000);
      const mins = Math.floor(s / 60);
      const secs = s % 60;
      const pct = loadFill.style.width || '0%';
      loadStatus.textContent = `${pct} — ${mins > 0 ? mins + 'm ' : ''}${secs}s elapsed`;
    }, 1000);

    try {
      const { CreateMLCEngine } = await import('https://esm.run/@mlc-ai/web-llm');

      forgeEngine = await CreateMLCEngine(FORGE_MODEL, {
        initProgressCallback: (report) => {
          const pct = Math.floor(report.progress * 100);
          loadFill.style.width = pct + '%';
          const s = Math.floor((Date.now() - startTime) / 1000);
          const mins = Math.floor(s / 60);
          const secs = s % 60;
          loadStatus.textContent = `${pct}% — ${mins > 0 ? mins + 'm ' : ''}${secs}s elapsed`;
        },
      }, { context_window_size: 32768 });

      clearInterval(timerInterval);
      loadFill.style.width = '100%';
      loadStatus.textContent = 'Ready!';
      loadBtnText.textContent = 'Loaded';
      setTimeout(() => gateEl.classList.add('dismissed'), 600);

    } catch (e) {
      clearInterval(timerInterval);
      loadBtn.disabled = false;
      loadBtnText.textContent = 'Retry';
      loadBtn.querySelector('svg').style.display = '';
      loadError.style.display = 'block';
      loadError.textContent = e.message;
    }
  };

  // ---- SETTINGS ----
  window.forgeToggleSettings = function() {
    document.getElementById('forgeModalBg').classList.toggle('open');
  };

  window.forgeSaveSettings = function() {
    localStorage.setItem('forge_temp', sTemp.value);
    localStorage.setItem('forge_max_tokens', sTokens.value);
    document.getElementById('forgeModalBg').classList.remove('open');
    showToast('Forge settings saved', true);
  };

  // ---- MEMORY (restore chat history) ----
  // Restore previous messages into the UI
  if (forgeMessages.length) {
    welcomeEl.style.display = 'none';
    forgeMessages.forEach(m => {
      if (m.role === 'user' || m.role === 'assistant') {
        forgeRenderMsg(m.role, m.content);
      }
    });
  }

})();
</script>
</body>
</html>
